3419726520c51d81b502ad9593e94ef3
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.reportLogBoxError = reportLogBoxError;
exports.isLogBoxErrorMessage = isLogBoxErrorMessage;
exports.isMessageIgnored = isMessageIgnored;
exports.addLog = addLog;
exports.addException = addException;
exports.symbolicateLogNow = symbolicateLogNow;
exports.retrySymbolicateLogNow = retrySymbolicateLogNow;
exports.symbolicateLogLazy = symbolicateLogLazy;
exports.clear = clear;
exports.setSelectedLog = setSelectedLog;
exports.clearWarnings = clearWarnings;
exports.clearErrors = clearErrors;
exports.dismiss = dismiss;
exports.setWarningFilter = setWarningFilter;
exports.setAppInfo = setAppInfo;
exports.getAppInfo = getAppInfo;
exports.checkWarningFilter = checkWarningFilter;
exports.addIgnorePatterns = addIgnorePatterns;
exports.setDisabled = setDisabled;
exports.isDisabled = isDisabled;
exports.observe = observe;
exports.withSubscription = withSubscription;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var React = _interopRequireWildcard(require("react"));

var _LogBoxLog = _interopRequireDefault(require("./LogBoxLog"));

var _parseLogBoxLog = require("./parseLogBoxLog");

var _parseErrorStack = _interopRequireDefault(require("../../Core/Devtools/parseErrorStack"));

var _NativeLogBox = _interopRequireDefault(require("../../NativeModules/specs/NativeLogBox"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

'use strict';

var observers = new Set();
var ignorePatterns = new Set();
var appInfo = null;
var logs = new Set();
var updateTimeout = null;
var _isDisabled = false;

var _selectedIndex = -1;

var warningFilter = function warningFilter(format) {
  return {
    finalFormat: format,
    forceDialogImmediately: false,
    suppressDialog_LEGACY: true,
    suppressCompletely: false,
    monitorEvent: 'unknown',
    monitorListVersion: 0,
    monitorSampleRate: 1
  };
};

var LOGBOX_ERROR_MESSAGE = 'An error was thrown when attempting to render log messages via LogBox.';

function getNextState() {
  return {
    logs: logs,
    isDisabled: _isDisabled,
    selectedLogIndex: _selectedIndex
  };
}

function reportLogBoxError(error, componentStack) {
  var ExceptionsManager = require("../../Core/ExceptionsManager");

  error.forceRedbox = true;
  error.message = LOGBOX_ERROR_MESSAGE + "\n\n" + error.message;

  if (componentStack != null) {
    error.componentStack = componentStack;
  }

  ExceptionsManager.handleException(error, true);
}

function isLogBoxErrorMessage(message) {
  return typeof message === 'string' && message.includes(LOGBOX_ERROR_MESSAGE);
}

function isMessageIgnored(message) {
  for (var _iterator = _createForOfIteratorHelperLoose(ignorePatterns), _step; !(_step = _iterator()).done;) {
    var pattern = _step.value;

    if (pattern instanceof RegExp && pattern.test(message) || typeof pattern === 'string' && message.includes(pattern)) {
      return true;
    }
  }

  return false;
}

function handleUpdate() {
  if (updateTimeout == null) {
    updateTimeout = setImmediate(function () {
      updateTimeout = null;
      var nextState = getNextState();
      observers.forEach(function (_ref) {
        var observer = _ref.observer;
        return observer(nextState);
      });
    });
  }
}

function appendNewLog(newLog) {
  if (isMessageIgnored(newLog.message.content)) {
    return;
  }

  var lastLog = Array.from(logs).pop();

  if (lastLog && lastLog.category === newLog.category) {
    lastLog.incrementCount();
    handleUpdate();
    return;
  }

  if (newLog.level === 'fatal') {
    var OPTIMISTIC_WAIT_TIME = 1000;

    var _addPendingLog = function addPendingLog() {
      logs.add(newLog);

      if (_selectedIndex <= 0) {
        setSelectedLog(logs.size - 1);
      } else {
        handleUpdate();
      }

      _addPendingLog = null;
    };

    var optimisticTimeout = setTimeout(function () {
      if (_addPendingLog) {
        _addPendingLog();
      }
    }, OPTIMISTIC_WAIT_TIME);
    newLog.symbolicate(function (status) {
      if (_addPendingLog && status !== 'PENDING') {
        _addPendingLog();

        clearTimeout(optimisticTimeout);
      } else if (status !== 'PENDING') {
        handleUpdate();
      }
    });
  } else if (newLog.level === 'syntax') {
    logs.add(newLog);
    setSelectedLog(logs.size - 1);
  } else {
    logs.add(newLog);
    handleUpdate();
  }
}

function addLog(log) {
  var errorForStackTrace = new Error();
  setImmediate(function () {
    try {
      var stack = (0, _parseErrorStack.default)(errorForStackTrace);
      appendNewLog(new _LogBoxLog.default({
        level: log.level,
        message: log.message,
        isComponentError: false,
        stack: stack,
        category: log.category,
        componentStack: log.componentStack
      }));
    } catch (error) {
      reportLogBoxError(error);
    }
  });
}

function addException(error) {
  setImmediate(function () {
    try {
      appendNewLog(new _LogBoxLog.default((0, _parseLogBoxLog.parseLogBoxException)(error)));
    } catch (loggingError) {
      reportLogBoxError(loggingError);
    }
  });
}

function symbolicateLogNow(log) {
  log.symbolicate(function () {
    handleUpdate();
  });
}

function retrySymbolicateLogNow(log) {
  log.retrySymbolicate(function () {
    handleUpdate();
  });
}

function symbolicateLogLazy(log) {
  log.symbolicate();
}

function clear() {
  if (logs.size > 0) {
    logs = new Set();
    setSelectedLog(-1);
  }
}

function setSelectedLog(proposedNewIndex) {
  var oldIndex = _selectedIndex;
  var newIndex = proposedNewIndex;
  var logArray = Array.from(logs);
  var index = logArray.length - 1;

  while (index >= 0) {
    if (logArray[index].level === 'syntax') {
      newIndex = index;
      break;
    }

    index -= 1;
  }

  _selectedIndex = newIndex;
  handleUpdate();

  if (_NativeLogBox.default) {
    setTimeout(function () {
      if (oldIndex < 0 && newIndex >= 0) {
        _NativeLogBox.default.show();
      } else if (oldIndex >= 0 && newIndex < 0) {
        _NativeLogBox.default.hide();
      }
    }, 0);
  }
}

function clearWarnings() {
  var newLogs = Array.from(logs).filter(function (log) {
    return log.level !== 'warn';
  });

  if (newLogs.length !== logs.size) {
    logs = new Set(newLogs);
    setSelectedLog(-1);
    handleUpdate();
  }
}

function clearErrors() {
  var newLogs = Array.from(logs).filter(function (log) {
    return log.level !== 'error' && log.level !== 'fatal';
  });

  if (newLogs.length !== logs.size) {
    logs = new Set(newLogs);
    setSelectedLog(-1);
  }
}

function dismiss(log) {
  if (logs.has(log)) {
    logs.delete(log);
    handleUpdate();
  }
}

function setWarningFilter(filter) {
  warningFilter = filter;
}

function setAppInfo(info) {
  appInfo = info;
}

function getAppInfo() {
  return appInfo != null ? appInfo() : null;
}

function checkWarningFilter(format) {
  return warningFilter(format);
}

function addIgnorePatterns(patterns) {
  var newPatterns = patterns.filter(function (pattern) {
    if (pattern instanceof RegExp) {
      for (var _iterator2 = _createForOfIteratorHelperLoose(ignorePatterns.entries()), _step2; !(_step2 = _iterator2()).done;) {
        var existingPattern = _step2.value;

        if (existingPattern instanceof RegExp && existingPattern.toString() === pattern.toString()) {
          return false;
        }
      }

      return true;
    }

    return !ignorePatterns.has(pattern);
  });

  if (newPatterns.length === 0) {
    return;
  }

  for (var _iterator3 = _createForOfIteratorHelperLoose(newPatterns), _step3; !(_step3 = _iterator3()).done;) {
    var pattern = _step3.value;
    ignorePatterns.add(pattern);
    logs = new Set(Array.from(logs).filter(function (log) {
      return !isMessageIgnored(log.message.content);
    }));
  }

  handleUpdate();
}

function setDisabled(value) {
  if (value === _isDisabled) {
    return;
  }

  _isDisabled = value;
  handleUpdate();
}

function isDisabled() {
  return _isDisabled;
}

function observe(observer) {
  var subscription = {
    observer: observer
  };
  observers.add(subscription);
  observer(getNextState());
  return {
    unsubscribe: function unsubscribe() {
      observers.delete(subscription);
    }
  };
}

function withSubscription(WrappedComponent) {
  var LogBoxStateSubscription = function (_React$Component) {
    (0, _inherits2.default)(LogBoxStateSubscription, _React$Component);

    var _super = _createSuper(LogBoxStateSubscription);

    function LogBoxStateSubscription() {
      var _this;

      (0, _classCallCheck2.default)(this, LogBoxStateSubscription);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _super.call.apply(_super, [this].concat(args));
      _this.state = {
        logs: new Set(),
        isDisabled: false,
        hasError: false,
        selectedLogIndex: -1
      };

      _this._handleDismiss = function () {
        var _this$state = _this.state,
            selectedLogIndex = _this$state.selectedLogIndex,
            stateLogs = _this$state.logs;
        var logsArray = Array.from(stateLogs);

        if (selectedLogIndex != null) {
          if (logsArray.length - 1 <= 0) {
            setSelectedLog(-1);
          } else if (selectedLogIndex >= logsArray.length - 1) {
            setSelectedLog(selectedLogIndex - 1);
          }

          dismiss(logsArray[selectedLogIndex]);
        }
      };

      _this._handleMinimize = function () {
        setSelectedLog(-1);
      };

      _this._handleSetSelectedLog = function (index) {
        setSelectedLog(index);
      };

      return _this;
    }

    (0, _createClass2.default)(LogBoxStateSubscription, [{
      key: "componentDidCatch",
      value: function componentDidCatch(err, errorInfo) {
        reportLogBoxError(err, errorInfo.componentStack);
      }
    }, {
      key: "render",
      value: function render() {
        if (this.state.hasError) {
          return null;
        }

        return React.createElement(WrappedComponent, {
          logs: Array.from(this.state.logs),
          isDisabled: this.state.isDisabled,
          selectedLogIndex: this.state.selectedLogIndex
        });
      }
    }, {
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this2 = this;

        this._subscription = observe(function (data) {
          _this2.setState(data);
        });
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        if (this._subscription != null) {
          this._subscription.unsubscribe();
        }
      }
    }], [{
      key: "getDerivedStateFromError",
      value: function getDerivedStateFromError() {
        return {
          hasError: true
        };
      }
    }]);
    return LogBoxStateSubscription;
  }(React.Component);

  return LogBoxStateSubscription;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxvZ0JveERhdGEuanMiXSwibmFtZXMiOlsib2JzZXJ2ZXJzIiwiU2V0IiwiaWdub3JlUGF0dGVybnMiLCJhcHBJbmZvIiwibG9ncyIsInVwZGF0ZVRpbWVvdXQiLCJfaXNEaXNhYmxlZCIsIl9zZWxlY3RlZEluZGV4Iiwid2FybmluZ0ZpbHRlciIsImZvcm1hdCIsImZpbmFsRm9ybWF0IiwiZm9yY2VEaWFsb2dJbW1lZGlhdGVseSIsInN1cHByZXNzRGlhbG9nX0xFR0FDWSIsInN1cHByZXNzQ29tcGxldGVseSIsIm1vbml0b3JFdmVudCIsIm1vbml0b3JMaXN0VmVyc2lvbiIsIm1vbml0b3JTYW1wbGVSYXRlIiwiTE9HQk9YX0VSUk9SX01FU1NBR0UiLCJnZXROZXh0U3RhdGUiLCJpc0Rpc2FibGVkIiwic2VsZWN0ZWRMb2dJbmRleCIsInJlcG9ydExvZ0JveEVycm9yIiwiZXJyb3IiLCJjb21wb25lbnRTdGFjayIsIkV4Y2VwdGlvbnNNYW5hZ2VyIiwicmVxdWlyZSIsImZvcmNlUmVkYm94IiwibWVzc2FnZSIsImhhbmRsZUV4Y2VwdGlvbiIsImlzTG9nQm94RXJyb3JNZXNzYWdlIiwiaW5jbHVkZXMiLCJpc01lc3NhZ2VJZ25vcmVkIiwicGF0dGVybiIsIlJlZ0V4cCIsInRlc3QiLCJoYW5kbGVVcGRhdGUiLCJzZXRJbW1lZGlhdGUiLCJuZXh0U3RhdGUiLCJmb3JFYWNoIiwib2JzZXJ2ZXIiLCJhcHBlbmROZXdMb2ciLCJuZXdMb2ciLCJjb250ZW50IiwibGFzdExvZyIsIkFycmF5IiwiZnJvbSIsInBvcCIsImNhdGVnb3J5IiwiaW5jcmVtZW50Q291bnQiLCJsZXZlbCIsIk9QVElNSVNUSUNfV0FJVF9USU1FIiwiYWRkUGVuZGluZ0xvZyIsImFkZCIsInNldFNlbGVjdGVkTG9nIiwic2l6ZSIsIm9wdGltaXN0aWNUaW1lb3V0Iiwic2V0VGltZW91dCIsInN5bWJvbGljYXRlIiwic3RhdHVzIiwiY2xlYXJUaW1lb3V0IiwiYWRkTG9nIiwibG9nIiwiZXJyb3JGb3JTdGFja1RyYWNlIiwiRXJyb3IiLCJzdGFjayIsIkxvZ0JveExvZyIsImlzQ29tcG9uZW50RXJyb3IiLCJhZGRFeGNlcHRpb24iLCJsb2dnaW5nRXJyb3IiLCJzeW1ib2xpY2F0ZUxvZ05vdyIsInJldHJ5U3ltYm9saWNhdGVMb2dOb3ciLCJyZXRyeVN5bWJvbGljYXRlIiwic3ltYm9saWNhdGVMb2dMYXp5IiwiY2xlYXIiLCJwcm9wb3NlZE5ld0luZGV4Iiwib2xkSW5kZXgiLCJuZXdJbmRleCIsImxvZ0FycmF5IiwiaW5kZXgiLCJsZW5ndGgiLCJOYXRpdmVMb2dCb3giLCJzaG93IiwiaGlkZSIsImNsZWFyV2FybmluZ3MiLCJuZXdMb2dzIiwiZmlsdGVyIiwiY2xlYXJFcnJvcnMiLCJkaXNtaXNzIiwiaGFzIiwiZGVsZXRlIiwic2V0V2FybmluZ0ZpbHRlciIsInNldEFwcEluZm8iLCJpbmZvIiwiZ2V0QXBwSW5mbyIsImNoZWNrV2FybmluZ0ZpbHRlciIsImFkZElnbm9yZVBhdHRlcm5zIiwicGF0dGVybnMiLCJuZXdQYXR0ZXJucyIsImVudHJpZXMiLCJleGlzdGluZ1BhdHRlcm4iLCJ0b1N0cmluZyIsInNldERpc2FibGVkIiwidmFsdWUiLCJvYnNlcnZlIiwic3Vic2NyaXB0aW9uIiwidW5zdWJzY3JpYmUiLCJ3aXRoU3Vic2NyaXB0aW9uIiwiV3JhcHBlZENvbXBvbmVudCIsIkxvZ0JveFN0YXRlU3Vic2NyaXB0aW9uIiwic3RhdGUiLCJoYXNFcnJvciIsIl9oYW5kbGVEaXNtaXNzIiwic3RhdGVMb2dzIiwibG9nc0FycmF5IiwiX2hhbmRsZU1pbmltaXplIiwiX2hhbmRsZVNldFNlbGVjdGVkTG9nIiwiZXJyIiwiZXJyb3JJbmZvIiwiX3N1YnNjcmlwdGlvbiIsImRhdGEiLCJzZXRTdGF0ZSIsIlJlYWN0IiwiQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVlBOztBQUNBOztBQUNBOztBQVFBOztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7O0FBZEMsWUFBRDs7QUF1REEsSUFBTUEsU0FBeUMsR0FBRyxJQUFJQyxHQUFKLEVBQWxEO0FBQ0EsSUFBTUMsY0FBa0MsR0FBRyxJQUFJRCxHQUFKLEVBQTNDO0FBQ0EsSUFBSUUsT0FBdUIsR0FBRyxJQUE5QjtBQUNBLElBQUlDLElBQWdCLEdBQUcsSUFBSUgsR0FBSixFQUF2QjtBQUNBLElBQUlJLGFBQWEsR0FBRyxJQUFwQjtBQUNBLElBQUlDLFdBQVcsR0FBRyxLQUFsQjs7QUFDQSxJQUFJQyxjQUFjLEdBQUcsQ0FBQyxDQUF0Qjs7QUFFQSxJQUFJQyxhQUE0QixHQUFHLHVCQUFTQyxNQUFULEVBQWlCO0FBQ2xELFNBQU87QUFDTEMsSUFBQUEsV0FBVyxFQUFFRCxNQURSO0FBRUxFLElBQUFBLHNCQUFzQixFQUFFLEtBRm5CO0FBR0xDLElBQUFBLHFCQUFxQixFQUFFLElBSGxCO0FBSUxDLElBQUFBLGtCQUFrQixFQUFFLEtBSmY7QUFLTEMsSUFBQUEsWUFBWSxFQUFFLFNBTFQ7QUFNTEMsSUFBQUEsa0JBQWtCLEVBQUUsQ0FOZjtBQU9MQyxJQUFBQSxpQkFBaUIsRUFBRTtBQVBkLEdBQVA7QUFTRCxDQVZEOztBQVlBLElBQU1DLG9CQUFvQixHQUN4Qix3RUFERjs7QUFHQSxTQUFTQyxZQUFULEdBQXdCO0FBQ3RCLFNBQU87QUFDTGQsSUFBQUEsSUFBSSxFQUFKQSxJQURLO0FBRUxlLElBQUFBLFVBQVUsRUFBRWIsV0FGUDtBQUdMYyxJQUFBQSxnQkFBZ0IsRUFBRWI7QUFIYixHQUFQO0FBS0Q7O0FBRU0sU0FBU2MsaUJBQVQsQ0FDTEMsS0FESyxFQUVMQyxjQUZLLEVBR0M7QUFDTixNQUFNQyxpQkFBaUIsR0FBR0MsT0FBTyxnQ0FBakM7O0FBRUFILEVBQUFBLEtBQUssQ0FBQ0ksV0FBTixHQUFvQixJQUFwQjtBQUNBSixFQUFBQSxLQUFLLENBQUNLLE9BQU4sR0FBbUJWLG9CQUFuQixZQUE4Q0ssS0FBSyxDQUFDSyxPQUFwRDs7QUFDQSxNQUFJSixjQUFjLElBQUksSUFBdEIsRUFBNEI7QUFDMUJELElBQUFBLEtBQUssQ0FBQ0MsY0FBTixHQUF1QkEsY0FBdkI7QUFDRDs7QUFDREMsRUFBQUEsaUJBQWlCLENBQUNJLGVBQWxCLENBQWtDTixLQUFsQyxFQUF1RCxJQUF2RDtBQUNEOztBQUVNLFNBQVNPLG9CQUFULENBQThCRixPQUE5QixFQUF3RDtBQUM3RCxTQUFPLE9BQU9BLE9BQVAsS0FBbUIsUUFBbkIsSUFBK0JBLE9BQU8sQ0FBQ0csUUFBUixDQUFpQmIsb0JBQWpCLENBQXRDO0FBQ0Q7O0FBRU0sU0FBU2MsZ0JBQVQsQ0FBMEJKLE9BQTFCLEVBQW9EO0FBQ3pELHVEQUFzQnpCLGNBQXRCLHdDQUFzQztBQUFBLFFBQTNCOEIsT0FBMkI7O0FBQ3BDLFFBQ0dBLE9BQU8sWUFBWUMsTUFBbkIsSUFBNkJELE9BQU8sQ0FBQ0UsSUFBUixDQUFhUCxPQUFiLENBQTlCLElBQ0MsT0FBT0ssT0FBUCxLQUFtQixRQUFuQixJQUErQkwsT0FBTyxDQUFDRyxRQUFSLENBQWlCRSxPQUFqQixDQUZsQyxFQUdFO0FBQ0EsYUFBTyxJQUFQO0FBQ0Q7QUFDRjs7QUFDRCxTQUFPLEtBQVA7QUFDRDs7QUFFRCxTQUFTRyxZQUFULEdBQThCO0FBQzVCLE1BQUk5QixhQUFhLElBQUksSUFBckIsRUFBMkI7QUFDekJBLElBQUFBLGFBQWEsR0FBRytCLFlBQVksQ0FBQyxZQUFNO0FBQ2pDL0IsTUFBQUEsYUFBYSxHQUFHLElBQWhCO0FBQ0EsVUFBTWdDLFNBQVMsR0FBR25CLFlBQVksRUFBOUI7QUFDQWxCLE1BQUFBLFNBQVMsQ0FBQ3NDLE9BQVYsQ0FBa0I7QUFBQSxZQUFFQyxRQUFGLFFBQUVBLFFBQUY7QUFBQSxlQUFnQkEsUUFBUSxDQUFDRixTQUFELENBQXhCO0FBQUEsT0FBbEI7QUFDRCxLQUoyQixDQUE1QjtBQUtEO0FBQ0Y7O0FBRUQsU0FBU0csWUFBVCxDQUFzQkMsTUFBdEIsRUFBOEI7QUFLNUIsTUFBSVYsZ0JBQWdCLENBQUNVLE1BQU0sQ0FBQ2QsT0FBUCxDQUFlZSxPQUFoQixDQUFwQixFQUE4QztBQUM1QztBQUNEOztBQUtELE1BQU1DLE9BQU8sR0FBR0MsS0FBSyxDQUFDQyxJQUFOLENBQVd6QyxJQUFYLEVBQWlCMEMsR0FBakIsRUFBaEI7O0FBQ0EsTUFBSUgsT0FBTyxJQUFJQSxPQUFPLENBQUNJLFFBQVIsS0FBcUJOLE1BQU0sQ0FBQ00sUUFBM0MsRUFBcUQ7QUFDbkRKLElBQUFBLE9BQU8sQ0FBQ0ssY0FBUjtBQUNBYixJQUFBQSxZQUFZO0FBQ1o7QUFDRDs7QUFFRCxNQUFJTSxNQUFNLENBQUNRLEtBQVAsS0FBaUIsT0FBckIsRUFBOEI7QUFJNUIsUUFBTUMsb0JBQW9CLEdBQUcsSUFBN0I7O0FBRUEsUUFBSUMsY0FBYSxHQUFHLHlCQUFNO0FBQ3hCL0MsTUFBQUEsSUFBSSxDQUFDZ0QsR0FBTCxDQUFTWCxNQUFUOztBQUNBLFVBQUlsQyxjQUFjLElBQUksQ0FBdEIsRUFBeUI7QUFDdkI4QyxRQUFBQSxjQUFjLENBQUNqRCxJQUFJLENBQUNrRCxJQUFMLEdBQVksQ0FBYixDQUFkO0FBQ0QsT0FGRCxNQUVPO0FBQ0xuQixRQUFBQSxZQUFZO0FBQ2I7O0FBQ0RnQixNQUFBQSxjQUFhLEdBQUcsSUFBaEI7QUFDRCxLQVJEOztBQVVBLFFBQU1JLGlCQUFpQixHQUFHQyxVQUFVLENBQUMsWUFBTTtBQUN6QyxVQUFJTCxjQUFKLEVBQW1CO0FBQ2pCQSxRQUFBQSxjQUFhO0FBQ2Q7QUFDRixLQUptQyxFQUlqQ0Qsb0JBSmlDLENBQXBDO0FBTUFULElBQUFBLE1BQU0sQ0FBQ2dCLFdBQVAsQ0FBbUIsVUFBQUMsTUFBTSxFQUFJO0FBQzNCLFVBQUlQLGNBQWEsSUFBSU8sTUFBTSxLQUFLLFNBQWhDLEVBQTJDO0FBQ3pDUCxRQUFBQSxjQUFhOztBQUNiUSxRQUFBQSxZQUFZLENBQUNKLGlCQUFELENBQVo7QUFDRCxPQUhELE1BR08sSUFBSUcsTUFBTSxLQUFLLFNBQWYsRUFBMEI7QUFFL0J2QixRQUFBQSxZQUFZO0FBQ2I7QUFDRixLQVJEO0FBU0QsR0EvQkQsTUErQk8sSUFBSU0sTUFBTSxDQUFDUSxLQUFQLEtBQWlCLFFBQXJCLEVBQStCO0FBQ3BDN0MsSUFBQUEsSUFBSSxDQUFDZ0QsR0FBTCxDQUFTWCxNQUFUO0FBQ0FZLElBQUFBLGNBQWMsQ0FBQ2pELElBQUksQ0FBQ2tELElBQUwsR0FBWSxDQUFiLENBQWQ7QUFDRCxHQUhNLE1BR0E7QUFDTGxELElBQUFBLElBQUksQ0FBQ2dELEdBQUwsQ0FBU1gsTUFBVDtBQUNBTixJQUFBQSxZQUFZO0FBQ2I7QUFDRjs7QUFFTSxTQUFTeUIsTUFBVCxDQUFnQkMsR0FBaEIsRUFBb0M7QUFDekMsTUFBTUMsa0JBQWtCLEdBQUcsSUFBSUMsS0FBSixFQUEzQjtBQUlBM0IsRUFBQUEsWUFBWSxDQUFDLFlBQU07QUFDakIsUUFBSTtBQUVGLFVBQU00QixLQUFLLEdBQUcsOEJBQWdCRixrQkFBaEIsQ0FBZDtBQUVBdEIsTUFBQUEsWUFBWSxDQUNWLElBQUl5QixrQkFBSixDQUFjO0FBQ1poQixRQUFBQSxLQUFLLEVBQUVZLEdBQUcsQ0FBQ1osS0FEQztBQUVadEIsUUFBQUEsT0FBTyxFQUFFa0MsR0FBRyxDQUFDbEMsT0FGRDtBQUdadUMsUUFBQUEsZ0JBQWdCLEVBQUUsS0FITjtBQUlaRixRQUFBQSxLQUFLLEVBQUxBLEtBSlk7QUFLWmpCLFFBQUFBLFFBQVEsRUFBRWMsR0FBRyxDQUFDZCxRQUxGO0FBTVp4QixRQUFBQSxjQUFjLEVBQUVzQyxHQUFHLENBQUN0QztBQU5SLE9BQWQsQ0FEVSxDQUFaO0FBVUQsS0FkRCxDQWNFLE9BQU9ELEtBQVAsRUFBYztBQUNkRCxNQUFBQSxpQkFBaUIsQ0FBQ0MsS0FBRCxDQUFqQjtBQUNEO0FBQ0YsR0FsQlcsQ0FBWjtBQW1CRDs7QUFFTSxTQUFTNkMsWUFBVCxDQUFzQjdDLEtBQXRCLEVBQTBEO0FBRy9EYyxFQUFBQSxZQUFZLENBQUMsWUFBTTtBQUNqQixRQUFJO0FBQ0ZJLE1BQUFBLFlBQVksQ0FBQyxJQUFJeUIsa0JBQUosQ0FBYywwQ0FBcUIzQyxLQUFyQixDQUFkLENBQUQsQ0FBWjtBQUNELEtBRkQsQ0FFRSxPQUFPOEMsWUFBUCxFQUFxQjtBQUNyQi9DLE1BQUFBLGlCQUFpQixDQUFDK0MsWUFBRCxDQUFqQjtBQUNEO0FBQ0YsR0FOVyxDQUFaO0FBT0Q7O0FBRU0sU0FBU0MsaUJBQVQsQ0FBMkJSLEdBQTNCLEVBQTJDO0FBQ2hEQSxFQUFBQSxHQUFHLENBQUNKLFdBQUosQ0FBZ0IsWUFBTTtBQUNwQnRCLElBQUFBLFlBQVk7QUFDYixHQUZEO0FBR0Q7O0FBRU0sU0FBU21DLHNCQUFULENBQWdDVCxHQUFoQyxFQUFnRDtBQUNyREEsRUFBQUEsR0FBRyxDQUFDVSxnQkFBSixDQUFxQixZQUFNO0FBQ3pCcEMsSUFBQUEsWUFBWTtBQUNiLEdBRkQ7QUFHRDs7QUFFTSxTQUFTcUMsa0JBQVQsQ0FBNEJYLEdBQTVCLEVBQTRDO0FBQ2pEQSxFQUFBQSxHQUFHLENBQUNKLFdBQUo7QUFDRDs7QUFFTSxTQUFTZ0IsS0FBVCxHQUF1QjtBQUM1QixNQUFJckUsSUFBSSxDQUFDa0QsSUFBTCxHQUFZLENBQWhCLEVBQW1CO0FBQ2pCbEQsSUFBQUEsSUFBSSxHQUFHLElBQUlILEdBQUosRUFBUDtBQUNBb0QsSUFBQUEsY0FBYyxDQUFDLENBQUMsQ0FBRixDQUFkO0FBQ0Q7QUFDRjs7QUFFTSxTQUFTQSxjQUFULENBQXdCcUIsZ0JBQXhCLEVBQXdEO0FBQzdELE1BQU1DLFFBQVEsR0FBR3BFLGNBQWpCO0FBQ0EsTUFBSXFFLFFBQVEsR0FBR0YsZ0JBQWY7QUFFQSxNQUFNRyxRQUFRLEdBQUdqQyxLQUFLLENBQUNDLElBQU4sQ0FBV3pDLElBQVgsQ0FBakI7QUFDQSxNQUFJMEUsS0FBSyxHQUFHRCxRQUFRLENBQUNFLE1BQVQsR0FBa0IsQ0FBOUI7O0FBQ0EsU0FBT0QsS0FBSyxJQUFJLENBQWhCLEVBQW1CO0FBRWpCLFFBQUlELFFBQVEsQ0FBQ0MsS0FBRCxDQUFSLENBQWdCN0IsS0FBaEIsS0FBMEIsUUFBOUIsRUFBd0M7QUFDdEMyQixNQUFBQSxRQUFRLEdBQUdFLEtBQVg7QUFDQTtBQUNEOztBQUNEQSxJQUFBQSxLQUFLLElBQUksQ0FBVDtBQUNEOztBQUNEdkUsRUFBQUEsY0FBYyxHQUFHcUUsUUFBakI7QUFDQXpDLEVBQUFBLFlBQVk7O0FBQ1osTUFBSTZDLHFCQUFKLEVBQWtCO0FBQ2hCeEIsSUFBQUEsVUFBVSxDQUFDLFlBQU07QUFDZixVQUFJbUIsUUFBUSxHQUFHLENBQVgsSUFBZ0JDLFFBQVEsSUFBSSxDQUFoQyxFQUFtQztBQUNqQ0ksOEJBQWFDLElBQWI7QUFDRCxPQUZELE1BRU8sSUFBSU4sUUFBUSxJQUFJLENBQVosSUFBaUJDLFFBQVEsR0FBRyxDQUFoQyxFQUFtQztBQUN4Q0ksOEJBQWFFLElBQWI7QUFDRDtBQUNGLEtBTlMsRUFNUCxDQU5PLENBQVY7QUFPRDtBQUNGOztBQUVNLFNBQVNDLGFBQVQsR0FBK0I7QUFDcEMsTUFBTUMsT0FBTyxHQUFHeEMsS0FBSyxDQUFDQyxJQUFOLENBQVd6QyxJQUFYLEVBQWlCaUYsTUFBakIsQ0FBd0IsVUFBQXhCLEdBQUc7QUFBQSxXQUFJQSxHQUFHLENBQUNaLEtBQUosS0FBYyxNQUFsQjtBQUFBLEdBQTNCLENBQWhCOztBQUNBLE1BQUltQyxPQUFPLENBQUNMLE1BQVIsS0FBbUIzRSxJQUFJLENBQUNrRCxJQUE1QixFQUFrQztBQUNoQ2xELElBQUFBLElBQUksR0FBRyxJQUFJSCxHQUFKLENBQVFtRixPQUFSLENBQVA7QUFDQS9CLElBQUFBLGNBQWMsQ0FBQyxDQUFDLENBQUYsQ0FBZDtBQUNBbEIsSUFBQUEsWUFBWTtBQUNiO0FBQ0Y7O0FBRU0sU0FBU21ELFdBQVQsR0FBNkI7QUFDbEMsTUFBTUYsT0FBTyxHQUFHeEMsS0FBSyxDQUFDQyxJQUFOLENBQVd6QyxJQUFYLEVBQWlCaUYsTUFBakIsQ0FDZCxVQUFBeEIsR0FBRztBQUFBLFdBQUlBLEdBQUcsQ0FBQ1osS0FBSixLQUFjLE9BQWQsSUFBeUJZLEdBQUcsQ0FBQ1osS0FBSixLQUFjLE9BQTNDO0FBQUEsR0FEVyxDQUFoQjs7QUFHQSxNQUFJbUMsT0FBTyxDQUFDTCxNQUFSLEtBQW1CM0UsSUFBSSxDQUFDa0QsSUFBNUIsRUFBa0M7QUFDaENsRCxJQUFBQSxJQUFJLEdBQUcsSUFBSUgsR0FBSixDQUFRbUYsT0FBUixDQUFQO0FBQ0EvQixJQUFBQSxjQUFjLENBQUMsQ0FBQyxDQUFGLENBQWQ7QUFDRDtBQUNGOztBQUVNLFNBQVNrQyxPQUFULENBQWlCMUIsR0FBakIsRUFBdUM7QUFDNUMsTUFBSXpELElBQUksQ0FBQ29GLEdBQUwsQ0FBUzNCLEdBQVQsQ0FBSixFQUFtQjtBQUNqQnpELElBQUFBLElBQUksQ0FBQ3FGLE1BQUwsQ0FBWTVCLEdBQVo7QUFDQTFCLElBQUFBLFlBQVk7QUFDYjtBQUNGOztBQUVNLFNBQVN1RCxnQkFBVCxDQUEwQkwsTUFBMUIsRUFBdUQ7QUFDNUQ3RSxFQUFBQSxhQUFhLEdBQUc2RSxNQUFoQjtBQUNEOztBQUVNLFNBQVNNLFVBQVQsQ0FBb0JDLElBQXBCLEVBQStDO0FBQ3BEekYsRUFBQUEsT0FBTyxHQUFHeUYsSUFBVjtBQUNEOztBQUVNLFNBQVNDLFVBQVQsR0FBZ0M7QUFDckMsU0FBTzFGLE9BQU8sSUFBSSxJQUFYLEdBQWtCQSxPQUFPLEVBQXpCLEdBQThCLElBQXJDO0FBQ0Q7O0FBRU0sU0FBUzJGLGtCQUFULENBQTRCckYsTUFBNUIsRUFBeUQ7QUFDOUQsU0FBT0QsYUFBYSxDQUFDQyxNQUFELENBQXBCO0FBQ0Q7O0FBRU0sU0FBU3NGLGlCQUFULENBQ0xDLFFBREssRUFFQztBQUdOLE1BQU1DLFdBQVcsR0FBR0QsUUFBUSxDQUFDWCxNQUFULENBQWdCLFVBQUNyRCxPQUFELEVBQTRCO0FBQzlELFFBQUlBLE9BQU8sWUFBWUMsTUFBdkIsRUFBK0I7QUFDN0IsNERBQThCL0IsY0FBYyxDQUFDZ0csT0FBZixFQUE5QiwyQ0FBd0Q7QUFBQSxZQUE3Q0MsZUFBNkM7O0FBQ3RELFlBQ0VBLGVBQWUsWUFBWWxFLE1BQTNCLElBQ0FrRSxlQUFlLENBQUNDLFFBQWhCLE9BQStCcEUsT0FBTyxDQUFDb0UsUUFBUixFQUZqQyxFQUdFO0FBQ0EsaUJBQU8sS0FBUDtBQUNEO0FBQ0Y7O0FBQ0QsYUFBTyxJQUFQO0FBQ0Q7O0FBQ0QsV0FBTyxDQUFDbEcsY0FBYyxDQUFDc0YsR0FBZixDQUFtQnhELE9BQW5CLENBQVI7QUFDRCxHQWJtQixDQUFwQjs7QUFlQSxNQUFJaUUsV0FBVyxDQUFDbEIsTUFBWixLQUF1QixDQUEzQixFQUE4QjtBQUM1QjtBQUNEOztBQUNELHdEQUFzQmtCLFdBQXRCLDJDQUFtQztBQUFBLFFBQXhCakUsT0FBd0I7QUFDakM5QixJQUFBQSxjQUFjLENBQUNrRCxHQUFmLENBQW1CcEIsT0FBbkI7QUFNQTVCLElBQUFBLElBQUksR0FBRyxJQUFJSCxHQUFKLENBQ0wyQyxLQUFLLENBQUNDLElBQU4sQ0FBV3pDLElBQVgsRUFBaUJpRixNQUFqQixDQUF3QixVQUFBeEIsR0FBRztBQUFBLGFBQUksQ0FBQzlCLGdCQUFnQixDQUFDOEIsR0FBRyxDQUFDbEMsT0FBSixDQUFZZSxPQUFiLENBQXJCO0FBQUEsS0FBM0IsQ0FESyxDQUFQO0FBR0Q7O0FBQ0RQLEVBQUFBLFlBQVk7QUFDYjs7QUFFTSxTQUFTa0UsV0FBVCxDQUFxQkMsS0FBckIsRUFBMkM7QUFDaEQsTUFBSUEsS0FBSyxLQUFLaEcsV0FBZCxFQUEyQjtBQUN6QjtBQUNEOztBQUNEQSxFQUFBQSxXQUFXLEdBQUdnRyxLQUFkO0FBQ0FuRSxFQUFBQSxZQUFZO0FBQ2I7O0FBRU0sU0FBU2hCLFVBQVQsR0FBK0I7QUFDcEMsU0FBT2IsV0FBUDtBQUNEOztBQUVNLFNBQVNpRyxPQUFULENBQWlCaEUsUUFBakIsRUFBbUQ7QUFDeEQsTUFBTWlFLFlBQVksR0FBRztBQUFDakUsSUFBQUEsUUFBUSxFQUFSQTtBQUFELEdBQXJCO0FBQ0F2QyxFQUFBQSxTQUFTLENBQUNvRCxHQUFWLENBQWNvRCxZQUFkO0FBRUFqRSxFQUFBQSxRQUFRLENBQUNyQixZQUFZLEVBQWIsQ0FBUjtBQUVBLFNBQU87QUFDTHVGLElBQUFBLFdBREsseUJBQ2U7QUFDbEJ6RyxNQUFBQSxTQUFTLENBQUN5RixNQUFWLENBQWlCZSxZQUFqQjtBQUNEO0FBSEksR0FBUDtBQUtEOztBQWtCTSxTQUFTRSxnQkFBVCxDQUNMQyxnQkFESyxFQUUwQjtBQUFBLE1BQ3pCQyx1QkFEeUI7QUFBQTs7QUFBQTs7QUFBQTtBQUFBOztBQUFBOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLFlBWTdCQyxLQVo2QixHQVlyQjtBQUNOekcsUUFBQUEsSUFBSSxFQUFFLElBQUlILEdBQUosRUFEQTtBQUVOa0IsUUFBQUEsVUFBVSxFQUFFLEtBRk47QUFHTjJGLFFBQUFBLFFBQVEsRUFBRSxLQUhKO0FBSU4xRixRQUFBQSxnQkFBZ0IsRUFBRSxDQUFDO0FBSmIsT0FacUI7O0FBQUEsWUErQzdCMkYsY0EvQzZCLEdBK0NaLFlBQVk7QUFJM0IsMEJBQTRDLE1BQUtGLEtBQWpEO0FBQUEsWUFBT3pGLGdCQUFQLGVBQU9BLGdCQUFQO0FBQUEsWUFBK0I0RixTQUEvQixlQUF5QjVHLElBQXpCO0FBQ0EsWUFBTTZHLFNBQVMsR0FBR3JFLEtBQUssQ0FBQ0MsSUFBTixDQUFXbUUsU0FBWCxDQUFsQjs7QUFDQSxZQUFJNUYsZ0JBQWdCLElBQUksSUFBeEIsRUFBOEI7QUFDNUIsY0FBSTZGLFNBQVMsQ0FBQ2xDLE1BQVYsR0FBbUIsQ0FBbkIsSUFBd0IsQ0FBNUIsRUFBK0I7QUFDN0IxQixZQUFBQSxjQUFjLENBQUMsQ0FBQyxDQUFGLENBQWQ7QUFDRCxXQUZELE1BRU8sSUFBSWpDLGdCQUFnQixJQUFJNkYsU0FBUyxDQUFDbEMsTUFBVixHQUFtQixDQUEzQyxFQUE4QztBQUNuRDFCLFlBQUFBLGNBQWMsQ0FBQ2pDLGdCQUFnQixHQUFHLENBQXBCLENBQWQ7QUFDRDs7QUFFRG1FLFVBQUFBLE9BQU8sQ0FBQzBCLFNBQVMsQ0FBQzdGLGdCQUFELENBQVYsQ0FBUDtBQUNEO0FBQ0YsT0E5RDRCOztBQUFBLFlBZ0U3QjhGLGVBaEU2QixHQWdFWCxZQUFZO0FBQzVCN0QsUUFBQUEsY0FBYyxDQUFDLENBQUMsQ0FBRixDQUFkO0FBQ0QsT0FsRTRCOztBQUFBLFlBb0U3QjhELHFCQXBFNkIsR0FvRUwsVUFBQ3JDLEtBQUQsRUFBeUI7QUFDL0N6QixRQUFBQSxjQUFjLENBQUN5QixLQUFELENBQWQ7QUFDRCxPQXRFNEI7O0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUEsYUFNN0IsMkJBQWtCc0MsR0FBbEIsRUFBOEJDLFNBQTlCLEVBQXdFO0FBQ3RFaEcsUUFBQUEsaUJBQWlCLENBQUMrRixHQUFELEVBQU1DLFNBQVMsQ0FBQzlGLGNBQWhCLENBQWpCO0FBQ0Q7QUFSNEI7QUFBQTtBQUFBLGFBbUI3QixrQkFBcUI7QUFDbkIsWUFBSSxLQUFLc0YsS0FBTCxDQUFXQyxRQUFmLEVBQXlCO0FBR3ZCLGlCQUFPLElBQVA7QUFDRDs7QUFFRCxlQUNFLG9CQUFDLGdCQUFEO0FBQ0UsVUFBQSxJQUFJLEVBQUVsRSxLQUFLLENBQUNDLElBQU4sQ0FBVyxLQUFLZ0UsS0FBTCxDQUFXekcsSUFBdEIsQ0FEUjtBQUVFLFVBQUEsVUFBVSxFQUFFLEtBQUt5RyxLQUFMLENBQVcxRixVQUZ6QjtBQUdFLFVBQUEsZ0JBQWdCLEVBQUUsS0FBSzBGLEtBQUwsQ0FBV3pGO0FBSC9CLFVBREY7QUFPRDtBQWpDNEI7QUFBQTtBQUFBLGFBbUM3Qiw2QkFBMEI7QUFBQTs7QUFDeEIsYUFBS2tHLGFBQUwsR0FBcUJmLE9BQU8sQ0FBQyxVQUFBZ0IsSUFBSSxFQUFJO0FBQ25DLFVBQUEsTUFBSSxDQUFDQyxRQUFMLENBQWNELElBQWQ7QUFDRCxTQUYyQixDQUE1QjtBQUdEO0FBdkM0QjtBQUFBO0FBQUEsYUF5QzdCLGdDQUE2QjtBQUMzQixZQUFJLEtBQUtELGFBQUwsSUFBc0IsSUFBMUIsRUFBZ0M7QUFDOUIsZUFBS0EsYUFBTCxDQUFtQmIsV0FBbkI7QUFDRDtBQUNGO0FBN0M0QjtBQUFBO0FBQUEsYUFFN0Isb0NBQWtDO0FBQ2hDLGVBQU87QUFBQ0ssVUFBQUEsUUFBUSxFQUFFO0FBQVgsU0FBUDtBQUNEO0FBSjRCO0FBQUE7QUFBQSxJQUNPVyxLQUFLLENBQUNDLFNBRGI7O0FBeUUvQixTQUFPZCx1QkFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqIEBmb3JtYXRcbiAqL1xuXG4oJ3VzZSBzdHJpY3QnKTtcblxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IExvZ0JveExvZyBmcm9tICcuL0xvZ0JveExvZyc7XG5pbXBvcnQge3BhcnNlTG9nQm94RXhjZXB0aW9ufSBmcm9tICcuL3BhcnNlTG9nQm94TG9nJztcbmltcG9ydCB0eXBlIHtMb2dMZXZlbH0gZnJvbSAnLi9Mb2dCb3hMb2cnO1xuaW1wb3J0IHR5cGUge1xuICBNZXNzYWdlLFxuICBDYXRlZ29yeSxcbiAgQ29tcG9uZW50U3RhY2ssXG4gIEV4dGVuZGVkRXhjZXB0aW9uRGF0YSxcbn0gZnJvbSAnLi9wYXJzZUxvZ0JveExvZyc7XG5pbXBvcnQgcGFyc2VFcnJvclN0YWNrIGZyb20gJy4uLy4uL0NvcmUvRGV2dG9vbHMvcGFyc2VFcnJvclN0YWNrJztcbmltcG9ydCB0eXBlIHtFeHRlbmRlZEVycm9yfSBmcm9tICcuLi8uLi9Db3JlL0RldnRvb2xzL3BhcnNlRXJyb3JTdGFjayc7XG5pbXBvcnQgTmF0aXZlTG9nQm94IGZyb20gJy4uLy4uL05hdGl2ZU1vZHVsZXMvc3BlY3MvTmF0aXZlTG9nQm94JztcbmV4cG9ydCB0eXBlIExvZ0JveExvZ3MgPSBTZXQ8TG9nQm94TG9nPjtcbmV4cG9ydCB0eXBlIExvZ0RhdGEgPSAkUmVhZE9ubHk8e3xcbiAgbGV2ZWw6IExvZ0xldmVsLFxuICBtZXNzYWdlOiBNZXNzYWdlLFxuICBjYXRlZ29yeTogQ2F0ZWdvcnksXG4gIGNvbXBvbmVudFN0YWNrOiBDb21wb25lbnRTdGFjayxcbnx9PjtcblxuZXhwb3J0IHR5cGUgT2JzZXJ2ZXIgPSAoXG4gICRSZWFkT25seTx7fFxuICAgIGxvZ3M6IExvZ0JveExvZ3MsXG4gICAgaXNEaXNhYmxlZDogYm9vbGVhbixcbiAgICBzZWxlY3RlZExvZ0luZGV4OiBudW1iZXIsXG4gIHx9PixcbikgPT4gdm9pZDtcblxuZXhwb3J0IHR5cGUgSWdub3JlUGF0dGVybiA9IHN0cmluZyB8IFJlZ0V4cDtcblxuZXhwb3J0IHR5cGUgU3Vic2NyaXB0aW9uID0gJFJlYWRPbmx5PHt8XG4gIHVuc3Vic2NyaWJlOiAoKSA9PiB2b2lkLFxufH0+O1xuXG5leHBvcnQgdHlwZSBXYXJuaW5nSW5mbyA9IHt8XG4gIGZpbmFsRm9ybWF0OiBzdHJpbmcsXG4gIGZvcmNlRGlhbG9nSW1tZWRpYXRlbHk6IGJvb2xlYW4sXG4gIHN1cHByZXNzRGlhbG9nX0xFR0FDWTogYm9vbGVhbixcbiAgc3VwcHJlc3NDb21wbGV0ZWx5OiBib29sZWFuLFxuICBtb25pdG9yRXZlbnQ6IHN0cmluZyB8IG51bGwsXG4gIG1vbml0b3JMaXN0VmVyc2lvbjogbnVtYmVyLFxuICBtb25pdG9yU2FtcGxlUmF0ZTogbnVtYmVyLFxufH07XG5cbmV4cG9ydCB0eXBlIFdhcm5pbmdGaWx0ZXIgPSAoZm9ybWF0OiBzdHJpbmcpID0+IFdhcm5pbmdJbmZvO1xuXG50eXBlIEFwcEluZm8gPSAkUmVhZE9ubHk8e3xcbiAgYXBwVmVyc2lvbjogc3RyaW5nLFxuICBlbmdpbmU6IHN0cmluZyxcbiAgb25QcmVzcz86ID8oKSA9PiB2b2lkLFxufH0+O1xuXG5jb25zdCBvYnNlcnZlcnM6IFNldDx7b2JzZXJ2ZXI6IE9ic2VydmVyLCAuLi59PiA9IG5ldyBTZXQoKTtcbmNvbnN0IGlnbm9yZVBhdHRlcm5zOiBTZXQ8SWdub3JlUGF0dGVybj4gPSBuZXcgU2V0KCk7XG5sZXQgYXBwSW5mbzogPygpID0+IEFwcEluZm8gPSBudWxsO1xubGV0IGxvZ3M6IExvZ0JveExvZ3MgPSBuZXcgU2V0KCk7XG5sZXQgdXBkYXRlVGltZW91dCA9IG51bGw7XG5sZXQgX2lzRGlzYWJsZWQgPSBmYWxzZTtcbmxldCBfc2VsZWN0ZWRJbmRleCA9IC0xO1xuXG5sZXQgd2FybmluZ0ZpbHRlcjogV2FybmluZ0ZpbHRlciA9IGZ1bmN0aW9uKGZvcm1hdCkge1xuICByZXR1cm4ge1xuICAgIGZpbmFsRm9ybWF0OiBmb3JtYXQsXG4gICAgZm9yY2VEaWFsb2dJbW1lZGlhdGVseTogZmFsc2UsXG4gICAgc3VwcHJlc3NEaWFsb2dfTEVHQUNZOiB0cnVlLFxuICAgIHN1cHByZXNzQ29tcGxldGVseTogZmFsc2UsXG4gICAgbW9uaXRvckV2ZW50OiAndW5rbm93bicsXG4gICAgbW9uaXRvckxpc3RWZXJzaW9uOiAwLFxuICAgIG1vbml0b3JTYW1wbGVSYXRlOiAxLFxuICB9O1xufTtcblxuY29uc3QgTE9HQk9YX0VSUk9SX01FU1NBR0UgPVxuICAnQW4gZXJyb3Igd2FzIHRocm93biB3aGVuIGF0dGVtcHRpbmcgdG8gcmVuZGVyIGxvZyBtZXNzYWdlcyB2aWEgTG9nQm94Lic7XG5cbmZ1bmN0aW9uIGdldE5leHRTdGF0ZSgpIHtcbiAgcmV0dXJuIHtcbiAgICBsb2dzLFxuICAgIGlzRGlzYWJsZWQ6IF9pc0Rpc2FibGVkLFxuICAgIHNlbGVjdGVkTG9nSW5kZXg6IF9zZWxlY3RlZEluZGV4LFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVwb3J0TG9nQm94RXJyb3IoXG4gIGVycm9yOiBFeHRlbmRlZEVycm9yLFxuICBjb21wb25lbnRTdGFjaz86IHN0cmluZyxcbik6IHZvaWQge1xuICBjb25zdCBFeGNlcHRpb25zTWFuYWdlciA9IHJlcXVpcmUoJy4uLy4uL0NvcmUvRXhjZXB0aW9uc01hbmFnZXInKTtcblxuICBlcnJvci5mb3JjZVJlZGJveCA9IHRydWU7XG4gIGVycm9yLm1lc3NhZ2UgPSBgJHtMT0dCT1hfRVJST1JfTUVTU0FHRX1cXG5cXG4ke2Vycm9yLm1lc3NhZ2V9YDtcbiAgaWYgKGNvbXBvbmVudFN0YWNrICE9IG51bGwpIHtcbiAgICBlcnJvci5jb21wb25lbnRTdGFjayA9IGNvbXBvbmVudFN0YWNrO1xuICB9XG4gIEV4Y2VwdGlvbnNNYW5hZ2VyLmhhbmRsZUV4Y2VwdGlvbihlcnJvciwgLyogaXNGYXRhbCAqLyB0cnVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzTG9nQm94RXJyb3JNZXNzYWdlKG1lc3NhZ2U6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gdHlwZW9mIG1lc3NhZ2UgPT09ICdzdHJpbmcnICYmIG1lc3NhZ2UuaW5jbHVkZXMoTE9HQk9YX0VSUk9SX01FU1NBR0UpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNNZXNzYWdlSWdub3JlZChtZXNzYWdlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGlnbm9yZVBhdHRlcm5zKSB7XG4gICAgaWYgKFxuICAgICAgKHBhdHRlcm4gaW5zdGFuY2VvZiBSZWdFeHAgJiYgcGF0dGVybi50ZXN0KG1lc3NhZ2UpKSB8fFxuICAgICAgKHR5cGVvZiBwYXR0ZXJuID09PSAnc3RyaW5nJyAmJiBtZXNzYWdlLmluY2x1ZGVzKHBhdHRlcm4pKVxuICAgICkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlVXBkYXRlKCk6IHZvaWQge1xuICBpZiAodXBkYXRlVGltZW91dCA9PSBudWxsKSB7XG4gICAgdXBkYXRlVGltZW91dCA9IHNldEltbWVkaWF0ZSgoKSA9PiB7XG4gICAgICB1cGRhdGVUaW1lb3V0ID0gbnVsbDtcbiAgICAgIGNvbnN0IG5leHRTdGF0ZSA9IGdldE5leHRTdGF0ZSgpO1xuICAgICAgb2JzZXJ2ZXJzLmZvckVhY2goKHtvYnNlcnZlcn0pID0+IG9ic2VydmVyKG5leHRTdGF0ZSkpO1xuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFwcGVuZE5ld0xvZyhuZXdMb2cpIHtcbiAgLy8gV2UgZG9uJ3Qgd2FudCB0byBzdG9yZSB0aGVzZSBsb2dzIGJlY2F1c2UgdGhleSB0cmlnZ2VyIGFcbiAgLy8gc3RhdGUgdXBkYXRlIHdoZW5ldmVyIHdlIGFkZCB0aGVtIHRvIHRoZSBzdG9yZSwgd2hpY2ggaXNcbiAgLy8gZXhwZW5zaXZlIHRvIG5vaXN5IGxvZ3MuIElmIHdlIGxhdGVyIHdhbnQgdG8gZGlzcGxheSB0aGVzZVxuICAvLyB3ZSB3aWxsIHN0b3JlIHRoZW0gaW4gYSBkaWZmZXJlbnQgc3RhdGUgb2JqZWN0LlxuICBpZiAoaXNNZXNzYWdlSWdub3JlZChuZXdMb2cubWVzc2FnZS5jb250ZW50KSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIElmIHRoZSBuZXh0IGxvZyBoYXMgdGhlIHNhbWUgY2F0ZWdvcnkgYXMgdGhlIHByZXZpb3VzIG9uZVxuICAvLyB0aGVuIHdlIHdhbnQgdG8gcm9sbCBpdCB1cCBpbnRvIHRoZSBsYXN0IGxvZyBpbiB0aGUgbGlzdFxuICAvLyBieSBpbmNyZW1lbnRpbmcgdGhlIGNvdW50IChzaW1hciB0byBob3cgQ2hyb21lIGRvZXMgaXQpLlxuICBjb25zdCBsYXN0TG9nID0gQXJyYXkuZnJvbShsb2dzKS5wb3AoKTtcbiAgaWYgKGxhc3RMb2cgJiYgbGFzdExvZy5jYXRlZ29yeSA9PT0gbmV3TG9nLmNhdGVnb3J5KSB7XG4gICAgbGFzdExvZy5pbmNyZW1lbnRDb3VudCgpO1xuICAgIGhhbmRsZVVwZGF0ZSgpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChuZXdMb2cubGV2ZWwgPT09ICdmYXRhbCcpIHtcbiAgICAvLyBJZiBwb3NzaWJsZSwgdG8gYXZvaWQgamFuaywgd2UgZG9uJ3Qgd2FudCB0byBvcGVuIHRoZSBlcnJvciBiZWZvcmVcbiAgICAvLyBpdCdzIHN5bWJvbGljYXRlZC4gVG8gZG8gdGhhdCwgd2Ugb3B0aW1pc3RpY2FsbHkgd2FpdCBmb3JcbiAgICAvLyBzeWJvbGljYXRpb24gZm9yIHVwIHRvIGEgc2Vjb25kIGJlZm9yZSBhZGRpbmcgdGhlIGxvZy5cbiAgICBjb25zdCBPUFRJTUlTVElDX1dBSVRfVElNRSA9IDEwMDA7XG5cbiAgICBsZXQgYWRkUGVuZGluZ0xvZyA9ICgpID0+IHtcbiAgICAgIGxvZ3MuYWRkKG5ld0xvZyk7XG4gICAgICBpZiAoX3NlbGVjdGVkSW5kZXggPD0gMCkge1xuICAgICAgICBzZXRTZWxlY3RlZExvZyhsb2dzLnNpemUgLSAxKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhhbmRsZVVwZGF0ZSgpO1xuICAgICAgfVxuICAgICAgYWRkUGVuZGluZ0xvZyA9IG51bGw7XG4gICAgfTtcblxuICAgIGNvbnN0IG9wdGltaXN0aWNUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAoYWRkUGVuZGluZ0xvZykge1xuICAgICAgICBhZGRQZW5kaW5nTG9nKCk7XG4gICAgICB9XG4gICAgfSwgT1BUSU1JU1RJQ19XQUlUX1RJTUUpO1xuXG4gICAgbmV3TG9nLnN5bWJvbGljYXRlKHN0YXR1cyA9PiB7XG4gICAgICBpZiAoYWRkUGVuZGluZ0xvZyAmJiBzdGF0dXMgIT09ICdQRU5ESU5HJykge1xuICAgICAgICBhZGRQZW5kaW5nTG9nKCk7XG4gICAgICAgIGNsZWFyVGltZW91dChvcHRpbWlzdGljVGltZW91dCk7XG4gICAgICB9IGVsc2UgaWYgKHN0YXR1cyAhPT0gJ1BFTkRJTkcnKSB7XG4gICAgICAgIC8vIFRoZSBsb2cgaGFzIGFscmVhZHkgYmVlbiBhZGRlZCBidXQgd2UgbmVlZCB0byB0cmlnZ2VyIGEgcmVuZGVyLlxuICAgICAgICBoYW5kbGVVcGRhdGUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIGlmIChuZXdMb2cubGV2ZWwgPT09ICdzeW50YXgnKSB7XG4gICAgbG9ncy5hZGQobmV3TG9nKTtcbiAgICBzZXRTZWxlY3RlZExvZyhsb2dzLnNpemUgLSAxKTtcbiAgfSBlbHNlIHtcbiAgICBsb2dzLmFkZChuZXdMb2cpO1xuICAgIGhhbmRsZVVwZGF0ZSgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRMb2cobG9nOiBMb2dEYXRhKTogdm9pZCB7XG4gIGNvbnN0IGVycm9yRm9yU3RhY2tUcmFjZSA9IG5ldyBFcnJvcigpO1xuXG4gIC8vIFBhcnNpbmcgbG9ncyBhcmUgZXhwZW5zaXZlIHNvIHdlIHNjaGVkdWxlIHRoaXNcbiAgLy8gb3RoZXJ3aXNlIHNwYW1teSBsb2dzIHdvdWxkIHBhdXNlIHJlbmRlcmluZy5cbiAgc2V0SW1tZWRpYXRlKCgpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVE9ETzogVXNlIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlIG9uIEhlcm1lc1xuICAgICAgY29uc3Qgc3RhY2sgPSBwYXJzZUVycm9yU3RhY2soZXJyb3JGb3JTdGFja1RyYWNlKTtcblxuICAgICAgYXBwZW5kTmV3TG9nKFxuICAgICAgICBuZXcgTG9nQm94TG9nKHtcbiAgICAgICAgICBsZXZlbDogbG9nLmxldmVsLFxuICAgICAgICAgIG1lc3NhZ2U6IGxvZy5tZXNzYWdlLFxuICAgICAgICAgIGlzQ29tcG9uZW50RXJyb3I6IGZhbHNlLFxuICAgICAgICAgIHN0YWNrLFxuICAgICAgICAgIGNhdGVnb3J5OiBsb2cuY2F0ZWdvcnksXG4gICAgICAgICAgY29tcG9uZW50U3RhY2s6IGxvZy5jb21wb25lbnRTdGFjayxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXBvcnRMb2dCb3hFcnJvcihlcnJvcik7XG4gICAgfVxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZEV4Y2VwdGlvbihlcnJvcjogRXh0ZW5kZWRFeGNlcHRpb25EYXRhKTogdm9pZCB7XG4gIC8vIFBhcnNpbmcgbG9ncyBhcmUgZXhwZW5zaXZlIHNvIHdlIHNjaGVkdWxlIHRoaXNcbiAgLy8gb3RoZXJ3aXNlIHNwYW1teSBsb2dzIHdvdWxkIHBhdXNlIHJlbmRlcmluZy5cbiAgc2V0SW1tZWRpYXRlKCgpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXBwZW5kTmV3TG9nKG5ldyBMb2dCb3hMb2cocGFyc2VMb2dCb3hFeGNlcHRpb24oZXJyb3IpKSk7XG4gICAgfSBjYXRjaCAobG9nZ2luZ0Vycm9yKSB7XG4gICAgICByZXBvcnRMb2dCb3hFcnJvcihsb2dnaW5nRXJyb3IpO1xuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzeW1ib2xpY2F0ZUxvZ05vdyhsb2c6IExvZ0JveExvZykge1xuICBsb2cuc3ltYm9saWNhdGUoKCkgPT4ge1xuICAgIGhhbmRsZVVwZGF0ZSgpO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJldHJ5U3ltYm9saWNhdGVMb2dOb3cobG9nOiBMb2dCb3hMb2cpIHtcbiAgbG9nLnJldHJ5U3ltYm9saWNhdGUoKCkgPT4ge1xuICAgIGhhbmRsZVVwZGF0ZSgpO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN5bWJvbGljYXRlTG9nTGF6eShsb2c6IExvZ0JveExvZykge1xuICBsb2cuc3ltYm9saWNhdGUoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyKCk6IHZvaWQge1xuICBpZiAobG9ncy5zaXplID4gMCkge1xuICAgIGxvZ3MgPSBuZXcgU2V0KCk7XG4gICAgc2V0U2VsZWN0ZWRMb2coLTEpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRTZWxlY3RlZExvZyhwcm9wb3NlZE5ld0luZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgY29uc3Qgb2xkSW5kZXggPSBfc2VsZWN0ZWRJbmRleDtcbiAgbGV0IG5ld0luZGV4ID0gcHJvcG9zZWROZXdJbmRleDtcblxuICBjb25zdCBsb2dBcnJheSA9IEFycmF5LmZyb20obG9ncyk7XG4gIGxldCBpbmRleCA9IGxvZ0FycmF5Lmxlbmd0aCAtIDE7XG4gIHdoaWxlIChpbmRleCA+PSAwKSB7XG4gICAgLy8gVGhlIGxhdGVzdCBzeW50YXggZXJyb3IgaXMgc2VsZWN0ZWQgYW5kIGRpc3BsYXllZCBiZWZvcmUgYWxsIG90aGVyIGxvZ3MuXG4gICAgaWYgKGxvZ0FycmF5W2luZGV4XS5sZXZlbCA9PT0gJ3N5bnRheCcpIHtcbiAgICAgIG5ld0luZGV4ID0gaW5kZXg7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgaW5kZXggLT0gMTtcbiAgfVxuICBfc2VsZWN0ZWRJbmRleCA9IG5ld0luZGV4O1xuICBoYW5kbGVVcGRhdGUoKTtcbiAgaWYgKE5hdGl2ZUxvZ0JveCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKG9sZEluZGV4IDwgMCAmJiBuZXdJbmRleCA+PSAwKSB7XG4gICAgICAgIE5hdGl2ZUxvZ0JveC5zaG93KCk7XG4gICAgICB9IGVsc2UgaWYgKG9sZEluZGV4ID49IDAgJiYgbmV3SW5kZXggPCAwKSB7XG4gICAgICAgIE5hdGl2ZUxvZ0JveC5oaWRlKCk7XG4gICAgICB9XG4gICAgfSwgMCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyV2FybmluZ3MoKTogdm9pZCB7XG4gIGNvbnN0IG5ld0xvZ3MgPSBBcnJheS5mcm9tKGxvZ3MpLmZpbHRlcihsb2cgPT4gbG9nLmxldmVsICE9PSAnd2FybicpO1xuICBpZiAobmV3TG9ncy5sZW5ndGggIT09IGxvZ3Muc2l6ZSkge1xuICAgIGxvZ3MgPSBuZXcgU2V0KG5ld0xvZ3MpO1xuICAgIHNldFNlbGVjdGVkTG9nKC0xKTtcbiAgICBoYW5kbGVVcGRhdGUoKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJFcnJvcnMoKTogdm9pZCB7XG4gIGNvbnN0IG5ld0xvZ3MgPSBBcnJheS5mcm9tKGxvZ3MpLmZpbHRlcihcbiAgICBsb2cgPT4gbG9nLmxldmVsICE9PSAnZXJyb3InICYmIGxvZy5sZXZlbCAhPT0gJ2ZhdGFsJyxcbiAgKTtcbiAgaWYgKG5ld0xvZ3MubGVuZ3RoICE9PSBsb2dzLnNpemUpIHtcbiAgICBsb2dzID0gbmV3IFNldChuZXdMb2dzKTtcbiAgICBzZXRTZWxlY3RlZExvZygtMSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRpc21pc3MobG9nOiBMb2dCb3hMb2cpOiB2b2lkIHtcbiAgaWYgKGxvZ3MuaGFzKGxvZykpIHtcbiAgICBsb2dzLmRlbGV0ZShsb2cpO1xuICAgIGhhbmRsZVVwZGF0ZSgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRXYXJuaW5nRmlsdGVyKGZpbHRlcjogV2FybmluZ0ZpbHRlcik6IHZvaWQge1xuICB3YXJuaW5nRmlsdGVyID0gZmlsdGVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0QXBwSW5mbyhpbmZvOiAoKSA9PiBBcHBJbmZvKTogdm9pZCB7XG4gIGFwcEluZm8gPSBpbmZvO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBwSW5mbygpOiA/QXBwSW5mbyB7XG4gIHJldHVybiBhcHBJbmZvICE9IG51bGwgPyBhcHBJbmZvKCkgOiBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tXYXJuaW5nRmlsdGVyKGZvcm1hdDogc3RyaW5nKTogV2FybmluZ0luZm8ge1xuICByZXR1cm4gd2FybmluZ0ZpbHRlcihmb3JtYXQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkSWdub3JlUGF0dGVybnMoXG4gIHBhdHRlcm5zOiAkUmVhZE9ubHlBcnJheTxJZ25vcmVQYXR0ZXJuPixcbik6IHZvaWQge1xuICAvLyBUaGUgc2FtZSBwYXR0ZXJuIG1heSBiZSBhZGRlZCBtdWx0aXBsZSB0aW1lcywgYnV0IGFkZGluZyBhIG5ldyBwYXR0ZXJuXG4gIC8vIGNhbiBiZSBleHBlbnNpdmUgc28gbGV0J3MgZmluZCBvbmx5IHRoZSBvbmVzIHRoYXQgYXJlIG5ldy5cbiAgY29uc3QgbmV3UGF0dGVybnMgPSBwYXR0ZXJucy5maWx0ZXIoKHBhdHRlcm46IElnbm9yZVBhdHRlcm4pID0+IHtcbiAgICBpZiAocGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgICAgZm9yIChjb25zdCBleGlzdGluZ1BhdHRlcm4gb2YgaWdub3JlUGF0dGVybnMuZW50cmllcygpKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBleGlzdGluZ1BhdHRlcm4gaW5zdGFuY2VvZiBSZWdFeHAgJiZcbiAgICAgICAgICBleGlzdGluZ1BhdHRlcm4udG9TdHJpbmcoKSA9PT0gcGF0dGVybi50b1N0cmluZygpXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiAhaWdub3JlUGF0dGVybnMuaGFzKHBhdHRlcm4pO1xuICB9KTtcblxuICBpZiAobmV3UGF0dGVybnMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBuZXdQYXR0ZXJucykge1xuICAgIGlnbm9yZVBhdHRlcm5zLmFkZChwYXR0ZXJuKTtcblxuICAgIC8vIFdlIG5lZWQgdG8gcmVjaGVjayBhbGwgb2YgdGhlIGV4aXN0aW5nIGxvZ3MuXG4gICAgLy8gVGhpcyBhbGxvd3MgYWRkaW5nIGFuIGlnbm9yZSBwYXR0ZXJuIGFueXdoZXJlIGluIHRoZSBjb2RlYmFzZS5cbiAgICAvLyBXaXRob3V0IHRoaXMsIGlmIHlvdSBpZ25vcmUgYSBwYXR0ZXJuIGFmdGVyIHRoZSBhIGxvZyBpcyBjcmVhdGVkLFxuICAgIC8vIHRoZW4gd2Ugd291bGQga2VlcCBzaG93aW5nIHRoZSBsb2cuXG4gICAgbG9ncyA9IG5ldyBTZXQoXG4gICAgICBBcnJheS5mcm9tKGxvZ3MpLmZpbHRlcihsb2cgPT4gIWlzTWVzc2FnZUlnbm9yZWQobG9nLm1lc3NhZ2UuY29udGVudCkpLFxuICAgICk7XG4gIH1cbiAgaGFuZGxlVXBkYXRlKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXREaXNhYmxlZCh2YWx1ZTogYm9vbGVhbik6IHZvaWQge1xuICBpZiAodmFsdWUgPT09IF9pc0Rpc2FibGVkKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIF9pc0Rpc2FibGVkID0gdmFsdWU7XG4gIGhhbmRsZVVwZGF0ZSgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNEaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgcmV0dXJuIF9pc0Rpc2FibGVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb2JzZXJ2ZShvYnNlcnZlcjogT2JzZXJ2ZXIpOiBTdWJzY3JpcHRpb24ge1xuICBjb25zdCBzdWJzY3JpcHRpb24gPSB7b2JzZXJ2ZXJ9O1xuICBvYnNlcnZlcnMuYWRkKHN1YnNjcmlwdGlvbik7XG5cbiAgb2JzZXJ2ZXIoZ2V0TmV4dFN0YXRlKCkpO1xuXG4gIHJldHVybiB7XG4gICAgdW5zdWJzY3JpYmUoKTogdm9pZCB7XG4gICAgICBvYnNlcnZlcnMuZGVsZXRlKHN1YnNjcmlwdGlvbik7XG4gICAgfSxcbiAgfTtcbn1cblxudHlwZSBQcm9wcyA9ICRSZWFkT25seTx7fHx9PjtcbnR5cGUgU3RhdGUgPSAkUmVhZE9ubHk8e3xcbiAgbG9nczogTG9nQm94TG9ncyxcbiAgaXNEaXNhYmxlZDogYm9vbGVhbixcbiAgaGFzRXJyb3I6IGJvb2xlYW4sXG4gIHNlbGVjdGVkTG9nSW5kZXg6IG51bWJlcixcbnx9PjtcblxudHlwZSBTdWJzY3JpYmVkQ29tcG9uZW50ID0gUmVhY3QuQWJzdHJhY3RDb21wb25lbnQ8XG4gICRSZWFkT25seTx7fFxuICAgIGxvZ3M6ICRSZWFkT25seUFycmF5PExvZ0JveExvZz4sXG4gICAgaXNEaXNhYmxlZDogYm9vbGVhbixcbiAgICBzZWxlY3RlZExvZ0luZGV4OiBudW1iZXIsXG4gIHx9Pixcbj47XG5cbmV4cG9ydCBmdW5jdGlvbiB3aXRoU3Vic2NyaXB0aW9uKFxuICBXcmFwcGVkQ29tcG9uZW50OiBTdWJzY3JpYmVkQ29tcG9uZW50LFxuKTogUmVhY3QuQWJzdHJhY3RDb21wb25lbnQ8e3x8fT4ge1xuICBjbGFzcyBMb2dCb3hTdGF0ZVN1YnNjcmlwdGlvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcbiAgICBzdGF0aWMgZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKCkge1xuICAgICAgcmV0dXJuIHtoYXNFcnJvcjogdHJ1ZX07XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkQ2F0Y2goZXJyOiBFcnJvciwgZXJyb3JJbmZvOiB7Y29tcG9uZW50U3RhY2s6IHN0cmluZywgLi4ufSkge1xuICAgICAgcmVwb3J0TG9nQm94RXJyb3IoZXJyLCBlcnJvckluZm8uY29tcG9uZW50U3RhY2spO1xuICAgIH1cblxuICAgIF9zdWJzY3JpcHRpb246ID9TdWJzY3JpcHRpb247XG5cbiAgICBzdGF0ZSA9IHtcbiAgICAgIGxvZ3M6IG5ldyBTZXQoKSxcbiAgICAgIGlzRGlzYWJsZWQ6IGZhbHNlLFxuICAgICAgaGFzRXJyb3I6IGZhbHNlLFxuICAgICAgc2VsZWN0ZWRMb2dJbmRleDogLTEsXG4gICAgfTtcblxuICAgIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcbiAgICAgIGlmICh0aGlzLnN0YXRlLmhhc0Vycm9yKSB7XG4gICAgICAgIC8vIFRoaXMgaGFwcGVucyB3aGVuIHRoZSBjb21wb25lbnQgZmFpbGVkIHRvIHJlbmRlciwgaW4gd2hpY2ggY2FzZSB3ZSBkZWxlZ2F0ZSB0byB0aGUgbmF0aXZlIHJlZGJveC5cbiAgICAgICAgLy8gV2UgY2FuJ3Qgc2hvdyBhbnliYWNrIGZhbGxiYWNrIFVJIGhlcmUsIGJlY2F1c2UgdGhlIGVycm9yIG1heSBiZSB3aXRoIDxWaWV3PiBvciA8VGV4dD4uXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8V3JhcHBlZENvbXBvbmVudFxuICAgICAgICAgIGxvZ3M9e0FycmF5LmZyb20odGhpcy5zdGF0ZS5sb2dzKX1cbiAgICAgICAgICBpc0Rpc2FibGVkPXt0aGlzLnN0YXRlLmlzRGlzYWJsZWR9XG4gICAgICAgICAgc2VsZWN0ZWRMb2dJbmRleD17dGhpcy5zdGF0ZS5zZWxlY3RlZExvZ0luZGV4fVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbiA9IG9ic2VydmUoZGF0YSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoZGF0YSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpOiB2b2lkIHtcbiAgICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb24gIT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBfaGFuZGxlRGlzbWlzcyA9ICgpOiB2b2lkID0+IHtcbiAgICAgIC8vIEhlcmUgd2UgaGFuZGxlIHRoZSBjYXNlcyB3aGVuIHRoZSBsb2cgaXMgZGlzbWlzc2VkIGFuZCBpdFxuICAgICAgLy8gd2FzIGVpdGhlciB0aGUgbGFzdCBsb2csIG9yIHdoZW4gdGhlIGN1cnJlbnQgaW5kZXhcbiAgICAgIC8vIGlzIG5vdyBvdXRzaWRlIHRoZSBib3VuZHMgb2YgdGhlIGxvZyBhcnJheS5cbiAgICAgIGNvbnN0IHtzZWxlY3RlZExvZ0luZGV4LCBsb2dzOiBzdGF0ZUxvZ3N9ID0gdGhpcy5zdGF0ZTtcbiAgICAgIGNvbnN0IGxvZ3NBcnJheSA9IEFycmF5LmZyb20oc3RhdGVMb2dzKTtcbiAgICAgIGlmIChzZWxlY3RlZExvZ0luZGV4ICE9IG51bGwpIHtcbiAgICAgICAgaWYgKGxvZ3NBcnJheS5sZW5ndGggLSAxIDw9IDApIHtcbiAgICAgICAgICBzZXRTZWxlY3RlZExvZygtMSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRMb2dJbmRleCA+PSBsb2dzQXJyYXkubGVuZ3RoIC0gMSkge1xuICAgICAgICAgIHNldFNlbGVjdGVkTG9nKHNlbGVjdGVkTG9nSW5kZXggLSAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRpc21pc3MobG9nc0FycmF5W3NlbGVjdGVkTG9nSW5kZXhdKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgX2hhbmRsZU1pbmltaXplID0gKCk6IHZvaWQgPT4ge1xuICAgICAgc2V0U2VsZWN0ZWRMb2coLTEpO1xuICAgIH07XG5cbiAgICBfaGFuZGxlU2V0U2VsZWN0ZWRMb2cgPSAoaW5kZXg6IG51bWJlcik6IHZvaWQgPT4ge1xuICAgICAgc2V0U2VsZWN0ZWRMb2coaW5kZXgpO1xuICAgIH07XG4gIH1cblxuICByZXR1cm4gTG9nQm94U3RhdGVTdWJzY3JpcHRpb247XG59XG4iXX0=