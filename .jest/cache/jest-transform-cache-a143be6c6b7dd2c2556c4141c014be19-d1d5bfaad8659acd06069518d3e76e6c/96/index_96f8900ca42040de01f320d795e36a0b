af52ea2c2c9cbb01d079cab5d2320679
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DEFAULT_FALL_SPEED = exports.DEFAULT_EXPLOSION_SPEED = exports.DEFAULT_COLORS = exports.TOP_MIN = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _confetti = _interopRequireDefault(require("./components/confetti"));

var _utils = require("./utils");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var TOP_MIN = 0.7;
exports.TOP_MIN = TOP_MIN;
var DEFAULT_COLORS = ['#e67e22', '#2ecc71', '#3498db', '#84AAC2', '#E6D68D', '#F67933', '#42A858', '#4F50A2', '#A86BB7', '#e74c3c', '#1abc9c'];
exports.DEFAULT_COLORS = DEFAULT_COLORS;
var DEFAULT_EXPLOSION_SPEED = 350;
exports.DEFAULT_EXPLOSION_SPEED = DEFAULT_EXPLOSION_SPEED;
var DEFAULT_FALL_SPEED = 3000;
exports.DEFAULT_FALL_SPEED = DEFAULT_FALL_SPEED;

var Explosion = function (_React$PureComponent) {
  (0, _inherits2.default)(Explosion, _React$PureComponent);

  var _super = _createSuper(Explosion);

  function Explosion(props) {
    var _this;

    (0, _classCallCheck2.default)(this, Explosion);
    _this = _super.call(this, props);
    _this.state = {
      items: []
    };
    _this.items = [];
    _this.animation = new _reactNative.Animated.Value(0);

    _this.componentDidMount = function () {
      var _this$props = _this.props,
          _this$props$autoStart = _this$props.autoStart,
          autoStart = _this$props$autoStart === void 0 ? true : _this$props$autoStart,
          _this$props$autoStart2 = _this$props.autoStartDelay,
          autoStartDelay = _this$props$autoStart2 === void 0 ? 0 : _this$props$autoStart2;

      if (autoStart) {
        setTimeout(_this.start, autoStartDelay);
      }
    };

    _this.componentDidUpdate = function (_ref) {
      var prevCount = _ref.count,
          _ref$colors = _ref.colors,
          prevColors = _ref$colors === void 0 ? DEFAULT_COLORS : _ref$colors;
      var _this$props2 = _this.props,
          count = _this$props2.count,
          _this$props2$colors = _this$props2.colors,
          colors = _this$props2$colors === void 0 ? DEFAULT_COLORS : _this$props2$colors;

      if (count !== prevCount || colors !== prevColors) {
        _this.setState({
          items: _this.getItems(prevColors)
        });
      }
    };

    _this.getItems = function (prevColors) {
      var _this$props3 = _this.props,
          count = _this$props3.count,
          _this$props3$colors = _this$props3.colors,
          colors = _this$props3$colors === void 0 ? DEFAULT_COLORS : _this$props3$colors;
      var items = _this.state.items;
      var difference = items.length < count ? count - items.length : 0;
      var newItems = Array(difference).fill().map(function () {
        return {
          leftDelta: (0, _utils.randomValue)(0, 1),
          topDelta: (0, _utils.randomValue)(TOP_MIN, 1),
          swingDelta: (0, _utils.randomValue)(0.2, 1),
          speedDelta: {
            rotateX: (0, _utils.randomValue)(0.3, 1),
            rotateY: (0, _utils.randomValue)(0.3, 1),
            rotateZ: (0, _utils.randomValue)(0.3, 1)
          },
          color: (0, _utils.randomColor)(colors)
        };
      });
      return items.slice(0, count).concat(newItems).map(function (item) {
        return _objectSpread(_objectSpread({}, item), {}, {
          color: prevColors !== colors ? (0, _utils.randomColor)(colors) : item.color
        });
      });
    };

    _this.start = function () {
      var resume = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      var _this$props4 = _this.props,
          _this$props4$explosio = _this$props4.explosionSpeed,
          explosionSpeed = _this$props4$explosio === void 0 ? DEFAULT_EXPLOSION_SPEED : _this$props4$explosio,
          _this$props4$fallSpee = _this$props4.fallSpeed,
          fallSpeed = _this$props4$fallSpee === void 0 ? DEFAULT_FALL_SPEED : _this$props4$fallSpee,
          onAnimationStart = _this$props4.onAnimationStart,
          onAnimationResume = _this$props4.onAnimationResume,
          onAnimationEnd = _this$props4.onAnimationEnd;

      if (resume) {
        onAnimationResume && onAnimationResume();
      } else {
        _this.sequence = _reactNative.Animated.sequence([_reactNative.Animated.timing(_this.animation, {
          toValue: 0,
          duration: 0,
          useNativeDriver: true
        }), _reactNative.Animated.timing(_this.animation, {
          toValue: 1,
          duration: explosionSpeed,
          easing: _reactNative.Easing.out(_reactNative.Easing.quad),
          useNativeDriver: true
        }), _reactNative.Animated.timing(_this.animation, {
          toValue: 2,
          duration: fallSpeed,
          easing: _reactNative.Easing.quad,
          useNativeDriver: true
        })]);
        onAnimationStart && onAnimationStart();
      }

      _this.sequence && _this.sequence.start(function (_ref2) {
        var finished = _ref2.finished;

        if (finished) {
          onAnimationEnd && onAnimationEnd();
        }
      });
    };

    _this.resume = function () {
      return _this.start(true);
    };

    _this.stop = function () {
      var onAnimationStop = _this.props.onAnimationStop;
      onAnimationStop && onAnimationStop();
      _this.sequence && _this.sequence.stop();
    };

    var _props$colors = props.colors,
        _colors = _props$colors === void 0 ? DEFAULT_COLORS : _props$colors;

    _this.start = _this.start.bind((0, _assertThisInitialized2.default)(_this));
    _this.resume = _this.resume.bind((0, _assertThisInitialized2.default)(_this));
    _this.stop = _this.stop.bind((0, _assertThisInitialized2.default)(_this));
    _this.state.items = _this.getItems(_colors);
    return _this;
  }

  (0, _createClass2.default)(Explosion, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props5 = this.props,
          origin = _this$props5.origin,
          fadeOut = _this$props5.fadeOut;
      var items = this.state.items;

      var _Dimensions$get = _reactNative.Dimensions.get('window'),
          height = _Dimensions$get.height,
          width = _Dimensions$get.width;

      return React.createElement(React.Fragment, null, items.map(function (item, index) {
        var left = _this2.animation.interpolate({
          inputRange: [0, 1, 2],
          outputRange: [origin.x, item.leftDelta * width, item.leftDelta * width]
        });

        var top = _this2.animation.interpolate({
          inputRange: [0, 1, 1 + item.topDelta, 2],
          outputRange: [-origin.y, -item.topDelta * height, 0, 0]
        });

        var rotateX = _this2.animation.interpolate({
          inputRange: [0, 2],
          outputRange: ['0deg', item.speedDelta.rotateX * 360 * 10 + "deg"]
        });

        var rotateY = _this2.animation.interpolate({
          inputRange: [0, 2],
          outputRange: ['0deg', item.speedDelta.rotateY * 360 * 5 + "deg"]
        });

        var rotateZ = _this2.animation.interpolate({
          inputRange: [0, 2],
          outputRange: ['0deg', item.speedDelta.rotateZ * 360 * 2 + "deg"]
        });

        var translateX = _this2.animation.interpolate({
          inputRange: [0, 0.4, 1.2, 2],
          outputRange: [0, -(item.swingDelta * 30), item.swingDelta * 30, 0]
        });

        var opacity = _this2.animation.interpolate({
          inputRange: [0, 1, 1.8, 2],
          outputRange: [1, 1, 1, fadeOut ? 0 : 1]
        });

        var containerTransform = [{
          translateX: left
        }, {
          translateY: top
        }];
        var transform = [{
          rotateX: rotateX
        }, {
          rotateY: rotateY
        }, {
          rotate: rotateZ
        }, {
          translateX: translateX
        }];

        if (_reactNative.Platform.OS === 'android') {
          transform.push({
            perspective: 100
          });
        }

        return React.createElement(_confetti.default, {
          color: item.color,
          containerTransform: containerTransform,
          transform: transform,
          opacity: opacity,
          key: index,
          testID: "confetti-" + (index + 1)
        });
      }));
    }
  }]);
  return Explosion;
}(React.PureComponent);

var _default = Explosion;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlRPUF9NSU4iLCJERUZBVUxUX0NPTE9SUyIsIkRFRkFVTFRfRVhQTE9TSU9OX1NQRUVEIiwiREVGQVVMVF9GQUxMX1NQRUVEIiwiRXhwbG9zaW9uIiwicHJvcHMiLCJzdGF0ZSIsIml0ZW1zIiwiYW5pbWF0aW9uIiwiQW5pbWF0ZWQiLCJWYWx1ZSIsImNvbXBvbmVudERpZE1vdW50IiwiYXV0b1N0YXJ0IiwiYXV0b1N0YXJ0RGVsYXkiLCJzZXRUaW1lb3V0Iiwic3RhcnQiLCJjb21wb25lbnREaWRVcGRhdGUiLCJwcmV2Q291bnQiLCJjb3VudCIsImNvbG9ycyIsInByZXZDb2xvcnMiLCJzZXRTdGF0ZSIsImdldEl0ZW1zIiwiZGlmZmVyZW5jZSIsImxlbmd0aCIsIm5ld0l0ZW1zIiwiQXJyYXkiLCJmaWxsIiwibWFwIiwibGVmdERlbHRhIiwidG9wRGVsdGEiLCJzd2luZ0RlbHRhIiwic3BlZWREZWx0YSIsInJvdGF0ZVgiLCJyb3RhdGVZIiwicm90YXRlWiIsImNvbG9yIiwic2xpY2UiLCJjb25jYXQiLCJpdGVtIiwicmVzdW1lIiwiZXhwbG9zaW9uU3BlZWQiLCJmYWxsU3BlZWQiLCJvbkFuaW1hdGlvblN0YXJ0Iiwib25BbmltYXRpb25SZXN1bWUiLCJvbkFuaW1hdGlvbkVuZCIsInNlcXVlbmNlIiwidGltaW5nIiwidG9WYWx1ZSIsImR1cmF0aW9uIiwidXNlTmF0aXZlRHJpdmVyIiwiZWFzaW5nIiwiRWFzaW5nIiwib3V0IiwicXVhZCIsImZpbmlzaGVkIiwic3RvcCIsIm9uQW5pbWF0aW9uU3RvcCIsImJpbmQiLCJvcmlnaW4iLCJmYWRlT3V0IiwiRGltZW5zaW9ucyIsImdldCIsImhlaWdodCIsIndpZHRoIiwiaW5kZXgiLCJsZWZ0IiwiaW50ZXJwb2xhdGUiLCJpbnB1dFJhbmdlIiwib3V0cHV0UmFuZ2UiLCJ4IiwidG9wIiwieSIsInRyYW5zbGF0ZVgiLCJvcGFjaXR5IiwiY29udGFpbmVyVHJhbnNmb3JtIiwidHJhbnNsYXRlWSIsInRyYW5zZm9ybSIsInJvdGF0ZSIsIlBsYXRmb3JtIiwiT1MiLCJwdXNoIiwicGVyc3BlY3RpdmUiLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBOztBQUNBOztBQUlBOztBQUNBOzs7Ozs7Ozs7Ozs7OztBQXFDTyxJQUFNQSxPQUFPLEdBQUcsR0FBaEI7O0FBQ0EsSUFBTUMsY0FBNkIsR0FBRSxDQUMxQyxTQUQwQyxFQUUxQyxTQUYwQyxFQUcxQyxTQUgwQyxFQUkxQyxTQUowQyxFQUsxQyxTQUwwQyxFQU0xQyxTQU4wQyxFQU8xQyxTQVAwQyxFQVExQyxTQVIwQyxFQVMxQyxTQVQwQyxFQVUxQyxTQVYwQyxFQVcxQyxTQVgwQyxDQUFyQzs7QUFhQSxJQUFNQyx1QkFBdUIsR0FBRyxHQUFoQzs7QUFDQSxJQUFNQyxrQkFBa0IsR0FBRyxJQUEzQjs7O0lBRURDLFM7Ozs7O0FBWUoscUJBQVlDLEtBQVosRUFBMEI7QUFBQTs7QUFBQTtBQUN4Qiw4QkFBTUEsS0FBTjtBQUR3QixVQVYxQkMsS0FVMEIsR0FWWDtBQUNiQyxNQUFBQSxLQUFLLEVBQUU7QUFETSxLQVVXO0FBQUEsVUFIMUJBLEtBRzBCLEdBSEwsRUFHSztBQUFBLFVBRjFCQyxTQUUwQixHQUZFLElBQUlDLHNCQUFTQyxLQUFiLENBQW1CLENBQW5CLENBRUY7O0FBQUEsVUFZMUJDLGlCQVowQixHQVlOLFlBQU07QUFDeEIsd0JBQWlELE1BQUtOLEtBQXREO0FBQUEsOENBQVFPLFNBQVI7QUFBQSxVQUFRQSxTQUFSLHNDQUFvQixJQUFwQjtBQUFBLCtDQUEwQkMsY0FBMUI7QUFBQSxVQUEwQkEsY0FBMUIsdUNBQTJDLENBQTNDOztBQUVBLFVBQUlELFNBQUosRUFBZTtBQUNiRSxRQUFBQSxVQUFVLENBQUMsTUFBS0MsS0FBTixFQUFhRixjQUFiLENBQVY7QUFDRDtBQUNGLEtBbEJ5Qjs7QUFBQSxVQW9CMUJHLGtCQXBCMEIsR0FvQkwsZ0JBQXNFO0FB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QUFnQixTQUFwQixFQUErQjtBQUM3QkgsVUFBQUEsU0FBUyxDQUFDSSxJQUFWLENBQWU7QUFBRUMsWUFBQUEsV0FBVyxFQUFFO0FBQWYsV0FBZjtBQUNEOztBQUVELGVBQ0Usb0JBQUMsaUJBQUQ7QUFDRSxVQUFBLEtBQUssRUFBRTNDLElBQUksQ0FBQ0gsS0FEZDtBQUVFLFVBQUEsa0JBQWtCLEVBQUV1QyxrQkFGdEI7QUFHRSxVQUFBLFNBQVMsRUFBRUUsU0FIYjtBQUlFLFVBQUEsT0FBTyxFQUFFSCxPQUpYO0FBS0UsVUFBQSxHQUFHLEVBQUVULEtBTFA7QUFNRSxVQUFBLE1BQU0saUJBQWNBLEtBQUssR0FBRyxDQUF0QjtBQU5SLFVBREY7QUFVRCxPQTlDQSxDQURILENBREY7QUFtREQ7OztFQTdLcUJrQixLQUFLLENBQUNDLGE7O2VBZ0xmaEYsUyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5cbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEFuaW1hdGVkLCBEaW1lbnNpb25zLCBFYXNpbmcsIFBsYXRmb3JtIH0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCB0eXBlIHsgQ29tcG9zaXRlQW5pbWF0aW9uIH0gZnJvbSAncmVhY3QtbmF0aXZlL0xpYnJhcmllcy9BbmltYXRlZC9zcmMvQW5pbWF0ZWRJbXBsZW1lbnRhdGlvbic7XG5pbXBvcnQgdHlwZSB7IEVuZFJlc3VsdCB9IGZyb20gJ3JlYWN0LW5hdGl2ZS9MaWJyYXJpZXMvQW5pbWF0ZWQvc3JjL2FuaW1hdGlvbnMvQW5pbWF0aW9uJztcblxuaW1wb3J0IENvbmZldHRpIGZyb20gJy4vY29tcG9uZW50cy9jb25mZXR0aSc7XG5pbXBvcnQgeyByYW5kb21WYWx1ZSwgcmFuZG9tQ29sb3IgfSBmcm9tICcuL3V0aWxzJztcblxudHlwZSBQcm9wcyA9IHt8XG4gIGNvdW50OiBudW1iZXIsXG4gIG9yaWdpbjoge1xuICAgIHg6IG51bWJlcixcbiAgICB5OiBudW1iZXJcbiAgfSxcbiAgZXhwbG9zaW9uU3BlZWQ/OiBudW1iZXIsXG4gIGZhbGxTcGVlZD86IG51bWJlcixcbiAgY29sb3JzPzogQXJyYXk8c3RyaW5nPixcbiAgZmFkZU91dD86IGJvb2xlYW4sXG4gIGF1dG9TdGFydD86IGJvb2xlYW4sXG4gIGF1dG9TdGFydERlbGF5PzogbnVtYmVyLFxuICBvbkFuaW1hdGlvblN0YXJ0PzogKCkgPT4gdm9pZCxcbiAgb25BbmltYXRpb25SZXN1bWU/OiAoKSA9PiB2b2lkLFxuICBvbkFuaW1hdGlvblN0b3A/OiAoKSA9PiB2b2lkLFxuICBvbkFuaW1hdGlvbkVuZD86ICgpID0+IHZvaWQsXG4gIHRlc3RJRD86IHN0cmluZ1xufH07XG5cbnR5cGUgSXRlbSA9IHt8XG4gIGxlZnREZWx0YTogbnVtYmVyLFxuICB0b3BEZWx0YTogbnVtYmVyLFxuICBzd2luZ0RlbHRhOiBudW1iZXIsXG4gIHNwZWVkRGVsdGE6IHtcbiAgICByb3RhdGVYOiBudW1iZXIsXG4gICAgcm90YXRlWTogbnVtYmVyLFxuICAgIHJvdGF0ZVo6IG51bWJlclxuICB9LFxuICBjb2xvcjogc3RyaW5nXG58fTtcblxudHlwZSBTdGF0ZSA9IHt8XG4gIGl0ZW1zOiBBcnJheTxJdGVtPlxufH07XG5cbmV4cG9ydCBjb25zdCBUT1BfTUlOID0gMC43O1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfQ09MT1JTOiBBcnJheTxzdHJpbmc+ID1bXG4gICcjZTY3ZTIyJyxcbiAgJyMyZWNjNzEnLFxuICAnIzM0OThkYicsXG4gICcjODRBQUMyJyxcbiAgJyNFNkQ2OEQnLFxuICAnI0Y2NzkzMycsXG4gICcjNDJBODU4JyxcbiAgJyM0RjUwQTInLFxuICAnI0E4NkJCNycsXG4gICcjZTc0YzNjJyxcbiAgJyMxYWJjOWMnXG5dO1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfRVhQTE9TSU9OX1NQRUVEID0gMzUwO1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfRkFMTF9TUEVFRCA9IDMwMDA7XG5cbmNsYXNzIEV4cGxvc2lvbiBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8UHJvcHMsIFN0YXRlPiB7XG4gIHByb3BzOiBQcm9wcztcbiAgc3RhdGU6IFN0YXRlID0ge1xuICAgIGl0ZW1zOiBbXVxuICB9O1xuICBzdGFydDogKCkgPT4gdm9pZDtcbiAgcmVzdW1lOiAoKSA9PiB2b2lkO1xuICBzdG9wOiAoKSA9PiB2b2lkO1xuICBzZXF1ZW5jZTogQ29tcG9zaXRlQW5pbWF0aW9uIHwgbnVsbDtcbiAgaXRlbXM6IEFycmF5PEl0ZW0+ID0gW107XG4gIGFuaW1hdGlvbjogQW5pbWF0ZWQuVmFsdWUgPSBuZXcgQW5pbWF0ZWQuVmFsdWUoMCk7XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgY29uc3QgeyBjb2xvcnMgPSBERUZBVUxUX0NPTE9SUyB9ID0gcHJvcHM7XG5cbiAgICB0aGlzLnN0YXJ0ID0gdGhpcy5zdGFydC5iaW5kKHRoaXMpO1xuICAgIHRoaXMucmVzdW1lID0gdGhpcy5yZXN1bWUuYmluZCh0aGlzKTtcbiAgICB0aGlzLnN0b3AgPSB0aGlzLnN0b3AuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuc3RhdGUuaXRlbXMgPSB0aGlzLmdldEl0ZW1zKGNvbG9ycyk7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCA9ICgpID0+IHtcbiAgICBjb25zdCB7IGF1dG9TdGFydCA9IHRydWUsIGF1dG9TdGFydERlbGF5ID0gMCB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChhdXRvU3RhcnQpIHtcbiAgICAgIHNldFRpbWVvdXQodGhpcy5zdGFydCwgYXV0b1N0YXJ0RGVsYXkpO1xuICAgIH1cbiAgfTtcblxuICBjb21wb25lbnREaWRVcGRhdGUgPSAoeyBjb3VudDogcHJldkNvdW50LCBjb2xvcnM6IHByZXZDb2xvcnMgPSBERUZBVUxUX0NPTE9SUyB9OiBQcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgY291bnQsIGNvbG9ycyA9IERFRkFVTFRfQ09MT1JTIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKGNvdW50ICE9PSBwcmV2Q291bnQgfHwgY29sb3JzICE9PSBwcmV2Q29sb3JzKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgaXRlbXM6IHRoaXMuZ2V0SXRlbXMocHJldkNvbG9ycylcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBnZXRJdGVtcyA9IChwcmV2Q29sb3JzOiBBcnJheTxzdHJpbmc+KTogQXJyYXk8SXRlbT4gPT4ge1xuICAgIGNvbnN0IHsgY291bnQsIGNvbG9ycyA9IERFRkFVTFRfQ09MT1JTIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXMgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBjb25zdCBkaWZmZXJlbmNlID0gaXRlbXMubGVuZ3RoIDwgY291bnQgPyBjb3VudCAtIGl0ZW1zLmxlbmd0aCA6IDA7XG5cbiAgICBjb25zdCBuZXdJdGVtcyA9IEFycmF5KGRpZmZlcmVuY2UpLmZpbGwoKS5tYXAoKCk6IEl0ZW0gPT4gKHtcbiAgICAgIGxlZnREZWx0YTogcmFuZG9tVmFsdWUoMCwgMSksXG4gICAgICB0b3BEZWx0YTogcmFuZG9tVmFsdWUoVE9QX01JTiwgMSksXG4gICAgICBzd2luZ0RlbHRhOiByYW5kb21WYWx1ZSgwLjIsIDEpLFxuICAgICAgc3BlZWREZWx0YToge1xuICAgICAgICByb3RhdGVYOiByYW5kb21WYWx1ZSgwLjMsIDEpLFxuICAgICAgICByb3RhdGVZOiByYW5kb21WYWx1ZSgwLjMsIDEpLFxuICAgICAgICByb3RhdGVaOiByYW5kb21WYWx1ZSgwLjMsIDEpXG4gICAgICB9LFxuICAgICAgY29sb3I6IHJhbmRvbUNvbG9yKGNvbG9ycylcbiAgICB9KSk7XG5cbiAgICByZXR1cm4gaXRlbXNcbiAgICAgIC5zbGljZSgwLCBjb3VudClcbiAgICAgIC5jb25jYXQobmV3SXRlbXMpXG4gICAgICAubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgLi4uaXRlbSxcbiAgICAgICAgY29sb3I6IHByZXZDb2xvcnMgIT09IGNvbG9ycyA/IHJhbmRvbUNvbG9yKGNvbG9ycykgOiBpdGVtLmNvbG9yXG4gICAgICB9KSk7XG4gIH07XG5cbiAgc3RhcnQgPSAocmVzdW1lPzogYm9vbGVhbiA9IGZhbHNlKSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgZXhwbG9zaW9uU3BlZWQgPSBERUZBVUxUX0VYUExPU0lPTl9TUEVFRCxcbiAgICAgIGZhbGxTcGVlZCA9IERFRkFVTFRfRkFMTF9TUEVFRCxcbiAgICAgIG9uQW5pbWF0aW9uU3RhcnQsXG4gICAgICBvbkFuaW1hdGlvblJlc3VtZSxcbiAgICAgIG9uQW5pbWF0aW9uRW5kXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAocmVzdW1lKSB7XG4gICAgICBvbkFuaW1hdGlvblJlc3VtZSAmJiBvbkFuaW1hdGlvblJlc3VtZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlcXVlbmNlID0gQW5pbWF0ZWQuc2VxdWVuY2UoW1xuICAgICAgICBBbmltYXRlZC50aW1pbmcodGhpcy5hbmltYXRpb24sIHt0b1ZhbHVlOiAwLCBkdXJhdGlvbjogMCwgdXNlTmF0aXZlRHJpdmVyOiB0cnVlfSksXG4gICAgICAgIEFuaW1hdGVkLnRpbWluZyh0aGlzLmFuaW1hdGlvbiwge1xuICAgICAgICAgIHRvVmFsdWU6IDEsXG4gICAgICAgICAgZHVyYXRpb246IGV4cGxvc2lvblNwZWVkLFxuICAgICAgICAgIGVhc2luZzogRWFzaW5nLm91dChFYXNpbmcucXVhZCksXG4gICAgICAgICAgdXNlTmF0aXZlRHJpdmVyOiB0cnVlXG4gICAgICAgIH0pLFxuICAgICAgICBBbmltYXRlZC50aW1pbmcodGhpcy5hbmltYXRpb24sIHtcbiAgICAgICAgICB0b1ZhbHVlOiAyLFxuICAgICAgICAgIGR1cmF0aW9uOiBmYWxsU3BlZWQsXG4gICAgICAgICAgZWFzaW5nOiBFYXNpbmcucXVhZCxcbiAgICAgICAgICB1c2VOYXRpdmVEcml2ZXI6IHRydWVcbiAgICAgICAgfSksXG4gICAgICBdKTtcblxuICAgICAgb25BbmltYXRpb25TdGFydCAmJiBvbkFuaW1hdGlvblN0YXJ0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXF1ZW5jZSAmJiB0aGlzLnNlcXVlbmNlLnN0YXJ0KCh7ZmluaXNoZWR9OiBFbmRSZXN1bHQpID0+IHtcbiAgICAgIGlmIChmaW5pc2hlZCkge1xuICAgICAgICBvbkFuaW1hdGlvbkVuZCAmJiBvbkFuaW1hdGlvbkVuZCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHJlc3VtZSA9ICgpID0+IHRoaXMuc3RhcnQodHJ1ZSk7XG5cbiAgc3RvcCA9ICgpID0+IHtcbiAgICBjb25zdCB7IG9uQW5pbWF0aW9uU3RvcCB9ID0gdGhpcy5wcm9wcztcblxuICAgIG9uQW5pbWF0aW9uU3RvcCAmJiBvbkFuaW1hdGlvblN0b3AoKTtcblxuICAgIHRoaXMuc2VxdWVuY2UgJiYgdGhpcy5zZXF1ZW5jZS5zdG9wKCk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgb3JpZ2luLCBmYWRlT3V0IH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgaXRlbXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgeyBoZWlnaHQsIHdpZHRoIH0gPSBEaW1lbnNpb25zLmdldCgnd2luZG93Jyk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICB7aXRlbXMubWFwKChpdGVtOiBJdGVtLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgY29uc3QgbGVmdCA9IHRoaXMuYW5pbWF0aW9uLmludGVycG9sYXRlKHtcbiAgICAgICAgICAgIGlucHV0UmFuZ2U6IFswLCAxLCAyXSxcbiAgICAgICAgICAgIG91dHB1dFJhbmdlOiBbb3JpZ2luLngsIGl0ZW0ubGVmdERlbHRhICogd2lkdGgsIGl0ZW0ubGVmdERlbHRhICogd2lkdGhdXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgdG9wID0gdGhpcy5hbmltYXRpb24uaW50ZXJwb2xhdGUoe1xuICAgICAgICAgICAgaW5wdXRSYW5nZTogWzAsIDEsIDEgKyBpdGVtLnRvcERlbHRhLCAyXSxcbiAgICAgICAgICAgIG91dHB1dFJhbmdlOiBbLW9yaWdpbi55LCAtaXRlbS50b3BEZWx0YSAqIGhlaWdodCwgMCwgMF1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCByb3RhdGVYID0gdGhpcy5hbmltYXRpb24uaW50ZXJwb2xhdGUoe1xuICAgICAgICAgICAgaW5wdXRSYW5nZTogWzAsIDJdLFxuICAgICAgICAgICAgb3V0cHV0UmFuZ2U6IFsnMGRlZycsIGAke2l0ZW0uc3BlZWREZWx0YS5yb3RhdGVYICogMzYwICogMTB9ZGVnYF1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCByb3RhdGVZID0gdGhpcy5hbmltYXRpb24uaW50ZXJwb2xhdGUoe1xuICAgICAgICAgICAgaW5wdXRSYW5nZTogWzAsIDJdLFxuICAgICAgICAgICAgb3V0cHV0UmFuZ2U6IFsnMGRlZycsIGAke2l0ZW0uc3BlZWREZWx0YS5yb3RhdGVZICogMzYwICogNX1kZWdgXVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IHJvdGF0ZVogPSB0aGlzLmFuaW1hdGlvbi5pbnRlcnBvbGF0ZSh7XG4gICAgICAgICAgICBpbnB1dFJhbmdlOiBbMCwgMl0sXG4gICAgICAgICAgICBvdXRwdXRSYW5nZTogWycwZGVnJywgYCR7aXRlbS5zcGVlZERlbHRhLnJvdGF0ZVogKiAzNjAgKiAyfWRlZ2BdXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgdHJhbnNsYXRlWCA9IHRoaXMuYW5pbWF0aW9uLmludGVycG9sYXRlKHtcbiAgICAgICAgICAgIGlucHV0UmFuZ2U6IFswLCAwLjQsIDEuMiwgMl0sXG4gICAgICAgICAgICBvdXRwdXRSYW5nZTogWzAsIC0oaXRlbS5zd2luZ0RlbHRhICogMzApLCAoaXRlbS5zd2luZ0RlbHRhICogMzApLCAwXVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IG9wYWNpdHkgPSB0aGlzLmFuaW1hdGlvbi5pbnRlcnBvbGF0ZSh7XG4gICAgICAgICAgICBpbnB1dFJhbmdlOiBbMCwgMSwgMS44LCAyXSxcbiAgICAgICAgICAgIG91dHB1dFJhbmdlOiBbMSwgMSwgMSwgZmFkZU91dCA/IDAgOiAxXVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGNvbnRhaW5lclRyYW5zZm9ybSA9IFt7dHJhbnNsYXRlWDogbGVmdH0sIHt0cmFuc2xhdGVZOiB0b3B9XTtcbiAgICAgICAgICBjb25zdCB0cmFuc2Zvcm0gPSBbe3JvdGF0ZVh9LCB7cm90YXRlWX0sIHtyb3RhdGU6IHJvdGF0ZVp9LCB7dHJhbnNsYXRlWH1dO1xuXG4gICAgICAgICAgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgICAgICAgIHRyYW5zZm9ybS5wdXNoKHsgcGVyc3BlY3RpdmU6IDEwMCB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPENvbmZldHRpXG4gICAgICAgICAgICAgIGNvbG9yPXtpdGVtLmNvbG9yfVxuICAgICAgICAgICAgICBjb250YWluZXJUcmFuc2Zvcm09e2NvbnRhaW5lclRyYW5zZm9ybX1cbiAgICAgICAgICAgICAgdHJhbnNmb3JtPXt0cmFuc2Zvcm19XG4gICAgICAgICAgICAgIG9wYWNpdHk9e29wYWNpdHl9XG4gICAgICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgICAgICAgIHRlc3RJRD17YGNvbmZldHRpLSR7aW5kZXggKyAxfWB9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pfVxuICAgICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV4cGxvc2lvbjtcbiJdfQ==