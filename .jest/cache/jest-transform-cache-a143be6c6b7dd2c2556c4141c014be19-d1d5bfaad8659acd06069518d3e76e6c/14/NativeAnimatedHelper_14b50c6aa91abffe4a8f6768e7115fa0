1ca3d1e8da0f1efa78451fdcd7b2f333
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _NativeEventEmitter = _interopRequireDefault(require("../../EventEmitter/NativeEventEmitter"));

var _NativeAnimatedModule = _interopRequireDefault(require("./NativeAnimatedModule"));

var _invariant = _interopRequireDefault(require("invariant"));

var __nativeAnimatedNodeTagCount = 1;
var __nativeAnimationIdCount = 1;
var nativeEventEmitter;
var queueConnections = false;
var queue = [];
var API = {
  enableQueue: function enableQueue() {
    queueConnections = true;
  },
  disableQueue: function disableQueue() {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');
    queueConnections = false;

    for (var q = 0, l = queue.length; q < l; q++) {
      var args = queue[q];

      _NativeAnimatedModule.default.connectAnimatedNodes(args[0], args[1]);
    }

    queue.length = 0;
  },
  createAnimatedNode: function createAnimatedNode(tag, config) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.createAnimatedNode(tag, config);
  },
  startListeningToAnimatedNodeValue: function startListeningToAnimatedNodeValue(tag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.startListeningToAnimatedNodeValue(tag);
  },
  stopListeningToAnimatedNodeValue: function stopListeningToAnimatedNodeValue(tag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.stopListeningToAnimatedNodeValue(tag);
  },
  connectAnimatedNodes: function connectAnimatedNodes(parentTag, childTag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    if (queueConnections) {
      queue.push([parentTag, childTag]);
      return;
    }

    _NativeAnimatedModule.default.connectAnimatedNodes(parentTag, childTag);
  },
  disconnectAnimatedNodes: function disconnectAnimatedNodes(parentTag, childTag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.disconnectAnimatedNodes(parentTag, childTag);
  },
  startAnimatingNode: function startAnimatingNode(animationId, nodeTag, config, endCallback) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.startAnimatingNode(animationId, nodeTag, config, endCallback);
  },
  stopAnimation: function stopAnimation(animationId) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.stopAnimation(animationId);
  },
  setAnimatedNodeValue: function setAnimatedNodeValue(nodeTag, value) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.setAnimatedNodeValue(nodeTag, value);
  },
  setAnimatedNodeOffset: function setAnimatedNodeOffset(nodeTag, offset) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.setAnimatedNodeOffset(nodeTag, offset);
  },
  flattenAnimatedNodeOffset: function flattenAnimatedNodeOffset(nodeTag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.flattenAnimatedNodeOffset(nodeTag);
  },
  extractAnimatedNodeOffset: function extractAnimatedNodeOffset(nodeTag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.extractAnimatedNodeOffset(nodeTag);
  },
  connectAnimatedNodeToView: function connectAnimatedNodeToView(nodeTag, viewTag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.connectAnimatedNodeToView(nodeTag, viewTag);
  },
  disconnectAnimatedNodeFromView: function disconnectAnimatedNodeFromView(nodeTag, viewTag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.disconnectAnimatedNodeFromView(nodeTag, viewTag);
  },
  restoreDefaultValues: function restoreDefaultValues(nodeTag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    if (_NativeAnimatedModule.default.restoreDefaultValues != null) {
      _NativeAnimatedModule.default.restoreDefaultValues(nodeTag);
    }
  },
  dropAnimatedNode: function dropAnimatedNode(tag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.dropAnimatedNode(tag);
  },
  addAnimatedEventToView: function addAnimatedEventToView(viewTag, eventName, eventMapping) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.addAnimatedEventToView(viewTag, eventName, eventMapping);
  },
  removeAnimatedEventFromView: function removeAnimatedEventFromView(viewTag, eventName, animatedNodeTag) {
    (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');

    _NativeAnimatedModule.default.removeAnimatedEventFromView(viewTag, eventName, animatedNodeTag);
  }
};
var STYLES_WHITELIST = {
  opacity: true,
  transform: true,
  borderRadius: true,
  borderBottomEndRadius: true,
  borderBottomLeftRadius: true,
  borderBottomRightRadius: true,
  borderBottomStartRadius: true,
  borderTopEndRadius: true,
  borderTopLeftRadius: true,
  borderTopRightRadius: true,
  borderTopStartRadius: true,
  elevation: true,
  zIndex: true,
  shadowOpacity: true,
  shadowRadius: true,
  scaleX: true,
  scaleY: true,
  translateX: true,
  translateY: true
};
var TRANSFORM_WHITELIST = {
  translateX: true,
  translateY: true,
  scale: true,
  scaleX: true,
  scaleY: true,
  rotate: true,
  rotateX: true,
  rotateY: true,
  rotateZ: true,
  perspective: true
};
var SUPPORTED_INTERPOLATION_PARAMS = {
  inputRange: true,
  outputRange: true,
  extrapolate: true,
  extrapolateRight: true,
  extrapolateLeft: true
};

function addWhitelistedStyleProp(prop) {
  STYLES_WHITELIST[prop] = true;
}

function addWhitelistedTransformProp(prop) {
  TRANSFORM_WHITELIST[prop] = true;
}

function addWhitelistedInterpolationParam(param) {
  SUPPORTED_INTERPOLATION_PARAMS[param] = true;
}

function validateTransform(configs) {
  configs.forEach(function (config) {
    if (!TRANSFORM_WHITELIST.hasOwnProperty(config.property)) {
      throw new Error("Property '" + config.property + "' is not supported by native animated module");
    }
  });
}

function validateStyles(styles) {
  for (var _key in styles) {
    if (!STYLES_WHITELIST.hasOwnProperty(_key)) {
      throw new Error("Style property '" + _key + "' is not supported by native animated module");
    }
  }
}

function validateInterpolation(config) {
  for (var _key2 in config) {
    if (!SUPPORTED_INTERPOLATION_PARAMS.hasOwnProperty(_key2)) {
      throw new Error("Interpolation property '" + _key2 + "' is not supported by native animated module");
    }
  }
}

function generateNewNodeTag() {
  return __nativeAnimatedNodeTagCount++;
}

function generateNewAnimationId() {
  return __nativeAnimationIdCount++;
}

function assertNativeAnimatedModule() {
  (0, _invariant.default)(_NativeAnimatedModule.default, 'Native animated module is not available');
}

var _warnedMissingNativeAnimated = false;

function shouldUseNativeDriver(config) {
  if (config.useNativeDriver == null) {
    console.warn('Animated: `useNativeDriver` was not specified. This is a required ' + 'option and must be explicitly set to `true` or `false`');
  }

  if (config.useNativeDriver === true && !_NativeAnimatedModule.default) {
    if (!_warnedMissingNativeAnimated) {
      console.warn('Animated: `useNativeDriver` is not supported because the native ' + 'animated module is missing. Falling back to JS-based animation. To ' + 'resolve this, add `RCTAnimation` module to this app, or remove ' + '`useNativeDriver`. ' + 'Make sure to run `pod install` first. Read more about autolinking: https://github.com/react-native-community/cli/blob/master/docs/autolinking.md');
      _warnedMissingNativeAnimated = true;
    }

    return false;
  }

  return config.useNativeDriver || false;
}

function transformDataType(value) {
  if (typeof value !== 'string') {
    return value;
  }

  if (/deg$/.test(value)) {
    var degrees = parseFloat(value) || 0;
    var radians = degrees * Math.PI / 180.0;
    return radians;
  } else {
    return value;
  }
}

module.exports = {
  API: API,
  addWhitelistedStyleProp: addWhitelistedStyleProp,
  addWhitelistedTransformProp: addWhitelistedTransformProp,
  addWhitelistedInterpolationParam: addWhitelistedInterpolationParam,
  validateStyles: validateStyles,
  validateTransform: validateTransform,
  validateInterpolation: validateInterpolation,
  generateNewNodeTag: generateNewNodeTag,
  generateNewAnimationId: generateNewAnimationId,
  assertNativeAnimatedModule: assertNativeAnimatedModule,
  shouldUseNativeDriver: shouldUseNativeDriver,
  transformDataType: transformDataType,

  get nativeEventEmitter() {
    if (!nativeEventEmitter) {
      nativeEventEmitter = new _NativeEventEmitter.default(_NativeAnimatedModule.default);
    }

    return nativeEventEmitter;
  }

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdGl2ZUFuaW1hdGVkSGVscGVyLmpzIl0sIm5hbWVzIjpbIl9fbmF0aXZlQW5pbWF0ZWROb2RlVGFnQ291bnQiLCJfX25hdGl2ZUFuaW1hdGlvbklkQ291bnQiLCJuYXRpdmVFdmVudEVtaXR0ZXIiLCJxdWV1ZUNvbm5lY3Rpb25zIiwicXVldWUiLCJBUEkiLCJlbmFibGVRdWV1ZSIsImRpc2FibGVRdWV1ZSIsIk5hdGl2ZUFuaW1hdGVkTW9kdWxlIiwicSIsImwiLCJsZW5ndGgiLCJhcmdzIiwiY29ubmVjdEFuaW1hdGVkTm9kZXMiLCJjcmVhdGVBbmltYXRlZE5vZGUiLCJ0YWciLCJjb25maWciLCJzdGFydExpc3RlbmluZ1RvQW5pbWF0ZWROb2RlVmFsdWUiLCJzdG9wTGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZSIsInBhcmVudFRhZyIsImNoaWxkVGFnIiwicHVzaCIsImRpc2Nvbm5lY3RBbmltYXRlZE5vZGVzIiwic3RhcnRBbmltYXRpbmdOb2RlIiwiYW5pbWF0aW9uSWQiLCJub2RlVGFnIiwiZW5kQ2FsbGJhY2siLCJzdG9wQW5pbWF0aW9uIiwic2V0QW5pbWF0ZWROb2RlVmFsdWUiLCJ2YWx1ZSIsInNldEFuaW1hdGVkTm9kZU9mZnNldCIsIm9mZnNldCIsImZsYXR0ZW5BbmltYXRlZE5vZGVPZmZzZXQiLCJleHRyYWN0QW5pbWF0ZWROb2RlT2Zmc2V0IiwiY29ubmVjdEFuaW1hdGVkTm9kZVRvVmlldyIsInZpZXdUYWciLCJkaXNjb25uZWN0QW5pbWF0ZWROb2RlRnJvbVZpZXciLCJyZXN0b3JlRGVmYXVsdFZhbHVlcyIsImRyb3BBbmltYXRlZE5vZGUiLCJhZGRBbmltYXRlZEV2ZW50VG9WaWV3IiwiZXZlbnROYW1lIiwiZXZlbnRNYXBwaW5nIiwicmVtb3ZlQW5pbWF0ZWRFdmVudEZyb21WaWV3IiwiYW5pbWF0ZWROb2RlVGFnIiwiU1RZTEVTX1dISVRFTElTVCIsIm9wYWNpdHkiLCJ0cmFuc2Zvcm0iLCJib3JkZXJSYWRpdXMiLCJib3JkZXJCb3R0b21FbmRSYWRpdXMiLCJib3JkZXJCb3R0b21MZWZ0UmFkaXVzIiwiYm9yZGVyQm90dG9tUmlnaHRSYWRpdXMiLCJib3JkZXJCb3R0b21TdGFydFJhZGl1cyIsImJvcmRlclRvcEVuZFJhZGl1cyIsImJvcmRlclRvcExlZnRSYWRpdXMiLCJib3JkZXJUb3BSaWdodFJhZGl1cyIsImJvcmRlclRvcFN0YXJ0UmFkaXVzIiwiZWxldmF0aW9uIiwiekluZGV4Iiwic2hhZG93T3BhY2l0eSIsInNoYWRvd1JhZGl1cyIsInNjYWxlWCIsInNjYWxlWSIsInRyYW5zbGF0ZVgiLCJ0cmFuc2xhdGVZIiwiVFJBTlNGT1JNX1dISVRFTElTVCIsInNjYWxlIiwicm90YXRlIiwicm90YXRlWCIsInJvdGF0ZVkiLCJyb3RhdGVaIiwicGVyc3BlY3RpdmUiLCJTVVBQT1JURURfSU5URVJQT0xBVElPTl9QQVJBTVMiLCJpbnB1dFJhbmdlIiwib3V0cHV0UmFuZ2UiLCJleHRyYXBvbGF0ZSIsImV4dHJhcG9sYXRlUmlnaHQiLCJleHRyYXBvbGF0ZUxlZnQiLCJhZGRXaGl0ZWxpc3RlZFN0eWxlUHJvcCIsInByb3AiLCJhZGRXaGl0ZWxpc3RlZFRyYW5zZm9ybVByb3AiLCJhZGRXaGl0ZWxpc3RlZEludGVycG9sYXRpb25QYXJhbSIsInBhcmFtIiwidmFsaWRhdGVUcmFuc2Zvcm0iLCJjb25maWdzIiwiZm9yRWFjaCIsImhhc093blByb3BlcnR5IiwicHJvcGVydHkiLCJFcnJvciIsInZhbGlkYXRlU3R5bGVzIiwic3R5bGVzIiwia2V5IiwidmFsaWRhdGVJbnRlcnBvbGF0aW9uIiwiZ2VuZXJhdGVOZXdOb2RlVGFnIiwiZ2VuZXJhdGVOZXdBbmltYXRpb25JZCIsImFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlIiwiX3dhcm5lZE1pc3NpbmdOYXRpdmVBbmltYXRlZCIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsInVzZU5hdGl2ZURyaXZlciIsImNvbnNvbGUiLCJ3YXJuIiwidHJhbnNmb3JtRGF0YVR5cGUiLCJ0ZXN0IiwiZGVncmVlcyIsInBhcnNlRmxvYXQiLCJyYWRpYW5zIiwiTWF0aCIsIlBJIiwibW9kdWxlIiwiZXhwb3J0cyIsIk5hdGl2ZUV2ZW50RW1pdHRlciJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7QUFFQTs7QUFFQTs7QUFRQTs7QUFFQSxJQUFJQSw0QkFBNEIsR0FBRyxDQUFuQztBQUNBLElBQUlDLHdCQUF3QixHQUFHLENBQS9CO0FBRUEsSUFBSUMsa0JBQUo7QUFFQSxJQUFJQyxnQkFBZ0IsR0FBRyxLQUF2QjtBQUNBLElBQUlDLEtBQUssR0FBRyxFQUFaO0FBTUEsSUFBTUMsR0FBRyxHQUFHO0FBQ1ZDLEVBQUFBLFdBQVcsRUFBRSx1QkFBaUI7QUFDNUJILElBQUFBLGdCQUFnQixHQUFHLElBQW5CO0FBQ0QsR0FIUztBQUlWSSxFQUFBQSxZQUFZLEVBQUUsd0JBQWlCO0FBQzdCLDRCQUFVQyw2QkFBVixFQUFnQyx5Q0FBaEM7QUFDQUwsSUFBQUEsZ0JBQWdCLEdBQUcsS0FBbkI7O0FBQ0EsU0FBSyxJQUFJTSxDQUFDLEdBQUcsQ0FBUixFQUFXQyxDQUFDLEdBQUdOLEtBQUssQ0FBQ08sTUFBMUIsRUFBa0NGLENBQUMsR0FBR0MsQ0FBdEMsRUFBeUNELENBQUMsRUFBMUMsRUFBOEM7QUFDNUMsVUFBTUcsSUFBSSxHQUFHUixLQUFLLENBQUNLLENBQUQsQ0FBbEI7O0FBQ0FELG9DQUFxQkssb0JBQXJCLENBQTBDRCxJQUFJLENBQUMsQ0FBRCxDQUE5QyxFQUFtREEsSUFBSSxDQUFDLENBQUQsQ0FBdkQ7QUFDRDs7QUFDRFIsSUFBQUEsS0FBSyxDQUFDTyxNQUFOLEdBQWUsQ0FBZjtBQUNELEdBWlM7QUFhVkcsRUFBQUEsa0JBQWtCLEVBQUUsNEJBQVNDLEdBQVQsRUFBc0JDLE1BQXRCLEVBQXdEO0FBQzFFLDRCQUFVUiw2QkFBVixFQUFnQyx5Q0FBaEM7O0FBQ0FBLGtDQUFxQk0sa0JBQXJCLENBQXdDQyxHQUF4QyxFQUE2Q0MsTUFBN0M7QUFDRCxHQWhCUztBQWlCVkMsRUFBQUEsaUNBQWlD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QUFBLHVCQUF1QixFQUF2QkEsdUJBRmU7QUFHZkUsRUFBQUEsMkJBQTJCLEVBQTNCQSwyQkFIZTtBQUlmQyxFQUFBQSxnQ0FBZ0MsRUFBaENBLGdDQUplO0FBS2ZRLEVBQUFBLGNBQWMsRUFBZEEsY0FMZTtBQU1mTixFQUFBQSxpQkFBaUIsRUFBakJBLGlCQU5lO0FBT2ZTLEVBQUFBLHFCQUFxQixFQUFyQkEscUJBUGU7QUFRZkMsRUFBQUEsa0JBQWtCLEVBQWxCQSxrQkFSZTtBQVNmQyxFQUFBQSxzQkFBc0IsRUFBdEJBLHNCQVRlO0FBVWZDLEVBQUFBLDBCQUEwQixFQUExQkEsMEJBVmU7QUFXZkUsRUFBQUEscUJBQXFCLEVBQXJCQSxxQkFYZTtBQVlmSSxFQUFBQSxpQkFBaUIsRUFBakJBLGlCQVplOztBQWNmLE1BQUlsRyxrQkFBSixHQUE2QztBQUMzQyxRQUFJLENBQUNBLGtCQUFMLEVBQXlCO0FBQ3ZCQSxNQUFBQSxrQkFBa0IsR0FBRyxJQUFJMkcsMkJBQUosQ0FBdUJyRyw2QkFBdkIsQ0FBckI7QUFDRDs7QUFDRCxXQUFPTixrQkFBUDtBQUNEOztBQW5CYyxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3cgc3RyaWN0LWxvY2FsXG4gKiBAZm9ybWF0XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgTmF0aXZlRXZlbnRFbWl0dGVyIGZyb20gJy4uLy4uL0V2ZW50RW1pdHRlci9OYXRpdmVFdmVudEVtaXR0ZXInO1xuaW1wb3J0IHR5cGUge0V2ZW50Q29uZmlnfSBmcm9tICcuL0FuaW1hdGVkRXZlbnQnO1xuaW1wb3J0IE5hdGl2ZUFuaW1hdGVkTW9kdWxlIGZyb20gJy4vTmF0aXZlQW5pbWF0ZWRNb2R1bGUnO1xuaW1wb3J0IHR5cGUge1xuICBFdmVudE1hcHBpbmcsXG4gIEFuaW1hdGVkTm9kZUNvbmZpZyxcbiAgQW5pbWF0aW5nTm9kZUNvbmZpZyxcbn0gZnJvbSAnLi9OYXRpdmVBbmltYXRlZE1vZHVsZSc7XG5pbXBvcnQgdHlwZSB7QW5pbWF0aW9uQ29uZmlnLCBFbmRDYWxsYmFja30gZnJvbSAnLi9hbmltYXRpb25zL0FuaW1hdGlvbic7XG5pbXBvcnQgdHlwZSB7SW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGV9IGZyb20gJy4vbm9kZXMvQW5pbWF0ZWRJbnRlcnBvbGF0aW9uJztcbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAnaW52YXJpYW50JztcblxubGV0IF9fbmF0aXZlQW5pbWF0ZWROb2RlVGFnQ291bnQgPSAxOyAvKiB1c2VkIGZvciBhbmltYXRlZCBub2RlcyAqL1xubGV0IF9fbmF0aXZlQW5pbWF0aW9uSWRDb3VudCA9IDE7IC8qIHVzZWQgZm9yIHN0YXJ0ZWQgYW5pbWF0aW9ucyAqL1xuXG5sZXQgbmF0aXZlRXZlbnRFbWl0dGVyO1xuXG5sZXQgcXVldWVDb25uZWN0aW9ucyA9IGZhbHNlO1xubGV0IHF1ZXVlID0gW107XG5cbi8qKlxuICogU2ltcGxlIHdyYXBwZXJzIGFyb3VuZCBOYXRpdmVBbmltYXRlZE1vZHVsZSB0byBwcm92aWRlIGZsb3cgYW5kIGF1dG9jb21wbGV0ZSBzdXBwb3J0IGZvclxuICogdGhlIG5hdGl2ZSBtb2R1bGUgbWV0aG9kc1xuICovXG5jb25zdCBBUEkgPSB7XG4gIGVuYWJsZVF1ZXVlOiBmdW5jdGlvbigpOiB2b2lkIHtcbiAgICBxdWV1ZUNvbm5lY3Rpb25zID0gdHJ1ZTtcbiAgfSxcbiAgZGlzYWJsZVF1ZXVlOiBmdW5jdGlvbigpOiB2b2lkIHtcbiAgICBpbnZhcmlhbnQoTmF0aXZlQW5pbWF0ZWRNb2R1bGUsICdOYXRpdmUgYW5pbWF0ZWQgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICBxdWV1ZUNvbm5lY3Rpb25zID0gZmFsc2U7XG4gICAgZm9yIChsZXQgcSA9IDAsIGwgPSBxdWV1ZS5sZW5ndGg7IHEgPCBsOyBxKyspIHtcbiAgICAgIGNvbnN0IGFyZ3MgPSBxdWV1ZVtxXTtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLmNvbm5lY3RBbmltYXRlZE5vZGVzKGFyZ3NbMF0sIGFyZ3NbMV0pO1xuICAgIH1cbiAgICBxdWV1ZS5sZW5ndGggPSAwO1xuICB9LFxuICBjcmVhdGVBbmltYXRlZE5vZGU6IGZ1bmN0aW9uKHRhZzogbnVtYmVyLCBjb25maWc6IEFuaW1hdGVkTm9kZUNvbmZpZyk6IHZvaWQge1xuICAgIGludmFyaWFudChOYXRpdmVBbmltYXRlZE1vZHVsZSwgJ05hdGl2ZSBhbmltYXRlZCBtb2R1bGUgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLmNyZWF0ZUFuaW1hdGVkTm9kZSh0YWcsIGNvbmZpZyk7XG4gIH0sXG4gIHN0YXJ0TGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZTogZnVuY3Rpb24odGFnOiBudW1iZXIpIHtcbiAgICBpbnZhcmlhbnQoTmF0aXZlQW5pbWF0ZWRNb2R1bGUsICdOYXRpdmUgYW5pbWF0ZWQgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5zdGFydExpc3RlbmluZ1RvQW5pbWF0ZWROb2RlVmFsdWUodGFnKTtcbiAgfSxcbiAgc3RvcExpc3RlbmluZ1RvQW5pbWF0ZWROb2RlVmFsdWU6IGZ1bmN0aW9uKHRhZzogbnVtYmVyKSB7XG4gICAgaW52YXJpYW50KE5hdGl2ZUFuaW1hdGVkTW9kdWxlLCAnTmF0aXZlIGFuaW1hdGVkIG1vZHVsZSBpcyBub3QgYXZhaWxhYmxlJyk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuc3RvcExpc3RlbmluZ1RvQW5pbWF0ZWROb2RlVmFsdWUodGFnKTtcbiAgfSxcbiAgY29ubmVjdEFuaW1hdGVkTm9kZXM6IGZ1bmN0aW9uKHBhcmVudFRhZzogbnVtYmVyLCBjaGlsZFRhZzogbnVtYmVyKTogdm9pZCB7XG4gICAgaW52YXJpYW50KE5hdGl2ZUFuaW1hdGVkTW9kdWxlLCAnTmF0aXZlIGFuaW1hdGVkIG1vZHVsZSBpcyBub3QgYXZhaWxhYmxlJyk7XG4gICAgaWYgKHF1ZXVlQ29ubmVjdGlvbnMpIHtcbiAgICAgIHF1ZXVlLnB1c2goW3BhcmVudFRhZywgY2hpbGRUYWddKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuY29ubmVjdEFuaW1hdGVkTm9kZXMocGFyZW50VGFnLCBjaGlsZFRhZyk7XG4gIH0sXG4gIGRpc2Nvbm5lY3RBbmltYXRlZE5vZGVzOiBmdW5jdGlvbihwYXJlbnRUYWc6IG51bWJlciwgY2hpbGRUYWc6IG51bWJlcik6IHZvaWQge1xuICAgIGludmFyaWFudChOYXRpdmVBbmltYXRlZE1vZHVsZSwgJ05hdGl2ZSBhbmltYXRlZCBtb2R1bGUgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLmRpc2Nvbm5lY3RBbmltYXRlZE5vZGVzKHBhcmVudFRhZywgY2hpbGRUYWcpO1xuICB9LFxuICBzdGFydEFuaW1hdGluZ05vZGU6IGZ1bmN0aW9uKFxuICAgIGFuaW1hdGlvbklkOiBudW1iZXIsXG4gICAgbm9kZVRhZzogbnVtYmVyLFxuICAgIGNvbmZpZzogQW5pbWF0aW5nTm9kZUNvbmZpZyxcbiAgICBlbmRDYWxsYmFjazogRW5kQ2FsbGJhY2ssXG4gICk6IHZvaWQge1xuICAgIGludmFyaWFudChOYXRpdmVBbmltYXRlZE1vZHVsZSwgJ05hdGl2ZSBhbmltYXRlZCBtb2R1bGUgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLnN0YXJ0QW5pbWF0aW5nTm9kZShcbiAgICAgIGFuaW1hdGlvbklkLFxuICAgICAgbm9kZVRhZyxcbiAgICAgIGNvbmZpZyxcbiAgICAgIGVuZENhbGxiYWNrLFxuICAgICk7XG4gIH0sXG4gIHN0b3BBbmltYXRpb246IGZ1bmN0aW9uKGFuaW1hdGlvbklkOiBudW1iZXIpIHtcbiAgICBpbnZhcmlhbnQoTmF0aXZlQW5pbWF0ZWRNb2R1bGUsICdOYXRpdmUgYW5pbWF0ZWQgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5zdG9wQW5pbWF0aW9uKGFuaW1hdGlvbklkKTtcbiAgfSxcbiAgc2V0QW5pbWF0ZWROb2RlVmFsdWU6IGZ1bmN0aW9uKG5vZGVUYWc6IG51bWJlciwgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIGludmFyaWFudChOYXRpdmVBbmltYXRlZE1vZHVsZSwgJ05hdGl2ZSBhbmltYXRlZCBtb2R1bGUgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLnNldEFuaW1hdGVkTm9kZVZhbHVlKG5vZGVUYWcsIHZhbHVlKTtcbiAgfSxcbiAgc2V0QW5pbWF0ZWROb2RlT2Zmc2V0OiBmdW5jdGlvbihub2RlVGFnOiBudW1iZXIsIG9mZnNldDogbnVtYmVyKTogdm9pZCB7XG4gICAgaW52YXJpYW50KE5hdGl2ZUFuaW1hdGVkTW9kdWxlLCAnTmF0aXZlIGFuaW1hdGVkIG1vZHVsZSBpcyBub3QgYXZhaWxhYmxlJyk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuc2V0QW5pbWF0ZWROb2RlT2Zmc2V0KG5vZGVUYWcsIG9mZnNldCk7XG4gIH0sXG4gIGZsYXR0ZW5BbmltYXRlZE5vZGVPZmZzZXQ6IGZ1bmN0aW9uKG5vZGVUYWc6IG51bWJlcik6IHZvaWQge1xuICAgIGludmFyaWFudChOYXRpdmVBbmltYXRlZE1vZHVsZSwgJ05hdGl2ZSBhbmltYXRlZCBtb2R1bGUgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLmZsYXR0ZW5BbmltYXRlZE5vZGVPZmZzZXQobm9kZVRhZyk7XG4gIH0sXG4gIGV4dHJhY3RBbmltYXRlZE5vZGVPZmZzZXQ6IGZ1bmN0aW9uKG5vZGVUYWc6IG51bWJlcik6IHZvaWQge1xuICAgIGludmFyaWFudChOYXRpdmVBbmltYXRlZE1vZHVsZSwgJ05hdGl2ZSBhbmltYXRlZCBtb2R1bGUgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLmV4dHJhY3RBbmltYXRlZE5vZGVPZmZzZXQobm9kZVRhZyk7XG4gIH0sXG4gIGNvbm5lY3RBbmltYXRlZE5vZGVUb1ZpZXc6IGZ1bmN0aW9uKG5vZGVUYWc6IG51bWJlciwgdmlld1RhZzogbnVtYmVyKTogdm9pZCB7XG4gICAgaW52YXJpYW50KE5hdGl2ZUFuaW1hdGVkTW9kdWxlLCAnTmF0aXZlIGFuaW1hdGVkIG1vZHVsZSBpcyBub3QgYXZhaWxhYmxlJyk7XG4gICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUuY29ubmVjdEFuaW1hdGVkTm9kZVRvVmlldyhub2RlVGFnLCB2aWV3VGFnKTtcbiAgfSxcbiAgZGlzY29ubmVjdEFuaW1hdGVkTm9kZUZyb21WaWV3OiBmdW5jdGlvbihcbiAgICBub2RlVGFnOiBudW1iZXIsXG4gICAgdmlld1RhZzogbnVtYmVyLFxuICApOiB2b2lkIHtcbiAgICBpbnZhcmlhbnQoTmF0aXZlQW5pbWF0ZWRNb2R1bGUsICdOYXRpdmUgYW5pbWF0ZWQgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5kaXNjb25uZWN0QW5pbWF0ZWROb2RlRnJvbVZpZXcobm9kZVRhZywgdmlld1RhZyk7XG4gIH0sXG4gIHJlc3RvcmVEZWZhdWx0VmFsdWVzOiBmdW5jdGlvbihub2RlVGFnOiBudW1iZXIpOiB2b2lkIHtcbiAgICBpbnZhcmlhbnQoTmF0aXZlQW5pbWF0ZWRNb2R1bGUsICdOYXRpdmUgYW5pbWF0ZWQgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICAvLyBCYWNrd2FyZHMgY29tcGF0IHdpdGggb2xkZXIgbmF0aXZlIHJ1bnRpbWVzLCBjYW4gYmUgcmVtb3ZlZCBsYXRlci5cbiAgICBpZiAoTmF0aXZlQW5pbWF0ZWRNb2R1bGUucmVzdG9yZURlZmF1bHRWYWx1ZXMgIT0gbnVsbCkge1xuICAgICAgTmF0aXZlQW5pbWF0ZWRNb2R1bGUucmVzdG9yZURlZmF1bHRWYWx1ZXMobm9kZVRhZyk7XG4gICAgfVxuICB9LFxuICBkcm9wQW5pbWF0ZWROb2RlOiBmdW5jdGlvbih0YWc6IG51bWJlcik6IHZvaWQge1xuICAgIGludmFyaWFudChOYXRpdmVBbmltYXRlZE1vZHVsZSwgJ05hdGl2ZSBhbmltYXRlZCBtb2R1bGUgaXMgbm90IGF2YWlsYWJsZScpO1xuICAgIE5hdGl2ZUFuaW1hdGVkTW9kdWxlLmRyb3BBbmltYXRlZE5vZGUodGFnKTtcbiAgfSxcbiAgYWRkQW5pbWF0ZWRFdmVudFRvVmlldzogZnVuY3Rpb24oXG4gICAgdmlld1RhZzogbnVtYmVyLFxuICAgIGV2ZW50TmFtZTogc3RyaW5nLFxuICAgIGV2ZW50TWFwcGluZzogRXZlbnRNYXBwaW5nLFxuICApIHtcbiAgICBpbnZhcmlhbnQoTmF0aXZlQW5pbWF0ZWRNb2R1bGUsICdOYXRpdmUgYW5pbWF0ZWQgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5hZGRBbmltYXRlZEV2ZW50VG9WaWV3KFxuICAgICAgdmlld1RhZyxcbiAgICAgIGV2ZW50TmFtZSxcbiAgICAgIGV2ZW50TWFwcGluZyxcbiAgICApO1xuICB9LFxuICByZW1vdmVBbmltYXRlZEV2ZW50RnJvbVZpZXcoXG4gICAgdmlld1RhZzogbnVtYmVyLFxuICAgIGV2ZW50TmFtZTogc3RyaW5nLFxuICAgIGFuaW1hdGVkTm9kZVRhZzogbnVtYmVyLFxuICApIHtcbiAgICBpbnZhcmlhbnQoTmF0aXZlQW5pbWF0ZWRNb2R1bGUsICdOYXRpdmUgYW5pbWF0ZWQgbW9kdWxlIGlzIG5vdCBhdmFpbGFibGUnKTtcbiAgICBOYXRpdmVBbmltYXRlZE1vZHVsZS5yZW1vdmVBbmltYXRlZEV2ZW50RnJvbVZpZXcoXG4gICAgICB2aWV3VGFnLFxuICAgICAgZXZlbnROYW1lLFxuICAgICAgYW5pbWF0ZWROb2RlVGFnLFxuICAgICk7XG4gIH0sXG59O1xuXG4vKipcbiAqIFN0eWxlcyBhbGxvd2VkIGJ5IHRoZSBuYXRpdmUgYW5pbWF0ZWQgaW1wbGVtZW50YXRpb24uXG4gKlxuICogSW4gZ2VuZXJhbCBuYXRpdmUgYW5pbWF0ZWQgaW1wbGVtZW50YXRpb24gc2hvdWxkIHN1cHBvcnQgYW55IG51bWVyaWMgcHJvcGVydHkgdGhhdCBkb2Vzbid0IG5lZWRcbiAqIHRvIGJlIHVwZGF0ZWQgdGhyb3VnaCB0aGUgc2hhZG93IHZpZXcgaGllcmFyY2h5IChhbGwgbm9uLWxheW91dCBwcm9wZXJ0aWVzKS5cbiAqL1xuY29uc3QgU1RZTEVTX1dISVRFTElTVCA9IHtcbiAgb3BhY2l0eTogdHJ1ZSxcbiAgdHJhbnNmb3JtOiB0cnVlLFxuICBib3JkZXJSYWRpdXM6IHRydWUsXG4gIGJvcmRlckJvdHRvbUVuZFJhZGl1czogdHJ1ZSxcbiAgYm9yZGVyQm90dG9tTGVmdFJhZGl1czogdHJ1ZSxcbiAgYm9yZGVyQm90dG9tUmlnaHRSYWRpdXM6IHRydWUsXG4gIGJvcmRlckJvdHRvbVN0YXJ0UmFkaXVzOiB0cnVlLFxuICBib3JkZXJUb3BFbmRSYWRpdXM6IHRydWUsXG4gIGJvcmRlclRvcExlZnRSYWRpdXM6IHRydWUsXG4gIGJvcmRlclRvcFJpZ2h0UmFkaXVzOiB0cnVlLFxuICBib3JkZXJUb3BTdGFydFJhZGl1czogdHJ1ZSxcbiAgZWxldmF0aW9uOiB0cnVlLFxuICB6SW5kZXg6IHRydWUsXG4gIC8qIGlvcyBzdHlsZXMgKi9cbiAgc2hhZG93T3BhY2l0eTogdHJ1ZSxcbiAgc2hhZG93UmFkaXVzOiB0cnVlLFxuICAvKiBsZWdhY3kgYW5kcm9pZCB0cmFuc2Zvcm0gcHJvcGVydGllcyAqL1xuICBzY2FsZVg6IHRydWUsXG4gIHNjYWxlWTogdHJ1ZSxcbiAgdHJhbnNsYXRlWDogdHJ1ZSxcbiAgdHJhbnNsYXRlWTogdHJ1ZSxcbn07XG5cbmNvbnN0IFRSQU5TRk9STV9XSElURUxJU1QgPSB7XG4gIHRyYW5zbGF0ZVg6IHRydWUsXG4gIHRyYW5zbGF0ZVk6IHRydWUsXG4gIHNjYWxlOiB0cnVlLFxuICBzY2FsZVg6IHRydWUsXG4gIHNjYWxlWTogdHJ1ZSxcbiAgcm90YXRlOiB0cnVlLFxuICByb3RhdGVYOiB0cnVlLFxuICByb3RhdGVZOiB0cnVlLFxuICByb3RhdGVaOiB0cnVlLFxuICBwZXJzcGVjdGl2ZTogdHJ1ZSxcbn07XG5cbmNvbnN0IFNVUFBPUlRFRF9JTlRFUlBPTEFUSU9OX1BBUkFNUyA9IHtcbiAgaW5wdXRSYW5nZTogdHJ1ZSxcbiAgb3V0cHV0UmFuZ2U6IHRydWUsXG4gIGV4dHJhcG9sYXRlOiB0cnVlLFxuICBleHRyYXBvbGF0ZVJpZ2h0OiB0cnVlLFxuICBleHRyYXBvbGF0ZUxlZnQ6IHRydWUsXG59O1xuXG5mdW5jdGlvbiBhZGRXaGl0ZWxpc3RlZFN0eWxlUHJvcChwcm9wOiBzdHJpbmcpOiB2b2lkIHtcbiAgU1RZTEVTX1dISVRFTElTVFtwcm9wXSA9IHRydWU7XG59XG5cbmZ1bmN0aW9uIGFkZFdoaXRlbGlzdGVkVHJhbnNmb3JtUHJvcChwcm9wOiBzdHJpbmcpOiB2b2lkIHtcbiAgVFJBTlNGT1JNX1dISVRFTElTVFtwcm9wXSA9IHRydWU7XG59XG5cbmZ1bmN0aW9uIGFkZFdoaXRlbGlzdGVkSW50ZXJwb2xhdGlvblBhcmFtKHBhcmFtOiBzdHJpbmcpOiB2b2lkIHtcbiAgU1VQUE9SVEVEX0lOVEVSUE9MQVRJT05fUEFSQU1TW3BhcmFtXSA9IHRydWU7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlVHJhbnNmb3JtKFxuICBjb25maWdzOiBBcnJheTxcbiAgICB8IHtcbiAgICAgICAgdHlwZTogJ2FuaW1hdGVkJyxcbiAgICAgICAgcHJvcGVydHk6IHN0cmluZyxcbiAgICAgICAgbm9kZVRhZzogP251bWJlcixcbiAgICAgICAgLi4uXG4gICAgICB9XG4gICAgfCB7XG4gICAgICAgIHR5cGU6ICdzdGF0aWMnLFxuICAgICAgICBwcm9wZXJ0eTogc3RyaW5nLFxuICAgICAgICB2YWx1ZTogbnVtYmVyIHwgc3RyaW5nLFxuICAgICAgICAuLi5cbiAgICAgIH0sXG4gID4sXG4pOiB2b2lkIHtcbiAgY29uZmlncy5mb3JFYWNoKGNvbmZpZyA9PiB7XG4gICAgaWYgKCFUUkFOU0ZPUk1fV0hJVEVMSVNULmhhc093blByb3BlcnR5KGNvbmZpZy5wcm9wZXJ0eSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFByb3BlcnR5ICcke1xuICAgICAgICAgIGNvbmZpZy5wcm9wZXJ0eVxuICAgICAgICB9JyBpcyBub3Qgc3VwcG9ydGVkIGJ5IG5hdGl2ZSBhbmltYXRlZCBtb2R1bGVgLFxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZVN0eWxlcyhzdHlsZXM6IHtba2V5OiBzdHJpbmddOiA/bnVtYmVyLCAuLi59KTogdm9pZCB7XG4gIGZvciAoY29uc3Qga2V5IGluIHN0eWxlcykge1xuICAgIGlmICghU1RZTEVTX1dISVRFTElTVC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBTdHlsZSBwcm9wZXJ0eSAnJHtrZXl9JyBpcyBub3Qgc3VwcG9ydGVkIGJ5IG5hdGl2ZSBhbmltYXRlZCBtb2R1bGVgLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVJbnRlcnBvbGF0aW9uKGNvbmZpZzogSW50ZXJwb2xhdGlvbkNvbmZpZ1R5cGUpOiB2b2lkIHtcbiAgZm9yIChjb25zdCBrZXkgaW4gY29uZmlnKSB7XG4gICAgaWYgKCFTVVBQT1JURURfSU5URVJQT0xBVElPTl9QQVJBTVMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSW50ZXJwb2xhdGlvbiBwcm9wZXJ0eSAnJHtrZXl9JyBpcyBub3Qgc3VwcG9ydGVkIGJ5IG5hdGl2ZSBhbmltYXRlZCBtb2R1bGVgLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVOZXdOb2RlVGFnKCk6IG51bWJlciB7XG4gIHJldHVybiBfX25hdGl2ZUFuaW1hdGVkTm9kZVRhZ0NvdW50Kys7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlTmV3QW5pbWF0aW9uSWQoKTogbnVtYmVyIHtcbiAgcmV0dXJuIF9fbmF0aXZlQW5pbWF0aW9uSWRDb3VudCsrO1xufVxuXG5mdW5jdGlvbiBhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSgpOiB2b2lkIHtcbiAgaW52YXJpYW50KE5hdGl2ZUFuaW1hdGVkTW9kdWxlLCAnTmF0aXZlIGFuaW1hdGVkIG1vZHVsZSBpcyBub3QgYXZhaWxhYmxlJyk7XG59XG5cbmxldCBfd2FybmVkTWlzc2luZ05hdGl2ZUFuaW1hdGVkID0gZmFsc2U7XG5cbmZ1bmN0aW9uIHNob3VsZFVzZU5hdGl2ZURyaXZlcihcbiAgY29uZmlnOiB7Li4uQW5pbWF0aW9uQ29uZmlnLCAuLi59IHwgRXZlbnRDb25maWcsXG4pOiBib29sZWFuIHtcbiAgaWYgKGNvbmZpZy51c2VOYXRpdmVEcml2ZXIgPT0gbnVsbCkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgICdBbmltYXRlZDogYHVzZU5hdGl2ZURyaXZlcmAgd2FzIG5vdCBzcGVjaWZpZWQuIFRoaXMgaXMgYSByZXF1aXJlZCAnICtcbiAgICAgICAgJ29wdGlvbiBhbmQgbXVzdCBiZSBleHBsaWNpdGx5IHNldCB0byBgdHJ1ZWAgb3IgYGZhbHNlYCcsXG4gICAgKTtcbiAgfVxuXG4gIGlmIChjb25maWcudXNlTmF0aXZlRHJpdmVyID09PSB0cnVlICYmICFOYXRpdmVBbmltYXRlZE1vZHVsZSkge1xuICAgIGlmICghX3dhcm5lZE1pc3NpbmdOYXRpdmVBbmltYXRlZCkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnQW5pbWF0ZWQ6IGB1c2VOYXRpdmVEcml2ZXJgIGlzIG5vdCBzdXBwb3J0ZWQgYmVjYXVzZSB0aGUgbmF0aXZlICcgK1xuICAgICAgICAgICdhbmltYXRlZCBtb2R1bGUgaXMgbWlzc2luZy4gRmFsbGluZyBiYWNrIHRvIEpTLWJhc2VkIGFuaW1hdGlvbi4gVG8gJyArXG4gICAgICAgICAgJ3Jlc29sdmUgdGhpcywgYWRkIGBSQ1RBbmltYXRpb25gIG1vZHVsZSB0byB0aGlzIGFwcCwgb3IgcmVtb3ZlICcgK1xuICAgICAgICAgICdgdXNlTmF0aXZlRHJpdmVyYC4gJyArXG4gICAgICAgICAgJ01ha2Ugc3VyZSB0byBydW4gYHBvZCBpbnN0YWxsYCBmaXJzdC4gUmVhZCBtb3JlIGFib3V0IGF1dG9saW5raW5nOiBodHRwczovL2dpdGh1Yi5jb20vcmVhY3QtbmF0aXZlLWNvbW11bml0eS9jbGkvYmxvYi9tYXN0ZXIvZG9jcy9hdXRvbGlua2luZy5tZCcsXG4gICAgICApO1xuICAgICAgX3dhcm5lZE1pc3NpbmdOYXRpdmVBbmltYXRlZCA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiBjb25maWcudXNlTmF0aXZlRHJpdmVyIHx8IGZhbHNlO1xufVxuXG5mdW5jdGlvbiB0cmFuc2Zvcm1EYXRhVHlwZSh2YWx1ZTogbnVtYmVyIHwgc3RyaW5nKTogbnVtYmVyIHwgc3RyaW5nIHtcbiAgLy8gQ2hhbmdlIHRoZSBzdHJpbmcgdHlwZSB0byBudW1iZXIgdHlwZSBzbyB3ZSBjYW4gcmV1c2UgdGhlIHNhbWUgbG9naWMgaW5cbiAgLy8gaU9TIGFuZCBBbmRyb2lkIHBsYXRmb3JtXG4gIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmICgvZGVnJC8udGVzdCh2YWx1ZSkpIHtcbiAgICBjb25zdCBkZWdyZWVzID0gcGFyc2VGbG9hdCh2YWx1ZSkgfHwgMDtcbiAgICBjb25zdCByYWRpYW5zID0gKGRlZ3JlZXMgKiBNYXRoLlBJKSAvIDE4MC4wO1xuICAgIHJldHVybiByYWRpYW5zO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgQVBJLFxuICBhZGRXaGl0ZWxpc3RlZFN0eWxlUHJvcCxcbiAgYWRkV2hpdGVsaXN0ZWRUcmFuc2Zvcm1Qcm9wLFxuICBhZGRXaGl0ZWxpc3RlZEludGVycG9sYXRpb25QYXJhbSxcbiAgdmFsaWRhdGVTdHlsZXMsXG4gIHZhbGlkYXRlVHJhbnNmb3JtLFxuICB2YWxpZGF0ZUludGVycG9sYXRpb24sXG4gIGdlbmVyYXRlTmV3Tm9kZVRhZyxcbiAgZ2VuZXJhdGVOZXdBbmltYXRpb25JZCxcbiAgYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUsXG4gIHNob3VsZFVzZU5hdGl2ZURyaXZlcixcbiAgdHJhbnNmb3JtRGF0YVR5cGUsXG4gIC8vICRGbG93RXhwZWN0ZWRFcnJvciAtIHVuc2FmZSBnZXR0ZXIgbGludCBzdXBwcmVzaW9uXG4gIGdldCBuYXRpdmVFdmVudEVtaXR0ZXIoKTogTmF0aXZlRXZlbnRFbWl0dGVyIHtcbiAgICBpZiAoIW5hdGl2ZUV2ZW50RW1pdHRlcikge1xuICAgICAgbmF0aXZlRXZlbnRFbWl0dGVyID0gbmV3IE5hdGl2ZUV2ZW50RW1pdHRlcihOYXRpdmVBbmltYXRlZE1vZHVsZSk7XG4gICAgfVxuICAgIHJldHVybiBuYXRpdmVFdmVudEVtaXR0ZXI7XG4gIH0sXG59O1xuIl19