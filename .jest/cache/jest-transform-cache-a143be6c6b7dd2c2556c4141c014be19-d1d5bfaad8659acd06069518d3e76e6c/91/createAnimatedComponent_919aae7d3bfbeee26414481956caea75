514cfabd8eaf8a649e9d18a4d5489c90
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var _require = require("./AnimatedEvent"),
    AnimatedEvent = _require.AnimatedEvent;

var AnimatedProps = require("./nodes/AnimatedProps");

var React = require('react');

var invariant = require('invariant');

var setAndForwardRef = require("../../Utilities/setAndForwardRef");

function createAnimatedComponent(Component) {
  invariant(typeof Component !== 'function' || Component.prototype && Component.prototype.isReactComponent, '`createAnimatedComponent` does not support stateless functional components; ' + 'use a class component instead.');

  var AnimatedComponent = function (_React$Component) {
    (0, _inherits2.default)(AnimatedComponent, _React$Component);

    var _super = _createSuper(AnimatedComponent);

    function AnimatedComponent() {
      var _this;

      (0, _classCallCheck2.default)(this, AnimatedComponent);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _super.call.apply(_super, [this].concat(args));
      _this._invokeAnimatedPropsCallbackOnMount = false;
      _this._eventDetachers = [];

      _this._animatedPropsCallback = function () {
        var _this$_component$_int, _this$_component$_int2, _this$_component$getN, _this$_component$getN2, _this$_component$getS, _this$_component$getS2;

        if (_this._component == null) {
          _this._invokeAnimatedPropsCallbackOnMount = true;
        } else if (process.env.NODE_ENV === 'test' || typeof _this._component.setNativeProps !== 'function' || ((_this$_component$_int = _this._component['_internalInstanceHandle']) == null ? void 0 : (_this$_component$_int2 = _this$_component$_int.stateNode) == null ? void 0 : _this$_component$_int2.canonical) != null || _this._component.getNativeScrollRef != null && _this._component.getNativeScrollRef() != null && ((_this$_component$getN = _this._component.getNativeScrollRef()['_internalInstanceHandle']) == null ? void 0 : (_this$_component$getN2 = _this$_component$getN.stateNode) == null ? void 0 : _this$_component$getN2.canonical) != null || _this._component.getScrollResponder != null && _this._component.getScrollResponder().getNativeScrollRef != null && _this._component.getScrollResponder().getNativeScrollRef() != null && ((_this$_component$getS = _this._component.getScrollResponder().getNativeScrollRef()['_internalInstanceHandle']) == null ? void 0 : (_this$_component$getS2 = _this$_component$getS.stateNode) == null ? void 0 : _this$_component$getS2.canonical) != null) {
          _this.forceUpdate();
        } else if (!_this._propsAnimated.__isNative) {
          _this._component.setNativeProps(_this._propsAnimated.__getAnimatedValue());
        } else {
          throw new Error('Attempting to run JS driven animation on animated ' + 'node that has been moved to "native" earlier by starting an ' + 'animation with `useNativeDriver: true`');
        }
      };

      _this._setComponentRef = setAndForwardRef({
        getForwardedRef: function getForwardedRef() {
          return _this.props.forwardedRef;
        },
        setLocalRef: function setLocalRef(ref) {
          _this._prevComponent = _this._component;
          _this._component = ref;

          if (ref != null && ref.getNode == null) {
            ref.getNode = function () {
              var _ref$constructor$name;

              console.warn('%s: Calling `getNode()` on the ref of an Animated component ' + 'is no longer necessary. You can now directly use the ref ' + 'instead. This method will be removed in a future release.', (_ref$constructor$name = ref.constructor.name) != null ? _ref$constructor$name : '<<anonymous>>');
              return ref;
            };
          }
        }
      });
      return _this;
    }

    (0, _createClass2.default)(AnimatedComponent, [{
      key: "_attachNativeEvents",
      value: function _attachNativeEvents() {
        var _this$_component,
            _this2 = this;

        var scrollableNode = (_this$_component = this._component) != null && _this$_component.getScrollableNode ? this._component.getScrollableNode() : this._component;

        var _loop = function _loop(key) {
          var prop = _this2.props[key];

          if (prop instanceof AnimatedEvent && prop.__isNative) {
            prop.__attach(scrollableNode, key);

            _this2._eventDetachers.push(function () {
              return prop.__detach(scrollableNode, key);
            });
          }
        };

        for (var key in this.props) {
          _loop(key);
        }
      }
    }, {
      key: "_detachNativeEvents",
      value: function _detachNativeEvents() {
        this._eventDetachers.forEach(function (remove) {
          return remove();
        });

        this._eventDetachers = [];
      }
    }, {
      key: "_attachProps",
      value: function _attachProps(nextProps) {
        var oldPropsAnimated = this._propsAnimated;
        this._propsAnimated = new AnimatedProps(nextProps, this._animatedPropsCallback);

        if (oldPropsAnimated) {
          oldPropsAnimated.__restoreDefaultValues();

          oldPropsAnimated.__detach();
        }
      }
    }, {
      key: "render",
      value: function render() {
        var props = this._propsAnimated.__getValue();

        return React.createElement(Component, (0, _extends2.default)({}, props, {
          ref: this._setComponentRef,
          collapsable: this._propsAnimated.__isNative ? false : props.collapsable
        }));
      }
    }, {
      key: "UNSAFE_componentWillMount",
      value: function UNSAFE_componentWillMount() {
        this._attachProps(this.props);
      }
    }, {
      key: "componentDidMount",
      value: function componentDidMount() {
        if (this._invokeAnimatedPropsCallbackOnMount) {
          this._invokeAnimatedPropsCallbackOnMount = false;

          this._animatedPropsCallback();
        }

        this._propsAnimated.setNativeView(this._component);

        this._attachNativeEvents();
      }
    }, {
      key: "UNSAFE_componentWillReceiveProps",
      value: function UNSAFE_componentWillReceiveProps(newProps) {
        this._attachProps(newProps);
      }
    }, {
      key: "componentDidUpdate",
      value: function componentDidUpdate(prevProps) {
        if (this._component !== this._prevComponent) {
          this._propsAnimated.setNativeView(this._component);
        }

        if (this._component !== this._prevComponent || prevProps !== this.props) {
          this._detachNativeEvents();

          this._attachNativeEvents();
        }
      }
    }, {
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        this._propsAnimated && this._propsAnimated.__detach();

        this._detachNativeEvents();
      }
    }]);
    return AnimatedComponent;
  }(React.Component);

  return React.forwardRef(function AnimatedComponentWrapper(props, ref) {
    return React.createElement(AnimatedComponent, (0, _extends2.default)({}, props, ref == null ? null : {
      forwardedRef: ref
    }));
  });
}

module.exports = createAnimatedComponent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50LmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJBbmltYXRlZEV2ZW50IiwiQW5pbWF0ZWRQcm9wcyIsIlJlYWN0IiwiaW52YXJpYW50Iiwic2V0QW5kRm9yd2FyZFJlZiIsImNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50IiwiQ29tcG9uZW50IiwicHJvdG90eXBlIiwiaXNSZWFjdENvbXBvbmVudCIsIkFuaW1hdGVkQ29tcG9uZW50IiwiX2ludm9rZUFuaW1hdGVkUHJvcHNDYWxsYmFja09uTW91bnQiLCJfZXZlbnREZXRhY2hlcnMiLCJfYW5pbWF0ZWRQcm9wc0NhbGxiYWNrIiwiX2NvbXBvbmVudCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInNldE5hdGl2ZVByb3BzIiwic3RhdGVOb2RlIiwiY2Fub25pY2FsIiwiZ2V0TmF0aXZlU2Nyb2xsUmVmIiwiZ2V0U2Nyb2xsUmVzcG9uZGVyIiwiZm9yY2VVcGRhdGUiLCJfcHJvcHNBbmltYXRlZCIsIl9faXNOYXRpdmUiLCJfX2dldEFuaW1hdGVkVmFsdWUiLCJFcnJvciIsIl9zZXRDb21wb25lbnRSZWYiLCJnZXRGb3J3YXJkZWRSZWYiLCJwcm9wcyIsImZvcndhcmRlZFJlZiIsInNldExvY2FsUmVmIiwicmVmIiwiX3ByZXZDb21wb25lbnQiLCJnZXROb2RlIiwiY29uc29sZSIsIndhcm4iLCJjb25zdHJ1Y3RvciIsIm5hbWUiLCJzY3JvbGxhYmxlTm9kZSIsImdldFNjcm9sbGFibGVOb2RlIiwia2V5IiwicHJvcCIsIl9fYXR0YWNoIiwicHVzaCIsIl9fZGV0YWNoIiwiZm9yRWFjaCIsInJlbW92ZSIsIm5leHRQcm9wcyIsIm9sZFByb3BzQW5pbWF0ZWQiLCJfX3Jlc3RvcmVEZWZhdWx0VmFsdWVzIiwiX19nZXRWYWx1ZSIsImNvbGxhcHNhYmxlIiwiX2F0dGFjaFByb3BzIiwic2V0TmF0aXZlVmlldyIsIl9hdHRhY2hOYXRpdmVFdmVudHMiLCJuZXdQcm9wcyIsInByZXZQcm9wcyIsIl9kZXRhY2hOYXRpdmVFdmVudHMiLCJmb3J3YXJkUmVmIiwiQW5pbWF0ZWRDb21wb25lbnRXcmFwcGVyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsZUFBd0JBLE9BQU8sbUJBQS9CO0FBQUEsSUFBT0MsYUFBUCxZQUFPQSxhQUFQOztBQUNBLElBQU1DLGFBQWEsR0FBR0YsT0FBTyx5QkFBN0I7O0FBQ0EsSUFBTUcsS0FBSyxHQUFHSCxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFFQSxJQUFNSSxTQUFTLEdBQUdKLE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUNBLElBQU1LLGdCQUFnQixHQUFHTCxPQUFPLG9DQUFoQzs7QUFPQSxTQUFTTSx1QkFBVCxDQUNFQyxTQURGLEVBRTBDO0FBQ3hDSCxFQUFBQSxTQUFTLENBQ1AsT0FBT0csU0FBUCxLQUFxQixVQUFyQixJQUNHQSxTQUFTLENBQUNDLFNBQVYsSUFBdUJELFNBQVMsQ0FBQ0MsU0FBVixDQUFvQkMsZ0JBRnZDLEVBR1AsaUZBQ0UsZ0NBSkssQ0FBVDs7QUFEd0MsTUFRbENDLGlCQVJrQztBQUFBOztBQUFBOztBQUFBO0FBQUE7O0FBQUE7O0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUEsWUFVdENDLG1DQVZzQyxHQVVTLEtBVlQ7QUFBQSxZQWF0Q0MsZUFic0MsR0FhSCxFQWJHOztBQUFBLFlBeUN0Q0Msc0JBekNzQyxHQXlDYixZQUFNO0FBQUE7O0FBQzdCLFlBQUksTUFBS0MsVUFBTCxJQUFtQixJQUF2QixFQUE2QjtBQU0zQixnQkFBS0gsbUNBQUwsR0FBMkMsSUFBM0M7QUFDRCxTQVBELE1BT08sSUFDTEksT0FBTyxDQUFDQyxHQUFSLENBQVlDLFFBQVosS0FBeUIsTUFBekIsSUFFQSxPQUFPLE1BQUtILFVBQUwsQ0FBZ0JJLGNBQXZCLEtBQTBDLFVBRjFDLElBS0EsZ0NBQUtKLFVBQUwsQ0FBZ0IseUJBQWhCLHNFQUE0Q0ssU0FBNUMsNENBQXVEQyxT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QSxhQTBLdEMsNEJBQW1CQyxTQUFuQixFQUE4QjtBQUM1QixZQUFJLEtBQUs1QyxVQUFMLEtBQW9CLEtBQUtvQixjQUE3QixFQUE2QztBQUMzQyxlQUFLVixjQUFMLENBQW9CK0IsYUFBcEIsQ0FBa0MsS0FBS3pDLFVBQXZDO0FBQ0Q7O0FBQ0QsWUFBSSxLQUFLQSxVQUFMLEtBQW9CLEtBQUtvQixjQUF6QixJQUEyQ3dCLFNBQVMsS0FBSyxLQUFLNUIsS0FBbEUsRUFBeUU7QUFDdkUsZUFBSzZCLG1CQUFMOztBQUNBLGVBQUtILG1CQUFMO0FBQ0Q7QUFDRjtBQWxMcUM7QUFBQTtBQUFBLGFBb0x0QyxnQ0FBdUI7QUFDckIsYUFBS2hDLGNBQUwsSUFBdUIsS0FBS0EsY0FBTCxDQUFvQnNCLFFBQXBCLEVBQXZCOztBQUNBLGFBQUthLG1CQUFMO0FBQ0Q7QUF2THFDO0FBQUE7QUFBQSxJQVFSeEQsS0FBSyxDQUFDSSxTQVJFOztBQTBMeEMsU0FBT0osS0FBSyxDQUFDeUQsVUFBTixDQUFpQixTQUFTQyx3QkFBVCxDQUFrQy9CLEtBQWxDLEVBQXlDRyxHQUF6QyxFQUE4QztBQUNwRSxXQUNFLG9CQUFDLGlCQUFELDZCQUNNSCxLQUROLEVBRU9HLEdBQUcsSUFBSSxJQUFQLEdBQWMsSUFBZCxHQUFxQjtBQUFDRixNQUFBQSxZQUFZLEVBQUVFO0FBQWYsS0FGNUIsRUFERjtBQU1ELEdBUE0sQ0FBUDtBQVFEOztBQUVENkIsTUFBTSxDQUFDQyxPQUFQLEdBQWlCekQsdUJBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3Qge0FuaW1hdGVkRXZlbnR9ID0gcmVxdWlyZSgnLi9BbmltYXRlZEV2ZW50Jyk7XG5jb25zdCBBbmltYXRlZFByb3BzID0gcmVxdWlyZSgnLi9ub2Rlcy9BbmltYXRlZFByb3BzJyk7XG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuY29uc3Qgc2V0QW5kRm9yd2FyZFJlZiA9IHJlcXVpcmUoJy4uLy4uL1V0aWxpdGllcy9zZXRBbmRGb3J3YXJkUmVmJyk7XG5cbmV4cG9ydCB0eXBlIEFuaW1hdGVkQ29tcG9uZW50VHlwZTxcbiAgUHJvcHM6IHsrW3N0cmluZ106IG1peGVkLCAuLi59LFxuICBJbnN0YW5jZSxcbj4gPSBSZWFjdC5BYnN0cmFjdENvbXBvbmVudDwkT2JqTWFwPFByb3BzLCAoKSA9PiBhbnk+LCBJbnN0YW5jZT47XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuaW1hdGVkQ29tcG9uZW50PFByb3BzOiB7K1tzdHJpbmddOiBtaXhlZCwgLi4ufSwgSW5zdGFuY2U+KFxuICBDb21wb25lbnQ6IFJlYWN0LkFic3RyYWN0Q29tcG9uZW50PFByb3BzLCBJbnN0YW5jZT4sXG4pOiBBbmltYXRlZENvbXBvbmVudFR5cGU8UHJvcHMsIEluc3RhbmNlPiB7XG4gIGludmFyaWFudChcbiAgICB0eXBlb2YgQ29tcG9uZW50ICE9PSAnZnVuY3Rpb24nIHx8XG4gICAgICAoQ29tcG9uZW50LnByb3RvdHlwZSAmJiBDb21wb25lbnQucHJvdG90eXBlLmlzUmVhY3RDb21wb25lbnQpLFxuICAgICdgY3JlYXRlQW5pbWF0ZWRDb21wb25lbnRgIGRvZXMgbm90IHN1cHBvcnQgc3RhdGVsZXNzIGZ1bmN0aW9uYWwgY29tcG9uZW50czsgJyArXG4gICAgICAndXNlIGEgY2xhc3MgY29tcG9uZW50IGluc3RlYWQuJyxcbiAgKTtcblxuICBjbGFzcyBBbmltYXRlZENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxPYmplY3Q+IHtcbiAgICBfY29tcG9uZW50OiBhbnk7IC8vIFRPRE8gVDUzNzM4MTYxOiBmbG93IHR5cGUgdGhpcywgYW5kIHRoZSB3aG9sZSBmaWxlXG4gICAgX2ludm9rZUFuaW1hdGVkUHJvcHNDYWxsYmFja09uTW91bnQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBfcHJldkNvbXBvbmVudDogYW55O1xuICAgIF9wcm9wc0FuaW1hdGVkOiBBbmltYXRlZFByb3BzO1xuICAgIF9ldmVudERldGFjaGVyczogQXJyYXk8RnVuY3Rpb24+ID0gW107XG5cbiAgICBfYXR0YWNoTmF0aXZlRXZlbnRzKCkge1xuICAgICAgLy8gTWFrZSBzdXJlIHRvIGdldCB0aGUgc2Nyb2xsYWJsZSBub2RlIGZvciBjb21wb25lbnRzIHRoYXQgaW1wbGVtZW50XG4gICAgICAvLyBgU2Nyb2xsUmVzcG9uZGVyLk1peGluYC5cbiAgICAgIGNvbnN0IHNjcm9sbGFibGVOb2RlID0gdGhpcy5fY29tcG9uZW50Py5nZXRTY3JvbGxhYmxlTm9kZVxuICAgICAgICA/IHRoaXMuX2NvbXBvbmVudC5nZXRTY3JvbGxhYmxlTm9kZSgpXG4gICAgICAgIDogdGhpcy5fY29tcG9uZW50O1xuXG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLnByb3BzKSB7XG4gICAgICAgIGNvbnN0IHByb3AgPSB0aGlzLnByb3BzW2tleV07XG4gICAgICAgIGlmIChwcm9wIGluc3RhbmNlb2YgQW5pbWF0ZWRFdmVudCAmJiBwcm9wLl9faXNOYXRpdmUpIHtcbiAgICAgICAgICBwcm9wLl9fYXR0YWNoKHNjcm9sbGFibGVOb2RlLCBrZXkpO1xuICAgICAgICAgIHRoaXMuX2V2ZW50RGV0YWNoZXJzLnB1c2goKCkgPT4gcHJvcC5fX2RldGFjaChzY3JvbGxhYmxlTm9kZSwga2V5KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBfZGV0YWNoTmF0aXZlRXZlbnRzKCkge1xuICAgICAgdGhpcy5fZXZlbnREZXRhY2hlcnMuZm9yRWFjaChyZW1vdmUgPT4gcmVtb3ZlKCkpO1xuICAgICAgdGhpcy5fZXZlbnREZXRhY2hlcnMgPSBbXTtcbiAgICB9XG5cbiAgICAvLyBUaGUgc3lzdGVtIGlzIGJlc3QgZGVzaWduZWQgd2hlbiBzZXROYXRpdmVQcm9wcyBpcyBpbXBsZW1lbnRlZC4gSXQgaXNcbiAgICAvLyBhYmxlIHRvIGF2b2lkIHJlLXJlbmRlcmluZyBhbmQgZGlyZWN0bHkgc2V0IHRoZSBhdHRyaWJ1dGVzIHRoYXQgY2hhbmdlZC5cbiAgICAvLyBIb3dldmVyLCBzZXROYXRpdmVQcm9wcyBjYW4gb25seSBiZSBpbXBsZW1lbnRlZCBvbiBsZWFmIG5hdGl2ZVxuICAgIC8vIGNvbXBvbmVudHMuIElmIHlvdSB3YW50IHRvIGFuaW1hdGUgYSBjb21wb3NpdGUgY29tcG9uZW50LCB5b3UgbmVlZCB0b1xuICAgIC8vIHJlLXJlbmRlciBpdC4gSW4gdGhpcyBjYXNlLCB3ZSBoYXZlIGEgZmFsbGJhY2sgdGhhdCB1c2VzIGZvcmNlVXBkYXRlLlxuICAgIF9hbmltYXRlZFByb3BzQ2FsbGJhY2sgPSAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5fY29tcG9uZW50ID09IG51bGwpIHtcbiAgICAgICAgLy8gQW5pbWF0ZWRQcm9wcyBpcyBjcmVhdGVkIGluIHdpbGwtbW91bnQgYmVjYXVzZSBpdCdzIHVzZWQgaW4gcmVuZGVyLlxuICAgICAgICAvLyBCdXQgdGhpcyBjYWxsYmFjayBtYXkgYmUgaW52b2tlZCBiZWZvcmUgbW91bnQgaW4gYXN5bmMgbW9kZSxcbiAgICAgICAgLy8gSW4gd2hpY2ggY2FzZSB3ZSBzaG91bGQgZGVmZXIgdGhlIHNldE5hdGl2ZVByb3BzKCkgY2FsbC5cbiAgICAgICAgLy8gUmVhY3QgbWF5IHRocm93IGF3YXkgdW5jb21taXR0ZWQgd29yayBpbiBhc3luYyBtb2RlLFxuICAgICAgICAvLyBTbyBhIGRlZmVycmVkIGNhbGwgd29uJ3QgYWx3YXlzIGJlIGludm9rZWQuXG4gICAgICAgIHRoaXMuX2ludm9rZUFuaW1hdGVkUHJvcHNDYWxsYmFja09uTW91bnQgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyB8fFxuICAgICAgICAvLyBGb3IgYW5pbWF0aW5nIHByb3BlcnRpZXMgb2Ygbm9uLWxlYWYvbm9uLW5hdGl2ZSBjb21wb25lbnRzXG4gICAgICAgIHR5cGVvZiB0aGlzLl9jb21wb25lbnQuc2V0TmF0aXZlUHJvcHMgIT09ICdmdW5jdGlvbicgfHxcbiAgICAgICAgLy8gSW4gRmFicmljLCBmb3JjZSBhbmltYXRpb25zIHRvIGdvIHRocm91Z2ggZm9yY2VVcGRhdGUgYW5kIHNraXAgc2V0TmF0aXZlUHJvcHNcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRvdC1ub3RhdGlvblxuICAgICAgICB0aGlzLl9jb21wb25lbnRbJ19pbnRlcm5hbEluc3RhbmNlSGFuZGxlJ10/LnN0YXRlTm9kZT8uY2Fub25pY2FsICE9XG4gICAgICAgICAgbnVsbCB8fFxuICAgICAgICAvLyBTb21lIGNvbXBvbmVudHMgaGF2ZSBhIHNldE5hdGl2ZVByb3BzIGZ1bmN0aW9uIGJ1dCBhcmVuJ3QgYSBob3N0IGNvbXBvbmVudFxuICAgICAgICAvLyBzdWNoIGFzIGxpc3RzIGxpa2UgRmxhdExpc3QgYW5kIFNlY3Rpb25MaXN0LiBUaGVzZSBzaG91bGQgYWxzbyB1c2VcbiAgICAgICAgLy8gZm9yY2VVcGRhdGUgaW4gRmFicmljIHNpbmNlIHNldE5hdGl2ZVByb3BzIGRvZXNuJ3QgZXhpc3Qgb24gdGhlIHVuZGVybHlpbmdcbiAgICAgICAgLy8gaG9zdCBjb21wb25lbnQuIFRoaXMgY3JhenkgaGFjayBpcyBlc3NlbnRpYWxseSBzcGVjaWFsIGNhc2luZyB0aG9zZSBsaXN0cyBhbmRcbiAgICAgICAgLy8gU2Nyb2xsVmlldyBpdHNlbGYgdG8gdXNlIGZvcmNlVXBkYXRlIGluIEZhYnJpYy5cbiAgICAgICAgLy8gSWYgdGhlc2UgY29tcG9uZW50cyBlbmQgdXAgdXNpbmcgZm9yd2FyZFJlZiB0aGVuIHRoZXNlIGhhY2tzIGNhbiBnbyBhd2F5XG4gICAgICAgIC8vIGFzIHRoaXMuX2NvbXBvbmVudCB3b3VsZCBhY3R1YWxseSBiZSB0aGUgdW5kZXJseWluZyBob3N0IGNvbXBvbmVudCBhbmQgdGhlIGFib3ZlIGNoZWNrXG4gICAgICAgIC8vIHdvdWxkIGJlIHN1ZmZpY2llbnQuXG4gICAgICAgICh0aGlzLl9jb21wb25lbnQuZ2V0TmF0aXZlU2Nyb2xsUmVmICE9IG51bGwgJiZcbiAgICAgICAgICB0aGlzLl9jb21wb25lbnQuZ2V0TmF0aXZlU2Nyb2xsUmVmKCkgIT0gbnVsbCAmJlxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkb3Qtbm90YXRpb25cbiAgICAgICAgICB0aGlzLl9jb21wb25lbnQuZ2V0TmF0aXZlU2Nyb2xsUmVmKClbJ19pbnRlcm5hbEluc3RhbmNlSGFuZGxlJ11cbiAgICAgICAgICAgID8uc3RhdGVOb2RlPy5jYW5vbmljYWwgIT0gbnVsbCkgfHxcbiAgICAgICAgKHRoaXMuX2NvbXBvbmVudC5nZXRTY3JvbGxSZXNwb25kZXIgIT0gbnVsbCAmJlxuICAgICAgICAgIHRoaXMuX2NvbXBvbmVudC5nZXRTY3JvbGxSZXNwb25kZXIoKS5nZXROYXRpdmVTY3JvbGxSZWYgIT0gbnVsbCAmJlxuICAgICAgICAgIHRoaXMuX2NvbXBvbmVudC5nZXRTY3JvbGxSZXNwb25kZXIoKS5nZXROYXRpdmVTY3JvbGxSZWYoKSAhPSBudWxsICYmXG4gICAgICAgICAgdGhpcy5fY29tcG9uZW50LmdldFNjcm9sbFJlc3BvbmRlcigpLmdldE5hdGl2ZVNjcm9sbFJlZigpW1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRvdC1ub3RhdGlvblxuICAgICAgICAgICAgJ19pbnRlcm5hbEluc3RhbmNlSGFuZGxlJ1xuICAgICAgICAgIF0/LnN0YXRlTm9kZT8uY2Fub25pY2FsICE9IG51bGwpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xuICAgICAgfSBlbHNlIGlmICghdGhpcy5fcHJvcHNBbmltYXRlZC5fX2lzTmF0aXZlKSB7XG4gICAgICAgIHRoaXMuX2NvbXBvbmVudC5zZXROYXRpdmVQcm9wcyhcbiAgICAgICAgICB0aGlzLl9wcm9wc0FuaW1hdGVkLl9fZ2V0QW5pbWF0ZWRWYWx1ZSgpLFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdBdHRlbXB0aW5nIHRvIHJ1biBKUyBkcml2ZW4gYW5pbWF0aW9uIG9uIGFuaW1hdGVkICcgK1xuICAgICAgICAgICAgJ25vZGUgdGhhdCBoYXMgYmVlbiBtb3ZlZCB0byBcIm5hdGl2ZVwiIGVhcmxpZXIgYnkgc3RhcnRpbmcgYW4gJyArXG4gICAgICAgICAgICAnYW5pbWF0aW9uIHdpdGggYHVzZU5hdGl2ZURyaXZlcjogdHJ1ZWAnLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBfYXR0YWNoUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICBjb25zdCBvbGRQcm9wc0FuaW1hdGVkID0gdGhpcy5fcHJvcHNBbmltYXRlZDtcblxuICAgICAgdGhpcy5fcHJvcHNBbmltYXRlZCA9IG5ldyBBbmltYXRlZFByb3BzKFxuICAgICAgICBuZXh0UHJvcHMsXG4gICAgICAgIHRoaXMuX2FuaW1hdGVkUHJvcHNDYWxsYmFjayxcbiAgICAgICk7XG5cbiAgICAgIC8vIFdoZW4geW91IGNhbGwgZGV0YWNoLCBpdCByZW1vdmVzIHRoZSBlbGVtZW50IGZyb20gdGhlIHBhcmVudCBsaXN0XG4gICAgICAvLyBvZiBjaGlsZHJlbi4gSWYgaXQgZ29lcyB0byAwLCB0aGVuIHRoZSBwYXJlbnQgYWxzbyBkZXRhY2hlcyBpdHNlbGZcbiAgICAgIC8vIGFuZCBzbyBvbi5cbiAgICAgIC8vIEFuIG9wdGltaXphdGlvbiBpcyB0byBhdHRhY2ggdGhlIG5ldyBlbGVtZW50cyBhbmQgVEhFTiBkZXRhY2ggdGhlIG9sZFxuICAgICAgLy8gb25lcyBpbnN0ZWFkIG9mIGRldGFjaGluZyBhbmQgVEhFTiBhdHRhY2hpbmcuXG4gICAgICAvLyBUaGlzIHdheSB0aGUgaW50ZXJtZWRpYXRlIHN0YXRlIGlzbid0IHRvIGdvIHRvIDAgYW5kIHRyaWdnZXJcbiAgICAgIC8vIHRoaXMgZXhwZW5zaXZlIHJlY3Vyc2l2ZSBkZXRhY2hpbmcgdG8gdGhlbiByZS1hdHRhY2ggZXZlcnl0aGluZyBvblxuICAgICAgLy8gdGhlIHZlcnkgbmV4dCBvcGVyYXRpb24uXG4gICAgICBpZiAob2xkUHJvcHNBbmltYXRlZCkge1xuICAgICAgICBvbGRQcm9wc0FuaW1hdGVkLl9fcmVzdG9yZURlZmF1bHRWYWx1ZXMoKTtcbiAgICAgICAgb2xkUHJvcHNBbmltYXRlZC5fX2RldGFjaCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIF9zZXRDb21wb25lbnRSZWYgPSBzZXRBbmRGb3J3YXJkUmVmKHtcbiAgICAgIGdldEZvcndhcmRlZFJlZjogKCkgPT4gdGhpcy5wcm9wcy5mb3J3YXJkZWRSZWYsXG4gICAgICBzZXRMb2NhbFJlZjogcmVmID0+IHtcbiAgICAgICAgdGhpcy5fcHJldkNvbXBvbmVudCA9IHRoaXMuX2NvbXBvbmVudDtcbiAgICAgICAgdGhpcy5fY29tcG9uZW50ID0gcmVmO1xuXG4gICAgICAgIC8vIFRPRE86IERlbGV0ZSB0aGlzIGluIGEgZnV0dXJlIHJlbGVhc2UuXG4gICAgICAgIGlmIChyZWYgIT0gbnVsbCAmJiByZWYuZ2V0Tm9kZSA9PSBudWxsKSB7XG4gICAgICAgICAgcmVmLmdldE5vZGUgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgICclczogQ2FsbGluZyBgZ2V0Tm9kZSgpYCBvbiB0aGUgcmVmIG9mIGFuIEFuaW1hdGVkIGNvbXBvbmVudCAnICtcbiAgICAgICAgICAgICAgICAnaXMgbm8gbG9uZ2VyIG5lY2Vzc2FyeS4gWW91IGNhbiBub3cgZGlyZWN0bHkgdXNlIHRoZSByZWYgJyArXG4gICAgICAgICAgICAgICAgJ2luc3RlYWQuIFRoaXMgbWV0aG9kIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSByZWxlYXNlLicsXG4gICAgICAgICAgICAgIHJlZi5jb25zdHJ1Y3Rvci5uYW1lID8/ICc8PGFub255bW91cz4+JyxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gcmVmO1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICBjb25zdCBwcm9wcyA9IHRoaXMuX3Byb3BzQW5pbWF0ZWQuX19nZXRWYWx1ZSgpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPENvbXBvbmVudFxuICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICByZWY9e3RoaXMuX3NldENvbXBvbmVudFJlZn1cbiAgICAgICAgICAvLyBUaGUgbmF0aXZlIGRyaXZlciB1cGRhdGVzIHZpZXdzIGRpcmVjdGx5IHRocm91Z2ggdGhlIFVJIHRocmVhZCBzbyB3ZVxuICAgICAgICAgIC8vIGhhdmUgdG8gbWFrZSBzdXJlIHRoZSB2aWV3IGRvZXNuJ3QgZ2V0IG9wdGltaXplZCBhd2F5IGJlY2F1c2UgaXQgY2Fubm90XG4gICAgICAgICAgLy8gZ28gdGhyb3VnaCB0aGUgTmF0aXZlVmlld0hpZXJhcmNoeU1hbmFnZXIgc2luY2UgaXQgb3BlcmF0ZXMgb24gdGhlIHNoYWRvd1xuICAgICAgICAgIC8vIHRocmVhZC5cbiAgICAgICAgICBjb2xsYXBzYWJsZT17XG4gICAgICAgICAgICB0aGlzLl9wcm9wc0FuaW1hdGVkLl9faXNOYXRpdmUgPyBmYWxzZSA6IHByb3BzLmNvbGxhcHNhYmxlXG4gICAgICAgICAgfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG5cbiAgICBVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgICAgdGhpcy5fYXR0YWNoUHJvcHModGhpcy5wcm9wcyk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICBpZiAodGhpcy5faW52b2tlQW5pbWF0ZWRQcm9wc0NhbGxiYWNrT25Nb3VudCkge1xuICAgICAgICB0aGlzLl9pbnZva2VBbmltYXRlZFByb3BzQ2FsbGJhY2tPbk1vdW50ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2FuaW1hdGVkUHJvcHNDYWxsYmFjaygpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9wcm9wc0FuaW1hdGVkLnNldE5hdGl2ZVZpZXcodGhpcy5fY29tcG9uZW50KTtcbiAgICAgIHRoaXMuX2F0dGFjaE5hdGl2ZUV2ZW50cygpO1xuICAgIH1cblxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5ld1Byb3BzKSB7XG4gICAgICB0aGlzLl9hdHRhY2hQcm9wcyhuZXdQcm9wcyk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgICAgaWYgKHRoaXMuX2NvbXBvbmVudCAhPT0gdGhpcy5fcHJldkNvbXBvbmVudCkge1xuICAgICAgICB0aGlzLl9wcm9wc0FuaW1hdGVkLnNldE5hdGl2ZVZpZXcodGhpcy5fY29tcG9uZW50KTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLl9jb21wb25lbnQgIT09IHRoaXMuX3ByZXZDb21wb25lbnQgfHwgcHJldlByb3BzICE9PSB0aGlzLnByb3BzKSB7XG4gICAgICAgIHRoaXMuX2RldGFjaE5hdGl2ZUV2ZW50cygpO1xuICAgICAgICB0aGlzLl9hdHRhY2hOYXRpdmVFdmVudHMoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgIHRoaXMuX3Byb3BzQW5pbWF0ZWQgJiYgdGhpcy5fcHJvcHNBbmltYXRlZC5fX2RldGFjaCgpO1xuICAgICAgdGhpcy5fZGV0YWNoTmF0aXZlRXZlbnRzKCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIFJlYWN0LmZvcndhcmRSZWYoZnVuY3Rpb24gQW5pbWF0ZWRDb21wb25lbnRXcmFwcGVyKHByb3BzLCByZWYpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPEFuaW1hdGVkQ29tcG9uZW50XG4gICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgey4uLihyZWYgPT0gbnVsbCA/IG51bGwgOiB7Zm9yd2FyZGVkUmVmOiByZWZ9KX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlQW5pbWF0ZWRDb21wb25lbnQ7XG4iXX0=