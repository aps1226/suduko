25f18390d58c59a691b980a74aa7cb7d
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _NativeStatusBarManagerAndroid = _interopRequireDefault(require("./NativeStatusBarManagerAndroid"));

var _NativeStatusBarManagerIOS = _interopRequireDefault(require("./NativeStatusBarManagerIOS"));

var _NativeStatusBarManag;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var Platform = require("../../Utilities/Platform");

var React = require('react');

var invariant = require('invariant');

var processColor = require("../../StyleSheet/processColor");

function mergePropsStack(propsStack, defaultValues) {
  return propsStack.reduce(function (prev, cur) {
    for (var prop in cur) {
      if (cur[prop] != null) {
        prev[prop] = cur[prop];
      }
    }

    return prev;
  }, (0, _extends2.default)({}, defaultValues));
}

function createStackEntry(props) {
  return {
    backgroundColor: props.backgroundColor != null ? {
      value: props.backgroundColor,
      animated: props.animated
    } : null,
    barStyle: props.barStyle != null ? {
      value: props.barStyle,
      animated: props.animated
    } : null,
    translucent: props.translucent,
    hidden: props.hidden != null ? {
      value: props.hidden,
      animated: props.animated,
      transition: props.showHideTransition
    } : null,
    networkActivityIndicatorVisible: props.networkActivityIndicatorVisible
  };
}

var StatusBar = function (_React$Component) {
  (0, _inherits2.default)(StatusBar, _React$Component);

  var _super = _createSuper(StatusBar);

  function StatusBar() {
    var _this;

    (0, _classCallCheck2.default)(this, StatusBar);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    _this._stackEntry = null;
    return _this;
  }

  (0, _createClass2.default)(StatusBar, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._stackEntry = StatusBar.pushStackEntry(this.props);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      StatusBar.popStackEntry(this._stackEntry);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this._stackEntry = StatusBar.replaceStackEntry(this._stackEntry, this.props);
    }
  }, {
    key: "render",
    value: function render() {
      return null;
    }
  }], [{
    key: "setHidden",
    value: function setHidden(hidden, animation) {
      animation = animation || 'none';
      StatusBar._defaultProps.hidden.value = hidden;

      if (Platform.OS === 'ios') {
        _NativeStatusBarManagerIOS.default.setHidden(hidden, animation);
      } else if (Platform.OS === 'android') {
        _NativeStatusBarManagerAndroid.default.setHidden(hidden);
      }
    }
  }, {
    key: "setBarStyle",
    value: function setBarStyle(style, animated) {
      animated = animated || false;
      StatusBar._defaultProps.barStyle.value = style;

      if (Platform.OS === 'ios') {
        _NativeStatusBarManagerIOS.default.setStyle(style, animated);
      } else if (Platform.OS === 'android') {
        _NativeStatusBarManagerAndroid.default.setStyle(style);
      }
    }
  }, {
    key: "setNetworkActivityIndicatorVisible",
    value: function setNetworkActivityIndicatorVisible(visible) {
      if (Platform.OS !== 'ios') {
        console.warn('`setNetworkActivityIndicatorVisible` is only available on iOS');
        return;
      }

      StatusBar._defaultProps.networkActivityIndicatorVisible = visible;

      _NativeStatusBarManagerIOS.default.setNetworkActivityIndicatorVisible(visible);
    }
  }, {
    key: "setBackgroundColor",
    value: function setBackgroundColor(color, animated) {
      if (Platform.OS !== 'android') {
        console.warn('`setBackgroundColor` is only available on Android');
        return;
      }

      animated = animated || false;
      StatusBar._defaultProps.backgroundColor.value = color;
      var processedColor = processColor(color);

      if (processedColor == null) {
        console.warn("`StatusBar.setBackgroundColor`: Color " + color + " parsed to null or undefined");
        return;
      }

      invariant(typeof processedColor === 'number', 'Unexpected color given for StatusBar.setBackgroundColor');

      _NativeStatusBarManagerAndroid.default.setColor(processedColor, animated);
    }
  }, {
    key: "setTranslucent",
    value: function setTranslucent(translucent) {
      if (Platform.OS !== 'android') {
        console.warn('`setTranslucent` is only available on Android');
        return;
      }

      StatusBar._defaultProps.translucent = translucent;

      _NativeStatusBarManagerAndroid.default.setTranslucent(translucent);
    }
  }, {
    key: "pushStackEntry",
    value: function pushStackEntry(props) {
      var entry = createStackEntry(props);

      StatusBar._propsStack.push(entry);

      StatusBar._updatePropsStack();

      return entry;
    }
  }, {
    key: "popStackEntry",
    value: function popStackEntry(entry) {
      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack.splice(index, 1);
      }

      StatusBar._updatePropsStack();
    }
  }, {
    key: "replaceStackEntry",
    value: function replaceStackEntry(entry, props) {
      var newEntry = createStackEntry(props);

      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack[index] = newEntry;
      }

      StatusBar._updatePropsStack();

      return newEntry;
    }
  }]);
  return StatusBar;
}(React.Component);

StatusBar._propsStack = [];
StatusBar._defaultProps = createStackEntry({
  animated: false,
  showHideTransition: 'fade',
  backgroundColor: Platform.OS === 'android' ? (_NativeStatusBarManag = _NativeStatusBarManagerAndroid.default.getConstants().DEFAULT_BACKGROUND_COLOR) != null ? _NativeStatusBarManag : 'black' : 'black',
  barStyle: 'default',
  translucent: false,
  hidden: false,
  networkActivityIndicatorVisible: false
});
StatusBar._updateImmediate = null;
StatusBar._currentValues = null;
StatusBar.currentHeight = Platform.OS === 'android' ? _NativeStatusBarManagerAndroid.default.getConstants().HEIGHT : null;
StatusBar.defaultProps = {
  animated: false,
  showHideTransition: 'fade'
};

StatusBar._updatePropsStack = function () {
  clearImmediate(StatusBar._updateImmediate);
  StatusBar._updateImmediate = setImmediate(function () {
    var oldProps = StatusBar._currentValues;
    var mergedProps = mergePropsStack(StatusBar._propsStack, StatusBar._defaultProps);

    if (Platform.OS === 'ios') {
      if (!oldProps || oldProps.barStyle.value !== mergedProps.barStyle.value) {
        _NativeStatusBarManagerIOS.default.setStyle(mergedProps.barStyle.value, mergedProps.barStyle.animated || false);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        _NativeStatusBarManagerIOS.default.setHidden(mergedProps.hidden.value, mergedProps.hidden.animated ? mergedProps.hidden.transition : 'none');
      }

      if (!oldProps || oldProps.networkActivityIndicatorVisible !== mergedProps.networkActivityIndicatorVisible) {
        _NativeStatusBarManagerIOS.default.setNetworkActivityIndicatorVisible(mergedProps.networkActivityIndicatorVisible);
      }
    } else if (Platform.OS === 'android') {
      _NativeStatusBarManagerAndroid.default.setStyle(mergedProps.barStyle.value);

      var processedColor = processColor(mergedProps.backgroundColor.value);

      if (processedColor == null) {
        console.warn("`StatusBar._updatePropsStack`: Color " + mergedProps.backgroundColor.value + " parsed to null or undefined");
      } else {
        invariant(typeof processedColor === 'number', 'Unexpected color given in StatusBar._updatePropsStack');

        _NativeStatusBarManagerAndroid.default.setColor(processedColor, mergedProps.backgroundColor.animated);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        _NativeStatusBarManagerAndroid.default.setHidden(mergedProps.hidden.value);
      }

      if (!oldProps || oldProps.translucent !== mergedProps.translucent) {
        _NativeStatusBarManagerAndroid.default.setTranslucent(mergedProps.translucent);
      }
    }

    StatusBar._currentValues = mergedProps;
  });
};

module.exports = StatusBar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YXR1c0Jhci5qcyJdLCJuYW1lcyI6WyJQbGF0Zm9ybSIsInJlcXVpcmUiLCJSZWFjdCIsImludmFyaWFudCIsInByb2Nlc3NDb2xvciIsIm1lcmdlUHJvcHNTdGFjayIsInByb3BzU3RhY2siLCJkZWZhdWx0VmFsdWVzIiwicmVkdWNlIiwicHJldiIsImN1ciIsInByb3AiLCJjcmVhdGVTdGFja0VudHJ5IiwicHJvcHMiLCJiYWNrZ3JvdW5kQ29sb3IiLCJ2YWx1ZSIsImFuaW1hdGVkIiwiYmFyU3R5bGUiLCJ0cmFuc2x1Y2VudCIsImhpZGRlbiIsInRyYW5zaXRpb24iLCJzaG93SGlkZVRyYW5zaXRpb24iLCJuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlIiwiU3RhdHVzQmFyIiwiX3N0YWNrRW50cnkiLCJwdXNoU3RhY2tFbnRyeSIsInBvcFN0YWNrRW50cnkiLCJyZXBsYWNlU3RhY2tFbnRyeSIsImFuaW1hdGlvbiIsIl9kZWZhdWx0UHJvcHMiLCJPUyIsIk5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1MiLCJzZXRIaWRkZW4iLCJOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZCIsInN0eWxlIiwic2V0U3R5bGUiLCJ2aXNpYmxlIiwiY29uc29sZSIsIndhcm4iLCJzZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlIiwiY29sb3IiLCJwcm9jZXNzZWRDb2xvciIsInNldENvbG9yIiwic2V0VHJhbnNsdWNlbnQiLCJlbnRyeSIsIl9wcm9wc1N0YWNrIiwicHVzaCIsIl91cGRhdGVQcm9wc1N0YWNrIiwiaW5kZXgiLCJpbmRleE9mIiwic3BsaWNlIiwibmV3RW50cnkiLCJDb21wb25lbnQiLCJnZXRDb25zdGFudHMiLCJERUZBVUxUX0JBQ0tHUk9VTkRfQ09MT1IiLCJfdXBkYXRlSW1tZWRpYXRlIiwiX2N1cnJlbnRWYWx1ZXMiLCJjdXJyZW50SGVpZ2h0IiwiSEVJR0hUIiwiZGVmYXVsdFByb3BzIiwiY2xlYXJJbW1lZGlhdGUiLCJzZXRJbW1lZGlhdGUiLCJvbGRQcm9wcyIsIm1lcmdlZFByb3BzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFTQTs7QUFDQTs7Ozs7Ozs7QUFSQSxJQUFNQSxRQUFRLEdBQUdDLE9BQU8sNEJBQXhCOztBQUNBLElBQU1DLEtBQUssR0FBR0QsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBRUEsSUFBTUUsU0FBUyxHQUFHRixPQUFPLENBQUMsV0FBRCxDQUF6Qjs7QUFDQSxJQUFNRyxZQUFZLEdBQUdILE9BQU8saUNBQTVCOztBQWlHQSxTQUFTSSxlQUFULENBQ0VDLFVBREYsRUFFRUMsYUFGRixFQUdVO0FBQ1IsU0FBT0QsVUFBVSxDQUFDRSxNQUFYLENBQWtCLFVBQUNDLElBQUQsRUFBT0MsR0FBUCxFQUFlO0FBQ3RDLFNBQUssSUFBTUMsSUFBWCxJQUFtQkQsR0FBbkIsRUFBd0I7QUFDdEIsVUFBSUEsR0FBRyxDQUFDQyxJQUFELENBQUgsSUFBYSxJQUFqQixFQUF1QjtBQUNyQkYsUUFBQUEsSUFBSSxDQUFDRSxJQUFELENBQUosR0FBYUQsR0FBRyxDQUFDQyxJQUFELENBQWhCO0FBQ0Q7QUFDRjs7QUFDRCxXQUFPRixJQUFQO0FBQ0QsR0FQTSxFQU9KLHVCQUFjLEVBQWQsRUFBa0JGLGFBQWxCLENBUEksQ0FBUDtBQVFEOztBQU1ELFNBQVNLLGdCQUFULENBQTBCQyxLQUExQixFQUEyQztBQUN6QyxTQUFPO0FBQ0xDLElBQUFBLGVBQWUsRUFDYkQsS0FBSyxDQUFDQyxlQUFOLElBQXlCLElBQXpCLEdBQ0k7QUFDRUMsTUFBQUEsS0FBSyxFQUFFRixLQUFLLENBQUNDLGVBRGY7QUFFRUUsTUFBQUEsUUFBUSxFQUFFSCxLQUFLLENBQUNHO0FBRmxCLEtBREosR0FLSSxJQVBEO0FBUUxDLElBQUFBLFFBQVEsRUFDTkosS0FBSyxDQUFDSSxRQUFOLElBQWtCLElBQWxCLEdBQ0k7QUFDRUYsTUFBQUEsS0FBSyxFQUFFRixLQUFLLENBQUNJLFFBRGY7QUFFRUQsTUFBQUEsUUFBUSxFQUFFSCxLQUFLLENBQUNHO0FBRmxCLEtBREosR0FLSSxJQWREO0FBZUxFLElBQUFBLFdBQVcsRUFBRUwsS0FBSyxDQUFDSyxXQWZkO0FBZ0JMQyxJQUFBQSxNQUFNLEVBQ0pOLEtBQUssQ0FBQ00sTUFBTixJQUFnQixJQUFoQixHQUNJO0FBQ0VKLE1BQUFBLEtBQUssRUFBRUYsS0FBSyxDQUFDTSxNQURmO0FBRUVILE1BQUFBLFFBQVEsRUFBRUgsS0FBSyxDQUFDRyxRQUZsQjtBQUdFSSxNQUFBQSxVQUFVLEVBQUVQLEtBQUssQ0FBQ1E7QUFIcEIsS0FESixHQU1JLElBdkJEO0FBd0JMQyxJQUFBQSwrQkFBK0IsRUFBRVQsS0FBSyxDQUFDUztBQXhCbEMsR0FBUDtBQTBCRDs7SUFnRUtDLFM7Ozs7Ozs7Ozs7Ozs7OztVQStLSkMsVyxHQUFjLEk7Ozs7OztXQUVkLDZCQUFvQjtBQUtsQixXQUFLQSxXQUFMLEdBQW1CRCxTQUFTLENBQUNFLGNBQVYsQ0FBeUIsS0FBS1osS0FBOUIsQ0FBbkI7QUFDRDs7O1dBRUQsZ0NBQXVCO0FBR3JCVSxNQUFBQSxTQUFTLENBQUNHLGFBQVYsQ0FBd0IsS0FBS0YsV0FBN0I7QUFDRDs7O1dBRUQsOEJBQXFCO0FBQ25CLFdBQUtBLFdBQUwsR0FBbUJELFNBQVMsQ0FBQ0ksaUJBQVYsQ0FDakIsS0FBS0gsV0FEWSxFQUVqQixLQUFLWCxLQUZZLENBQW5CO0FBSUQ7OztXQTZFRCxrQkFBcUI7QUFDbkIsYUFBTyxJQUFQO0FBQ0Q7OztXQXZPRCxtQkFBaUJNLE1BQWpCLEVBQWtDUyxTQUFsQyxFQUFrRTtBQUNoRUEsTUFBQUEsU0FBUyxHQUFHQSxTQUFTLElBQUksTUFBekI7QUFDQUwsTUFBQUEsU0FBUyxDQUFDTSxhQUFWLENBQXdCVixNQUF4QixDQUErQkosS0FBL0IsR0FBdUNJLE1BQXZDOztBQUNBLFVBQUluQixRQUFRLENBQUM4QixFQUFULEtBQWdCLEtBQXBCLEVBQTJCO0FBQ3pCQywyQ0FBMEJDLFNBQTFCLENBQW9DYixNQUFwQyxFQUE0Q1MsU0FBNUM7QUFDRCxPQUZELE1BRU8sSUFBSTVCLFFBQVEsQ0FBQzhCLEVBQVQsS0FBZ0IsU0FBcEIsRUFBK0I7QUFDcENHLCtDQUE4QkQsU0FBOUIsQ0FBd0NiLE1BQXhDO0FBQ0Q7QUFDRjs7O1dBT0QscUJBQW1CZSxLQUFuQixFQUEwQ2xCLFFBQTFDLEVBQThEO0FBQzVEQSxNQUFBQSxRQUFRLEdBQUdBLFFBQVEsSUFBSSxLQUF2QjtBQUNBTyxNQUFBQSxTQUFTLENBQUNNLGFBQVYsQ0FBd0JaLFFBQXhCLENBQWlDRixLQUFqQyxHQUF5Q21CLEtBQXpDOztBQUNBLFVBQUlsQyxRQUFRLENBQUM4QixFQUFULEtBQWdCLEtBQXBCLEVBQTJCO0FBQ3pCQywyQ0FBMEJJLFFBQTFCLENBQW1DRCxLQUFuQyxFQUEwQ2xCLFFBQTFDO0FBQ0QsT0FGRCxNQUVPLElBQUloQixRQUFRLENBQUM4QixFQUFULEtBQWdCLFNBQXBCLEVBQStCO0FBQ3BDRywrQ0FBOEJFLFFBQTlCLENBQXVDRCxLQUF2QztBQUNEO0FBQ0Y7OztXQU1ELDRDQUEwQ0UsT0FBMUMsRUFBNEQ7QUFDMUQsVUFBSXBDLFFBQVEsQ0FBQzhCLEVBQVQsS0FBZ0IsS0FBcEIsRUFBMkI7QUFDekJPLFFBQUFBLE9BQU8sQ0FBQ0MsSUFBUixDQUNFLCtEQURGO0FBR0E7QUFDRDs7QUFDRGYsTUFBQUEsU0FBUyxDQUFDTSxhQUFWLENBQXdCUCwrQkFBeEIsR0FBMERjLE9BQTFEOztBQUNBTCx5Q0FBMEJRLGtDQUExQixDQUE2REgsT0FBN0Q7QUFDRDs7O1dBT0QsNEJBQTBCSSxLQUExQixFQUF5Q3hCLFFBQXpDLEVBQTZEO0FBQzNELFVBQUloQixRQUFRLENBQUM4QixFQUFULEtBQWdCLFNBQXBCLEVBQStCO0FBQzdCTyxRQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FBYSxtREFBYjtBQUNBO0FBQ0Q7O0FBQ0R0QixNQUFBQSxRQUFRLEdBQUdBLFFBQVEsSUFBSSxLQUF2QjtBQUNBTyxNQUFBQSxTQUFTLENBQUNNLGFBQVYsQ0FBd0JmLGVBQXhCLENBQXdDQyxLQUF4QyxHQUFnRHlCLEtBQWhEO0FBRUEsVUFBTUMsY0FBYyxHQUFHckMsWUFBWSxDQUFDb0MsS0FBRCxDQUFuQzs7QUFDQSxVQUFJQyxjQUFjLElBQUksSUFBdEIsRUFBNEI7QUFDMUJKLFFBQUFBLE9BQU8sQ0FBQ0MsSUFBUiw0Q0FDNkNFLEtBRDdDO0FBR0E7QUFDRDs7QUFDRHJDLE1BQUFBLFNBQVMsQ0FDUCxPQUFPc0MsY0FBUCxLQUEwQixRQURuQixFQUVQLHlEQUZPLENBQVQ7O0FBS0FSLDZDQUE4QlMsUUFBOUIsQ0FBdUNELGNBQXZDLEVBQXVEekIsUUFBdkQ7QUFDRDs7O1dBTUQsd0JBQXNCRSxXQUF0QixFQUE0QztBQUMxQyxVQUFJbEIsUUFBUSxDQUFDOEIsRUFBVCxLQUFnQixTQUFwQixFQUErQjtBQUM3Qk8sUUFBQUEsT0FBTyxDQUFDQyxJQUFSLENBQWEsK0NBQWI7QUFDQTtBQUNEOztBQUNEZixNQUFBQSxTQUFTLENBQUNNLGFBQVYsQ0FBd0JYLFdBQXhCLEdBQXNDQSxXQUF0Qzs7QUFDQWUsNkNBQThCVSxjQUE5QixDQUE2Q3pCLFdBQTdDO0FBQ0Q7OztXQVFELHdCQUFzQkwsS0FBdEIsRUFBdUM7QUFDckMsVUFBTStCLEtBQUssR0FBR2hDLGdCQUFnQixDQUFDQyxLQUFELENBQTlCOztBQUNBVSxNQUFBQSxTQUFTLENBQUNzQixXQUFWLENBQXNCQyxJQUF0QixDQUEyQkYsS0FBM0I7O0FBQ0FyQixNQUFBQSxTQUFTLENBQUN3QixpQkFBVjs7QUFDQSxhQUFPSCxLQUFQO0FBQ0Q7OztXQU9ELHVCQUFxQkEsS0FBckIsRUFBaUM7QUFDL0IsVUFBTUksS0FBSyxHQUFHekIsU0FBUyxDQUFDc0IsV0FBVixDQUFzQkksT0FBdEIsQ0FBOEJMLEtBQTlCLENBQWQ7O0FBQ0EsVUFBSUksS0FBSyxLQUFLLENBQUMsQ0FBZixFQUFrQjtBQUNoQnpCLFFBQUFBLFNBQVMsQ0FBQ3NCLFdBQVYsQ0FBc0JLLE1BQXRCLENBQTZCRixLQUE3QixFQUFvQyxDQUFwQztBQUNEOztBQUNEekIsTUFBQUEsU0FBUyxDQUFDd0IsaUJBQVY7QUFDRDs7O1dBUUQsMkJBQXlCSCxLQUF6QixFQUFxQy9CLEtBQXJDLEVBQXNEO0FBQ3BELFVBQU1zQyxRQUFRLEdBQUd2QyxnQkFBZ0IsQ0FBQ0MsS0FBRCxDQUFqQzs7QUFDQSxVQUFNbUMsS0FBSyxHQUFHekIsU0FBUyxDQUFDc0IsV0FBVixDQUFzQkksT0FBdEIsQ0FBOEJMLEtBQTlCLENBQWQ7O0FBQ0EsVUFBSUksS0FBSyxLQUFLLENBQUMsQ0FBZixFQUFrQjtBQUNoQnpCLFFBQUFBLFNBQVMsQ0FBQ3NCLFdBQVYsQ0FBc0JHLEtBQXRCLElBQStCRyxRQUEvQjtBQUNEOztBQUNENUIsTUFBQUEsU0FBUyxDQUFDd0IsaUJBQVY7O0FBQ0EsYUFBT0ksUUFBUDtBQUNEOzs7RUFyS3FCakQsS0FBSyxDQUFDa0QsUzs7QUFBeEI3QixTLENBQ0dzQixXLEdBQWMsRTtBQURqQnRCLFMsQ0FHR00sYSxHQUFnQmpCLGdCQUFnQixDQUFDO0FBQ3RDSSxFQUFBQSxRQUFRLEVBQUUsS0FENEI7QUFFdENLLEVBQUFBLGtCQUFrQixFQUFFLE1BRmtCO0FBR3RDUCxFQUFBQSxlQUFlLEVBQ2JkLFFBQVEsQ0FBQzhCLEVBQVQsS0FBZ0IsU0FBaEIsNEJBQ0lHLHVDQUE4Qm9CLFlBQTlCLEdBQ0dDLHdCQUZQLG9DQUVtQyxPQUZuQyxHQUdJLE9BUGdDO0FBUXRDckMsRUFBQUEsUUFBUSxFQUFFLFNBUjRCO0FBU3RDQyxFQUFBQSxXQUFXLEVBQUUsS0FUeUI7QUFVdENDLEVBQUFBLE1BQU0sRUFBRSxLQVY4QjtBQVd0Q0csRUFBQUEsK0JBQStCLEVBQUU7QUFYSyxDQUFELEM7QUFIbkNDLFMsQ0FrQkdnQyxnQixHQUFtQixJO0FBbEJ0QmhDLFMsQ0FxQkdpQyxjLEdBQWlCLEk7QUFyQnBCakMsUyxDQThCR2tDLGEsR0FDTHpELFFBQVEsQ0FBQzhCLEVBQVQsS0FBZ0IsU0FBaEIsR0FDSUcsdUNBQThCb0IsWUFBOUIsR0FBNkNLLE1BRGpELEdBRUksSTtBQWpDRm5DLFMsQ0F1S0dvQyxZLEdBR0Y7QUFDSDNDLEVBQUFBLFFBQVEsRUFBRSxLQURQO0FBRUhLLEVBQUFBLGtCQUFrQixFQUFFO0FBRmpCLEM7O0FBMUtERSxTLENBeU1Hd0IsaUIsR0FBb0IsWUFBTTtBQUUvQmEsRUFBQUEsY0FBYyxDQUFDckMsU0FBUyxDQUFDZ0MsZ0JBQVgsQ0FBZDtBQUNBaEMsRUFBQUEsU0FBUyxDQUFDZ0MsZ0JBQVYsR0FBNkJNLFlBQVksQ0FBQyxZQUFNO0FBQzlDLFFBQU1DLFFBQVEsR0FBR3ZDLFNBQVMsQ0FBQ2lDLGNBQTNCO0FBQ0EsUUFBTU8sV0FBVyxHQUFHMUQsZUFBZSxDQUNqQ2tCLFNBQVMsQ0FBQ3NCLFdBRHVCLEVBRWpDdEIsU0FBUyxDQUFDTSxhQUZ1QixDQUFuQzs7QUFNQSxRQUFJN0IsUUFBUSxDQUFDOEIsRUFBVCxLQUFnQixLQUFwQixFQUEyQjtBQUN6QixVQUNFLENBQUNnQyxRQUFELElBQ0FBLFFBQVEsQ0FBQzdDLFFBQVQsQ0FBa0JGLEtBQWxCLEtBQTRCZ0QsV0FBVyxDQUFDOUMsUUFBWixDQUFxQkYsS0FGbkQsRUFHRTtBQUNBZ0IsMkNBQTBCSSxRQUExQixDQUNFNEIsV0FBVyxDQUFDOUMsUUFBWixDQUFxQkYsS0FEdkIsRUFFRWdELFdBQVcsQ0FBQzlDLFFBQVosQ0FBcUJELFFBQXJCLElBQWlDLEtBRm5DO0FBSUQ7O0FBQ0QsVUFBSSxDQUFDOEMsUUFBRCxJQUFhQSxRQUFRLENBQUMzQyxNQUFULENBQWdCSixLQUFoQixLQUEwQmdELFdBQVcsQ0FBQzVDLE1BQVosQ0FBbUJKLEtBQTlELEVBQXFFO0FBQ25FZ0IsMkNBQTBCQyxTQUExQixDQUNFK0IsV0FBVyxDQUFDNUMsTUFBWixDQUFtQkosS0FEckIsRUFFRWdELFdBQVcsQ0FBQzVDLE1BQVosQ0FBbUJILFFBQW5CLEdBQ0krQyxXQUFXLENBQUM1QyxNQUFaLENBQW1CQyxVQUR2QixHQUVJLE1BSk47QUFNRDs7QUFFRCxVQUNFLENBQUMwQyxRQUFELElBQ0FBLFFBQVEsQ0FBQ3hDLCtCQUFULEtBQ0V5QyxXQUFXLENBQUN6QywrQkFIaEIsRUFJRTtBQUNBUywyQ0FBMEJRLGtDQUExQixDQUNFd0IsV0FBVyxDQUFDekMsK0JBRGQ7QUFHRDtBQUNGLEtBNUJELE1BNEJPLElBQUl0QixRQUFRLENBQUM4QixFQUFULEtBQWdCLFNBQXBCLEVBQStCO0FBR3BDRyw2Q0FBOEJFLFFBQTlCLENBQXVDNEIsV0FBVyxDQUFDOUMsUUFBWixDQUFxQkYsS0FBNUQ7O0FBQ0EsVUFBTTBCLGNBQWMsR0FBR3JDLFlBQVksQ0FBQzJELFdBQVcsQ0FBQ2pELGVBQVosQ0FBNEJDLEtBQTdCLENBQW5DOztBQUNBLFVBQUkwQixjQUFjLElBQUksSUFBdEIsRUFBNEI7QUFDMUJKLFFBQUFBLE9BQU8sQ0FBQ0MsSUFBUiwyQ0FFSXlCLFdBQVcsQ0FBQ2pELGVBQVosQ0FBNEJDLEtBRmhDO0FBS0QsT0FORCxNQU1PO0FBQ0xaLFFBQUFBLFNBQVMsQ0FDUCxPQUFPc0MsY0FBUCxLQUEwQixRQURuQixFQUVQLHVEQUZPLENBQVQ7O0FBSUFSLCtDQUE4QlMsUUFBOUIsQ0FDRUQsY0FERixFQUVFc0IsV0FBVyxDQUFDakQsZUFBWixDQUE0QkUsUUFGOUI7QUFJRDs7QUFDRCxVQUFJLENBQUM4QyxRQUFELElBQWFBLFFBQVEsQ0FBQzNDLE1BQVQsQ0FBZ0JKLEtBQWhCLEtBQTBCZ0QsV0FBVyxDQUFDNUMsTUFBWixDQUFtQkosS0FBOUQsRUFBcUU7QUFDbkVrQiwrQ0FBOEJELFNBQTlCLENBQXdDK0IsV0FBVyxDQUFDNUMsTUFBWixDQUFtQkosS0FBM0Q7QUFDRDs7QUFDRCxVQUFJLENBQUMrQyxRQUFELElBQWFBLFFBQVEsQ0FBQzVDLFdBQVQsS0FBeUI2QyxXQUFXLENBQUM3QyxXQUF0RCxFQUFtRTtBQUNqRWUsK0NBQThCVSxjQUE5QixDQUE2Q29CLFdBQVcsQ0FBQzdDLFdBQXpEO0FBQ0Q7QUFDRjs7QUFFREssSUFBQUEsU0FBUyxDQUFDaUMsY0FBVixHQUEyQk8sV0FBM0I7QUFDRCxHQWxFd0MsQ0FBekM7QUFtRUQsQzs7QUFPSEMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCMUMsU0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmb3JtYXRcbiAqIEBmbG93XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoJy4uLy4uL1V0aWxpdGllcy9QbGF0Zm9ybScpO1xuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcbmNvbnN0IHByb2Nlc3NDb2xvciA9IHJlcXVpcmUoJy4uLy4uL1N0eWxlU2hlZXQvcHJvY2Vzc0NvbG9yJyk7XG5pbXBvcnQgdHlwZSB7Q29sb3JWYWx1ZX0gZnJvbSAnLi4vLi4vU3R5bGVTaGVldC9TdHlsZVNoZWV0VHlwZXMnO1xuXG5pbXBvcnQgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQgZnJvbSAnLi9OYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZCc7XG5pbXBvcnQgTmF0aXZlU3RhdHVzQmFyTWFuYWdlcklPUyBmcm9tICcuL05hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1MnO1xuXG4vKipcbiAqIFN0YXR1cyBiYXIgc3R5bGVcbiAqL1xuZXhwb3J0IHR5cGUgU3RhdHVzQmFyU3R5bGUgPSAkS2V5czx7XG4gIC8qKlxuICAgKiBEZWZhdWx0IHN0YXR1cyBiYXIgc3R5bGUgKGRhcmsgZm9yIGlPUywgbGlnaHQgZm9yIEFuZHJvaWQpXG4gICAqL1xuICBkZWZhdWx0OiBzdHJpbmcsXG4gIC8qKlxuICAgKiBEYXJrIGJhY2tncm91bmQsIHdoaXRlIHRleHRzIGFuZCBpY29uc1xuICAgKi9cbiAgJ2xpZ2h0LWNvbnRlbnQnOiBzdHJpbmcsXG4gIC8qKlxuICAgKiBMaWdodCBiYWNrZ3JvdW5kLCBkYXJrIHRleHRzIGFuZCBpY29uc1xuICAgKi9cbiAgJ2RhcmstY29udGVudCc6IHN0cmluZyxcbiAgLi4uXG59PjtcblxuLyoqXG4gKiBTdGF0dXMgYmFyIGFuaW1hdGlvblxuICovXG5leHBvcnQgdHlwZSBTdGF0dXNCYXJBbmltYXRpb24gPSAkS2V5czx7XG4gIC8qKlxuICAgKiBObyBhbmltYXRpb25cbiAgICovXG4gIG5vbmU6IHN0cmluZyxcbiAgLyoqXG4gICAqIEZhZGUgYW5pbWF0aW9uXG4gICAqL1xuICBmYWRlOiBzdHJpbmcsXG4gIC8qKlxuICAgKiBTbGlkZSBhbmltYXRpb25cbiAgICovXG4gIHNsaWRlOiBzdHJpbmcsXG4gIC4uLlxufT47XG5cbnR5cGUgQW5kcm9pZFByb3BzID0gJFJlYWRPbmx5PHt8XG4gIC8qKlxuICAgKiBUaGUgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgc3RhdHVzIGJhci5cbiAgICogQHBsYXRmb3JtIGFuZHJvaWRcbiAgICovXG4gIGJhY2tncm91bmRDb2xvcj86ID9Db2xvclZhbHVlLFxuICAvKipcbiAgICogSWYgdGhlIHN0YXR1cyBiYXIgaXMgdHJhbnNsdWNlbnQuXG4gICAqIFdoZW4gdHJhbnNsdWNlbnQgaXMgc2V0IHRvIHRydWUsIHRoZSBhcHAgd2lsbCBkcmF3IHVuZGVyIHRoZSBzdGF0dXMgYmFyLlxuICAgKiBUaGlzIGlzIHVzZWZ1bCB3aGVuIHVzaW5nIGEgc2VtaSB0cmFuc3BhcmVudCBzdGF0dXMgYmFyIGNvbG9yLlxuICAgKlxuICAgKiBAcGxhdGZvcm0gYW5kcm9pZFxuICAgKi9cbiAgdHJhbnNsdWNlbnQ/OiA/Ym9vbGVhbixcbnx9PjtcblxudHlwZSBJT1NQcm9wcyA9ICRSZWFkT25seTx7fFxuICAvKipcbiAgICogSWYgdGhlIG5ldHdvcmsgYWN0aXZpdHkgaW5kaWNhdG9yIHNob3VsZCBiZSB2aXNpYmxlLlxuICAgKlxuICAgKiBAcGxhdGZvcm0gaW9zXG4gICAqL1xuICBuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlPzogP2Jvb2xlYW4sXG4gIC8qKlxuICAgKiBUaGUgdHJhbnNpdGlvbiBlZmZlY3Qgd2hlbiBzaG93aW5nIGFuZCBoaWRpbmcgdGhlIHN0YXR1cyBiYXIgdXNpbmcgdGhlIGBoaWRkZW5gXG4gICAqIHByb3AuIERlZmF1bHRzIHRvICdmYWRlJy5cbiAgICpcbiAgICogQHBsYXRmb3JtIGlvc1xuICAgKi9cbiAgc2hvd0hpZGVUcmFuc2l0aW9uPzogPygnZmFkZScgfCAnc2xpZGUnKSxcbnx9PjtcblxudHlwZSBQcm9wcyA9ICRSZWFkT25seTx7fFxuICAuLi5BbmRyb2lkUHJvcHMsXG4gIC4uLklPU1Byb3BzLFxuICAvKipcbiAgICogSWYgdGhlIHN0YXR1cyBiYXIgaXMgaGlkZGVuLlxuICAgKi9cbiAgaGlkZGVuPzogP2Jvb2xlYW4sXG4gIC8qKlxuICAgKiBJZiB0aGUgdHJhbnNpdGlvbiBiZXR3ZWVuIHN0YXR1cyBiYXIgcHJvcGVydHkgY2hhbmdlcyBzaG91bGQgYmUgYW5pbWF0ZWQuXG4gICAqIFN1cHBvcnRlZCBmb3IgYmFja2dyb3VuZENvbG9yLCBiYXJTdHlsZSBhbmQgaGlkZGVuLlxuICAgKi9cbiAgYW5pbWF0ZWQ/OiA/Ym9vbGVhbixcbiAgLyoqXG4gICAqIFNldHMgdGhlIGNvbG9yIG9mIHRoZSBzdGF0dXMgYmFyIHRleHQuXG4gICAqL1xuICBiYXJTdHlsZT86ID8oJ2RlZmF1bHQnIHwgJ2xpZ2h0LWNvbnRlbnQnIHwgJ2RhcmstY29udGVudCcpLFxufH0+O1xuXG4vKipcbiAqIE1lcmdlcyB0aGUgcHJvcCBzdGFjayB3aXRoIHRoZSBkZWZhdWx0IHZhbHVlcy5cbiAqL1xuZnVuY3Rpb24gbWVyZ2VQcm9wc1N0YWNrKFxuICBwcm9wc1N0YWNrOiBBcnJheTxPYmplY3Q+LFxuICBkZWZhdWx0VmFsdWVzOiBPYmplY3QsXG4pOiBPYmplY3Qge1xuICByZXR1cm4gcHJvcHNTdGFjay5yZWR1Y2UoKHByZXYsIGN1cikgPT4ge1xuICAgIGZvciAoY29uc3QgcHJvcCBpbiBjdXIpIHtcbiAgICAgIGlmIChjdXJbcHJvcF0gIT0gbnVsbCkge1xuICAgICAgICBwcmV2W3Byb3BdID0gY3VyW3Byb3BdO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcHJldjtcbiAgfSwgT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdFZhbHVlcykpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYW4gb2JqZWN0IHRvIGluc2VydCBpbiB0aGUgcHJvcHMgc3RhY2sgZnJvbSB0aGUgcHJvcHNcbiAqIGFuZCB0aGUgdHJhbnNpdGlvbi9hbmltYXRpb24gaW5mby5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlU3RhY2tFbnRyeShwcm9wczogYW55KTogYW55IHtcbiAgcmV0dXJuIHtcbiAgICBiYWNrZ3JvdW5kQ29sb3I6XG4gICAgICBwcm9wcy5iYWNrZ3JvdW5kQ29sb3IgIT0gbnVsbFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy5iYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICBhbmltYXRlZDogcHJvcHMuYW5pbWF0ZWQsXG4gICAgICAgICAgfVxuICAgICAgICA6IG51bGwsXG4gICAgYmFyU3R5bGU6XG4gICAgICBwcm9wcy5iYXJTdHlsZSAhPSBudWxsXG4gICAgICAgID8ge1xuICAgICAgICAgICAgdmFsdWU6IHByb3BzLmJhclN0eWxlLFxuICAgICAgICAgICAgYW5pbWF0ZWQ6IHByb3BzLmFuaW1hdGVkLFxuICAgICAgICAgIH1cbiAgICAgICAgOiBudWxsLFxuICAgIHRyYW5zbHVjZW50OiBwcm9wcy50cmFuc2x1Y2VudCxcbiAgICBoaWRkZW46XG4gICAgICBwcm9wcy5oaWRkZW4gIT0gbnVsbFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy5oaWRkZW4sXG4gICAgICAgICAgICBhbmltYXRlZDogcHJvcHMuYW5pbWF0ZWQsXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiBwcm9wcy5zaG93SGlkZVRyYW5zaXRpb24sXG4gICAgICAgICAgfVxuICAgICAgICA6IG51bGwsXG4gICAgbmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZTogcHJvcHMubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSxcbiAgfTtcbn1cblxuLyoqXG4gKiBDb21wb25lbnQgdG8gY29udHJvbCB0aGUgYXBwIHN0YXR1cyBiYXIuXG4gKlxuICogIyMjIFVzYWdlIHdpdGggTmF2aWdhdG9yXG4gKlxuICogSXQgaXMgcG9zc2libGUgdG8gaGF2ZSBtdWx0aXBsZSBgU3RhdHVzQmFyYCBjb21wb25lbnRzIG1vdW50ZWQgYXQgdGhlIHNhbWVcbiAqIHRpbWUuIFRoZSBwcm9wcyB3aWxsIGJlIG1lcmdlZCBpbiB0aGUgb3JkZXIgdGhlIGBTdGF0dXNCYXJgIGNvbXBvbmVudHMgd2VyZVxuICogbW91bnRlZC4gT25lIHVzZSBjYXNlIGlzIHRvIHNwZWNpZnkgc3RhdHVzIGJhciBzdHlsZXMgcGVyIHJvdXRlIHVzaW5nIGBOYXZpZ2F0b3JgLlxuICpcbiAqIGBgYFxuICogIDxWaWV3PlxuICogICAgPFN0YXR1c0JhclxuICogICAgICBiYWNrZ3JvdW5kQ29sb3I9XCJibHVlXCJcbiAqICAgICAgYmFyU3R5bGU9XCJsaWdodC1jb250ZW50XCJcbiAqICAgIC8+XG4gKiAgICA8TmF2aWdhdG9yXG4gKiAgICAgIGluaXRpYWxSb3V0ZT17e3N0YXR1c0JhckhpZGRlbjogdHJ1ZX19XG4gKiAgICAgIHJlbmRlclNjZW5lPXsocm91dGUsIG5hdmlnYXRvcikgPT5cbiAqICAgICAgICA8Vmlldz5cbiAqICAgICAgICAgIDxTdGF0dXNCYXIgaGlkZGVuPXtyb3V0ZS5zdGF0dXNCYXJIaWRkZW59IC8+XG4gKiAgICAgICAgICAuLi5cbiAqICAgICAgICA8L1ZpZXc+XG4gKiAgICAgIH1cbiAqICAgIC8+XG4gKiAgPC9WaWV3PlxuICogYGBgXG4gKlxuICogIyMjIEltcGVyYXRpdmUgQVBJXG4gKlxuICogRm9yIGNhc2VzIHdoZXJlIHVzaW5nIGEgY29tcG9uZW50IGlzIG5vdCBpZGVhbCwgdGhlcmUgYXJlIHN0YXRpYyBtZXRob2RzXG4gKiB0byBtYW5pcHVsYXRlIHRoZSBgU3RhdHVzQmFyYCBkaXNwbGF5IHN0YWNrLiBUaGVzZSBtZXRob2RzIGhhdmUgdGhlIHNhbWVcbiAqIGJlaGF2aW9yIGFzIG1vdW50aW5nIGFuZCB1bm1vdW50aW5nIGEgYFN0YXR1c0JhcmAgY29tcG9uZW50LlxuICpcbiAqIEZvciBleGFtcGxlLCB5b3UgY2FuIGNhbGwgYFN0YXR1c0Jhci5wdXNoU3RhY2tFbnRyeWAgdG8gdXBkYXRlIHRoZSBzdGF0dXMgYmFyXG4gKiBiZWZvcmUgbGF1bmNoaW5nIGEgdGhpcmQtcGFydHkgbmF0aXZlIFVJIGNvbXBvbmVudCwgYW5kIHRoZW4gY2FsbFxuICogYFN0YXR1c0Jhci5wb3BTdGFja0VudHJ5YCB3aGVuIGNvbXBsZXRlZC5cbiAqXG4gKiBgYGBcbiAqIGNvbnN0IG9wZW5UaGlyZFBhcnR5QnVnUmVwb3J0ZXIgPSBhc3luYyAoKSA9PiB7XG4gKiAgIC8vIFRoZSBidWcgcmVwb3J0ZXIgaGFzIGEgZGFyayBiYWNrZ3JvdW5kLCBzbyB3ZSBwdXNoIGEgbmV3IHN0YXR1cyBiYXIgc3R5bGUuXG4gKiAgIGNvbnN0IHN0YWNrRW50cnkgPSBTdGF0dXNCYXIucHVzaFN0YWNrRW50cnkoe2JhclN0eWxlOiAnbGlnaHQtY29udGVudCd9KTtcbiAqXG4gKiAgIC8vIGBvcGVuYCByZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIFVJIGlzIGRpc21pc3NlZC5cbiAqICAgYXdhaXQgQnVnUmVwb3J0ZXIub3BlbigpO1xuICpcbiAqICAgLy8gRG9uJ3QgZm9yZ2V0IHRvIGNhbGwgYHBvcFN0YWNrRW50cnlgIHdoZW4geW91J3JlIGRvbmUuXG4gKiAgIFN0YXR1c0Jhci5wb3BTdGFja0VudHJ5KHN0YWNrRW50cnkpO1xuICogfTtcbiAqIGBgYFxuICpcbiAqIFRoZXJlIGlzIGEgbGVnYWN5IGltcGVyYXRpdmUgQVBJIHRoYXQgZW5hYmxlcyB5b3UgdG8gbWFudWFsbHkgdXBkYXRlIHRoZVxuICogc3RhdHVzIGJhciBzdHlsZXMuIEhvd2V2ZXIsIHRoZSBsZWdhY3kgQVBJIGRvZXMgbm90IHVwZGF0ZSB0aGUgaW50ZXJuYWxcbiAqIGBTdGF0dXNCYXJgIGRpc3BsYXkgc3RhY2ssIHdoaWNoIG1lYW5zIHRoYXQgYW55IGNoYW5nZXMgd2lsbCBiZSBvdmVycmlkZGVuXG4gKiB3aGVuZXZlciBhIGBTdGF0dXNCYXJgIGNvbXBvbmVudCBpcyBtb3VudGVkIG9yIHVubW91bnRlZC5cbiAqXG4gKiBJdCBpcyBzdHJvbmdseSBhZHZpc2VkIHRoYXQgeW91IHVzZSBgcHVzaFN0YWNrRW50cnlgLCBgcG9wU3RhY2tFbnRyeWAsIG9yXG4gKiBgcmVwbGFjZVN0YWNrRW50cnlgIGluc3RlYWQgb2YgdGhlIHN0YXRpYyBtZXRob2RzIGJlZ2lubmluZyB3aXRoIGBzZXRgLlxuICpcbiAqICMjIyBDb25zdGFudHNcbiAqXG4gKiBgY3VycmVudEhlaWdodGAgKEFuZHJvaWQgb25seSkgVGhlIGhlaWdodCBvZiB0aGUgc3RhdHVzIGJhci5cbiAqL1xuY2xhc3MgU3RhdHVzQmFyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzPiB7XG4gIHN0YXRpYyBfcHJvcHNTdGFjayA9IFtdO1xuXG4gIHN0YXRpYyBfZGVmYXVsdFByb3BzID0gY3JlYXRlU3RhY2tFbnRyeSh7XG4gICAgYW5pbWF0ZWQ6IGZhbHNlLFxuICAgIHNob3dIaWRlVHJhbnNpdGlvbjogJ2ZhZGUnLFxuICAgIGJhY2tncm91bmRDb2xvcjpcbiAgICAgIFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCdcbiAgICAgICAgPyBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5nZXRDb25zdGFudHMoKVxuICAgICAgICAgICAgLkRFRkFVTFRfQkFDS0dST1VORF9DT0xPUiA/PyAnYmxhY2snXG4gICAgICAgIDogJ2JsYWNrJyxcbiAgICBiYXJTdHlsZTogJ2RlZmF1bHQnLFxuICAgIHRyYW5zbHVjZW50OiBmYWxzZSxcbiAgICBoaWRkZW46IGZhbHNlLFxuICAgIG5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGU6IGZhbHNlLFxuICB9KTtcblxuICAvLyBUaW1lciBmb3IgdXBkYXRpbmcgdGhlIG5hdGl2ZSBtb2R1bGUgdmFsdWVzIGF0IHRoZSBlbmQgb2YgdGhlIGZyYW1lLlxuICBzdGF0aWMgX3VwZGF0ZUltbWVkaWF0ZSA9IG51bGw7XG5cbiAgLy8gVGhlIGN1cnJlbnQgbWVyZ2VkIHZhbHVlcyBmcm9tIHRoZSBwcm9wcyBzdGFjay5cbiAgc3RhdGljIF9jdXJyZW50VmFsdWVzID0gbnVsbDtcblxuICAvLyBUT0RPKGphbmljKTogUHJvdmlkZSBhIHJlYWwgQVBJIHRvIGRlYWwgd2l0aCBzdGF0dXMgYmFyIGhlaWdodC4gU2VlIHRoZVxuICAvLyBkaXNjdXNzaW9uIGluICM2MTk1LlxuICAvKipcbiAgICogVGhlIGN1cnJlbnQgaGVpZ2h0IG9mIHRoZSBzdGF0dXMgYmFyIG9uIHRoZSBkZXZpY2UuXG4gICAqXG4gICAqIEBwbGF0Zm9ybSBhbmRyb2lkXG4gICAqL1xuICBzdGF0aWMgY3VycmVudEhlaWdodDogP251bWJlciA9XG4gICAgUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJ1xuICAgICAgPyBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5nZXRDb25zdGFudHMoKS5IRUlHSFRcbiAgICAgIDogbnVsbDtcblxuICAvLyBQcm92aWRlIGFuIGltcGVyYXRpdmUgQVBJIGFzIHN0YXRpYyBmdW5jdGlvbnMgb2YgdGhlIGNvbXBvbmVudC5cbiAgLy8gU2VlIHRoZSBjb3JyZXNwb25kaW5nIHByb3AgZm9yIG1vcmUgZGV0YWlsLlxuXG4gIC8qKlxuICAgKiBTaG93IG9yIGhpZGUgdGhlIHN0YXR1cyBiYXJcbiAgICogQHBhcmFtIGhpZGRlbiBIaWRlIHRoZSBzdGF0dXMgYmFyLlxuICAgKiBAcGFyYW0gYW5pbWF0aW9uIE9wdGlvbmFsIGFuaW1hdGlvbiB3aGVuXG4gICAqICAgIGNoYW5naW5nIHRoZSBzdGF0dXMgYmFyIGhpZGRlbiBwcm9wZXJ0eS5cbiAgICovXG4gIHN0YXRpYyBzZXRIaWRkZW4oaGlkZGVuOiBib29sZWFuLCBhbmltYXRpb24/OiBTdGF0dXNCYXJBbmltYXRpb24pIHtcbiAgICBhbmltYXRpb24gPSBhbmltYXRpb24gfHwgJ25vbmUnO1xuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLmhpZGRlbi52YWx1ZSA9IGhpZGRlbjtcbiAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VySU9TLnNldEhpZGRlbihoaWRkZW4sIGFuaW1hdGlvbik7XG4gICAgfSBlbHNlIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5zZXRIaWRkZW4oaGlkZGVuKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBzdGF0dXMgYmFyIHN0eWxlXG4gICAqIEBwYXJhbSBzdHlsZSBTdGF0dXMgYmFyIHN0eWxlIHRvIHNldFxuICAgKiBAcGFyYW0gYW5pbWF0ZWQgQW5pbWF0ZSB0aGUgc3R5bGUgY2hhbmdlLlxuICAgKi9cbiAgc3RhdGljIHNldEJhclN0eWxlKHN0eWxlOiBTdGF0dXNCYXJTdHlsZSwgYW5pbWF0ZWQ/OiBib29sZWFuKSB7XG4gICAgYW5pbWF0ZWQgPSBhbmltYXRlZCB8fCBmYWxzZTtcbiAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcy5iYXJTdHlsZS52YWx1ZSA9IHN0eWxlO1xuICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2lvcycpIHtcbiAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJJT1Muc2V0U3R5bGUoc3R5bGUsIGFuaW1hdGVkKTtcbiAgICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLnNldFN0eWxlKHN0eWxlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29udHJvbCB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgbmV0d29yayBhY3Rpdml0eSBpbmRpY2F0b3JcbiAgICogQHBhcmFtIHZpc2libGUgU2hvdyB0aGUgaW5kaWNhdG9yLlxuICAgKi9cbiAgc3RhdGljIHNldE5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUodmlzaWJsZTogYm9vbGVhbikge1xuICAgIGlmIChQbGF0Zm9ybS5PUyAhPT0gJ2lvcycpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ2BzZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlYCBpcyBvbmx5IGF2YWlsYWJsZSBvbiBpT1MnLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSA9IHZpc2libGU7XG4gICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlcklPUy5zZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlKHZpc2libGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgYmFja2dyb3VuZCBjb2xvciBmb3IgdGhlIHN0YXR1cyBiYXJcbiAgICogQHBhcmFtIGNvbG9yIEJhY2tncm91bmQgY29sb3IuXG4gICAqIEBwYXJhbSBhbmltYXRlZCBBbmltYXRlIHRoZSBzdHlsZSBjaGFuZ2UuXG4gICAqL1xuICBzdGF0aWMgc2V0QmFja2dyb3VuZENvbG9yKGNvbG9yOiBzdHJpbmcsIGFuaW1hdGVkPzogYm9vbGVhbikge1xuICAgIGlmIChQbGF0Zm9ybS5PUyAhPT0gJ2FuZHJvaWQnKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ2BzZXRCYWNrZ3JvdW5kQ29sb3JgIGlzIG9ubHkgYXZhaWxhYmxlIG9uIEFuZHJvaWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYW5pbWF0ZWQgPSBhbmltYXRlZCB8fCBmYWxzZTtcbiAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcy5iYWNrZ3JvdW5kQ29sb3IudmFsdWUgPSBjb2xvcjtcblxuICAgIGNvbnN0IHByb2Nlc3NlZENvbG9yID0gcHJvY2Vzc0NvbG9yKGNvbG9yKTtcbiAgICBpZiAocHJvY2Vzc2VkQ29sb3IgPT0gbnVsbCkge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgXFxgU3RhdHVzQmFyLnNldEJhY2tncm91bmRDb2xvclxcYDogQ29sb3IgJHtjb2xvcn0gcGFyc2VkIHRvIG51bGwgb3IgdW5kZWZpbmVkYCxcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGludmFyaWFudChcbiAgICAgIHR5cGVvZiBwcm9jZXNzZWRDb2xvciA9PT0gJ251bWJlcicsXG4gICAgICAnVW5leHBlY3RlZCBjb2xvciBnaXZlbiBmb3IgU3RhdHVzQmFyLnNldEJhY2tncm91bmRDb2xvcicsXG4gICAgKTtcblxuICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLnNldENvbG9yKHByb2Nlc3NlZENvbG9yLCBhbmltYXRlZCk7XG4gIH1cblxuICAvKipcbiAgICogQ29udHJvbCB0aGUgdHJhbnNsdWNlbmN5IG9mIHRoZSBzdGF0dXMgYmFyXG4gICAqIEBwYXJhbSB0cmFuc2x1Y2VudCBTZXQgYXMgdHJhbnNsdWNlbnQuXG4gICAqL1xuICBzdGF0aWMgc2V0VHJhbnNsdWNlbnQodHJhbnNsdWNlbnQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdhbmRyb2lkJykge1xuICAgICAgY29uc29sZS53YXJuKCdgc2V0VHJhbnNsdWNlbnRgIGlzIG9ubHkgYXZhaWxhYmxlIG9uIEFuZHJvaWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMudHJhbnNsdWNlbnQgPSB0cmFuc2x1Y2VudDtcbiAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5zZXRUcmFuc2x1Y2VudCh0cmFuc2x1Y2VudCk7XG4gIH1cblxuICAvKipcbiAgICogUHVzaCBhIFN0YXR1c0JhciBlbnRyeSBvbnRvIHRoZSBzdGFjay5cbiAgICogVGhlIHJldHVybiB2YWx1ZSBzaG91bGQgYmUgcGFzc2VkIHRvIGBwb3BTdGFja0VudHJ5YCB3aGVuIGNvbXBsZXRlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgT2JqZWN0IGNvbnRhaW5pbmcgdGhlIFN0YXR1c0JhciBwcm9wcyB0byB1c2UgaW4gdGhlIHN0YWNrIGVudHJ5LlxuICAgKi9cbiAgc3RhdGljIHB1c2hTdGFja0VudHJ5KHByb3BzOiBhbnkpOiBhbnkge1xuICAgIGNvbnN0IGVudHJ5ID0gY3JlYXRlU3RhY2tFbnRyeShwcm9wcyk7XG4gICAgU3RhdHVzQmFyLl9wcm9wc1N0YWNrLnB1c2goZW50cnkpO1xuICAgIFN0YXR1c0Jhci5fdXBkYXRlUHJvcHNTdGFjaygpO1xuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3AgYSBTdGF0dXNCYXIgZW50cnkgZnJvbSB0aGUgc3RhY2suXG4gICAqXG4gICAqIEBwYXJhbSBlbnRyeSBFbnRyeSByZXR1cm5lZCBmcm9tIGBwdXNoU3RhY2tFbnRyeWAuXG4gICAqL1xuICBzdGF0aWMgcG9wU3RhY2tFbnRyeShlbnRyeTogYW55KSB7XG4gICAgY29uc3QgaW5kZXggPSBTdGF0dXNCYXIuX3Byb3BzU3RhY2suaW5kZXhPZihlbnRyeSk7XG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgU3RhdHVzQmFyLl9wcm9wc1N0YWNrLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICAgIFN0YXR1c0Jhci5fdXBkYXRlUHJvcHNTdGFjaygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlcGxhY2UgYW4gZXhpc3RpbmcgU3RhdHVzQmFyIHN0YWNrIGVudHJ5IHdpdGggbmV3IHByb3BzLlxuICAgKlxuICAgKiBAcGFyYW0gZW50cnkgRW50cnkgcmV0dXJuZWQgZnJvbSBgcHVzaFN0YWNrRW50cnlgIHRvIHJlcGxhY2UuXG4gICAqIEBwYXJhbSBwcm9wcyBPYmplY3QgY29udGFpbmluZyB0aGUgU3RhdHVzQmFyIHByb3BzIHRvIHVzZSBpbiB0aGUgcmVwbGFjZW1lbnQgc3RhY2sgZW50cnkuXG4gICAqL1xuICBzdGF0aWMgcmVwbGFjZVN0YWNrRW50cnkoZW50cnk6IGFueSwgcHJvcHM6IGFueSk6IGFueSB7XG4gICAgY29uc3QgbmV3RW50cnkgPSBjcmVhdGVTdGFja0VudHJ5KHByb3BzKTtcbiAgICBjb25zdCBpbmRleCA9IFN0YXR1c0Jhci5fcHJvcHNTdGFjay5pbmRleE9mKGVudHJ5KTtcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICBTdGF0dXNCYXIuX3Byb3BzU3RhY2tbaW5kZXhdID0gbmV3RW50cnk7XG4gICAgfVxuICAgIFN0YXR1c0Jhci5fdXBkYXRlUHJvcHNTdGFjaygpO1xuICAgIHJldHVybiBuZXdFbnRyeTtcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHM6IHt8XG4gICAgYW5pbWF0ZWQ6IGJvb2xlYW4sXG4gICAgc2hvd0hpZGVUcmFuc2l0aW9uOiAkVEVNUE9SQVJZJHN0cmluZzwnZmFkZSc+LFxuICB8fSA9IHtcbiAgICBhbmltYXRlZDogZmFsc2UsXG4gICAgc2hvd0hpZGVUcmFuc2l0aW9uOiAnZmFkZScsXG4gIH07XG5cbiAgX3N0YWNrRW50cnkgPSBudWxsO1xuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIC8vIEV2ZXJ5IHRpbWUgYSBTdGF0dXNCYXIgY29tcG9uZW50IGlzIG1vdW50ZWQsIHdlIHB1c2ggaXQncyBwcm9wIHRvIGEgc3RhY2tcbiAgICAvLyBhbmQgYWx3YXlzIHVwZGF0ZSB0aGUgbmF0aXZlIHN0YXR1cyBiYXIgd2l0aCB0aGUgcHJvcHMgZnJvbSB0aGUgdG9wIG9mIHRoZW5cbiAgICAvLyBzdGFjay4gVGhpcyBhbGxvd3MgaGF2aW5nIG11bHRpcGxlIFN0YXR1c0JhciBjb21wb25lbnRzIGFuZCB0aGUgb25lIHRoYXQgaXNcbiAgICAvLyBhZGRlZCBsYXN0IG9yIGlzIGRlZXBlciBpbiB0aGUgdmlldyBoaWVyYXJjaHkgd2lsbCBoYXZlIHByaW9yaXR5LlxuICAgIHRoaXMuX3N0YWNrRW50cnkgPSBTdGF0dXNCYXIucHVzaFN0YWNrRW50cnkodGhpcy5wcm9wcyk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAvLyBXaGVuIGEgU3RhdHVzQmFyIGlzIHVubW91bnRlZCwgcmVtb3ZlIGl0c2VsZiBmcm9tIHRoZSBzdGFjayBhbmQgdXBkYXRlXG4gICAgLy8gdGhlIG5hdGl2ZSBiYXIgd2l0aCB0aGUgbmV4dCBwcm9wcy5cbiAgICBTdGF0dXNCYXIucG9wU3RhY2tFbnRyeSh0aGlzLl9zdGFja0VudHJ5KTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLl9zdGFja0VudHJ5ID0gU3RhdHVzQmFyLnJlcGxhY2VTdGFja0VudHJ5KFxuICAgICAgdGhpcy5fc3RhY2tFbnRyeSxcbiAgICAgIHRoaXMucHJvcHMsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBuYXRpdmUgc3RhdHVzIGJhciB3aXRoIHRoZSBwcm9wcyBmcm9tIHRoZSBzdGFjay5cbiAgICovXG4gIHN0YXRpYyBfdXBkYXRlUHJvcHNTdGFjayA9ICgpID0+IHtcbiAgICAvLyBTZW5kIHRoZSB1cGRhdGUgdG8gdGhlIG5hdGl2ZSBtb2R1bGUgb25seSBvbmNlIGF0IHRoZSBlbmQgb2YgdGhlIGZyYW1lLlxuICAgIGNsZWFySW1tZWRpYXRlKFN0YXR1c0Jhci5fdXBkYXRlSW1tZWRpYXRlKTtcbiAgICBTdGF0dXNCYXIuX3VwZGF0ZUltbWVkaWF0ZSA9IHNldEltbWVkaWF0ZSgoKSA9PiB7XG4gICAgICBjb25zdCBvbGRQcm9wcyA9IFN0YXR1c0Jhci5fY3VycmVudFZhbHVlcztcbiAgICAgIGNvbnN0IG1lcmdlZFByb3BzID0gbWVyZ2VQcm9wc1N0YWNrKFxuICAgICAgICBTdGF0dXNCYXIuX3Byb3BzU3RhY2ssXG4gICAgICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLFxuICAgICAgKTtcblxuICAgICAgLy8gVXBkYXRlIHRoZSBwcm9wcyB0aGF0IGhhdmUgY2hhbmdlZCB1c2luZyB0aGUgbWVyZ2VkIHZhbHVlcyBmcm9tIHRoZSBwcm9wcyBzdGFjay5cbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2lvcycpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICFvbGRQcm9wcyB8fFxuICAgICAgICAgIG9sZFByb3BzLmJhclN0eWxlLnZhbHVlICE9PSBtZXJnZWRQcm9wcy5iYXJTdHlsZS52YWx1ZVxuICAgICAgICApIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VySU9TLnNldFN0eWxlKFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMuYmFyU3R5bGUudmFsdWUsXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5iYXJTdHlsZS5hbmltYXRlZCB8fCBmYWxzZSxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb2xkUHJvcHMgfHwgb2xkUHJvcHMuaGlkZGVuLnZhbHVlICE9PSBtZXJnZWRQcm9wcy5oaWRkZW4udmFsdWUpIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VySU9TLnNldEhpZGRlbihcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmhpZGRlbi52YWx1ZSxcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmhpZGRlbi5hbmltYXRlZFxuICAgICAgICAgICAgICA/IG1lcmdlZFByb3BzLmhpZGRlbi50cmFuc2l0aW9uXG4gICAgICAgICAgICAgIDogJ25vbmUnLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXG4gICAgICAgICAgIW9sZFByb3BzIHx8XG4gICAgICAgICAgb2xkUHJvcHMubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSAhPT1cbiAgICAgICAgICAgIG1lcmdlZFByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGVcbiAgICAgICAgKSB7XG4gICAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlcklPUy5zZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlKFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgICAgLy90b2RvKFQ2MDY4NDc4Nyk6IEFkZCBiYWNrIG9wdGltaXphdGlvbiB0byBvbmx5IHVwZGF0ZSBiYXIgc3R5bGUgYW5kXG4gICAgICAgIC8vYmFja2dyb3VuZCBjb2xvciBpZiB0aGUgbmV3IHZhbHVlIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBvbGQgdmFsdWUuXG4gICAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLnNldFN0eWxlKG1lcmdlZFByb3BzLmJhclN0eWxlLnZhbHVlKTtcbiAgICAgICAgY29uc3QgcHJvY2Vzc2VkQ29sb3IgPSBwcm9jZXNzQ29sb3IobWVyZ2VkUHJvcHMuYmFja2dyb3VuZENvbG9yLnZhbHVlKTtcbiAgICAgICAgaWYgKHByb2Nlc3NlZENvbG9yID09IG51bGwpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBgXFxgU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrXFxgOiBDb2xvciAke1xuICAgICAgICAgICAgICBtZXJnZWRQcm9wcy5iYWNrZ3JvdW5kQ29sb3IudmFsdWVcbiAgICAgICAgICAgIH0gcGFyc2VkIHRvIG51bGwgb3IgdW5kZWZpbmVkYCxcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGludmFyaWFudChcbiAgICAgICAgICAgIHR5cGVvZiBwcm9jZXNzZWRDb2xvciA9PT0gJ251bWJlcicsXG4gICAgICAgICAgICAnVW5leHBlY3RlZCBjb2xvciBnaXZlbiBpbiBTdGF0dXNCYXIuX3VwZGF0ZVByb3BzU3RhY2snLFxuICAgICAgICAgICk7XG4gICAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlckFuZHJvaWQuc2V0Q29sb3IoXG4gICAgICAgICAgICBwcm9jZXNzZWRDb2xvcixcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmJhY2tncm91bmRDb2xvci5hbmltYXRlZCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb2xkUHJvcHMgfHwgb2xkUHJvcHMuaGlkZGVuLnZhbHVlICE9PSBtZXJnZWRQcm9wcy5oaWRkZW4udmFsdWUpIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyQW5kcm9pZC5zZXRIaWRkZW4obWVyZ2VkUHJvcHMuaGlkZGVuLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9sZFByb3BzIHx8IG9sZFByb3BzLnRyYW5zbHVjZW50ICE9PSBtZXJnZWRQcm9wcy50cmFuc2x1Y2VudCkge1xuICAgICAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXJBbmRyb2lkLnNldFRyYW5zbHVjZW50KG1lcmdlZFByb3BzLnRyYW5zbHVjZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gVXBkYXRlIHRoZSBjdXJyZW50IHByb3AgdmFsdWVzLlxuICAgICAgU3RhdHVzQmFyLl9jdXJyZW50VmFsdWVzID0gbWVyZ2VkUHJvcHM7XG4gICAgfSk7XG4gIH07XG5cbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gU3RhdHVzQmFyO1xuIl19