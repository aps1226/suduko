5a14f39b71ee66d4474cd991309c33c4
"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.getLocalAssets = getLocalAssets;exports.getManifest = getManifest;exports.downloadAsync = downloadAsync;exports.manifestBaseUrl = exports.IS_BARE_ENV_WITHOUT_UPDATES = exports.IS_ENV_WITH_UPDATES_ENABLED = exports.IS_BARE_ENV_WITH_UPDATES = exports.IS_MANAGED_ENV = void 0;var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));var _core = require("@unimodules/core");
var _blueimpMd = _interopRequireDefault(require("blueimp-md5"));
var _expoConstants = _interopRequireDefault(require("expo-constants"));
var FileSystem = _interopRequireWildcard(require("expo-file-system"));
var _AssetUris = require("./AssetUris");var _NativeModulesProxy$E, _NativeModulesProxy$E2;function _getRequireWildcardCache(nodeInterop) {if (typeof WeakMap !== "function") return null;var cacheBabelInterop = new WeakMap();var cacheNodeInterop = new WeakMap();return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {return nodeInterop ? cacheNodeInterop : cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj, nodeInterop) {if (!nodeInterop && obj && obj.__esModule) {return obj;}if (obj === null || typeof obj !== "object" && typeof obj !== "function") {return { default: obj };}var cache = _getRequireWildcardCache(nodeInterop);if (cache && cache.has(obj)) {return cache.get(obj);}var newObj = {};var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;for (var key in obj) {if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;if (desc && (desc.get || desc.set)) {Object.defineProperty(newObj, key, desc);} else {newObj[key] = obj[key];}}}newObj.default = obj;if (cache) {cache.set(obj, newObj);}return newObj;}

var IS_MANAGED_ENV = !!_expoConstants.default.appOwnership;exports.IS_MANAGED_ENV = IS_MANAGED_ENV;



var IS_BARE_ENV_WITH_UPDATES = !IS_MANAGED_ENV &&
!!((_NativeModulesProxy$E = _core.NativeModulesProxy.ExpoUpdates) != null && _NativeModulesProxy$E.isEnabled) &&


!((_NativeModulesProxy$E2 = _core.NativeModulesProxy.ExpoUpdates) != null && _NativeModulesProxy$E2.isUsingEmbeddedAssets);exports.IS_BARE_ENV_WITH_UPDATES = IS_BARE_ENV_WITH_UPDATES;
var IS_ENV_WITH_UPDATES_ENABLED = IS_MANAGED_ENV || IS_BARE_ENV_WITH_UPDATES;exports.IS_ENV_WITH_UPDATES_ENABLED = IS_ENV_WITH_UPDATES_ENABLED;

var IS_BARE_ENV_WITHOUT_UPDATES = !IS_MANAGED_ENV && !IS_BARE_ENV_WITH_UPDATES;exports.IS_BARE_ENV_WITHOUT_UPDATES = IS_BARE_ENV_WITHOUT_UPDATES;


function getLocalAssets() {var _NativeModulesProxy$E3, _NativeModulesProxy$E4;
  return (_NativeModulesProxy$E3 = (_NativeModulesProxy$E4 = _core.NativeModulesProxy.ExpoUpdates) == null ? void 0 : _NativeModulesProxy$E4.localAssets) != null ? _NativeModulesProxy$E3 : {};
}
function getManifest() {var _Constants$__unsafeNo;
  return (_Constants$__unsafeNo = _expoConstants.default.__unsafeNoWarnManifest) != null ? _Constants$__unsafeNo : {};
}

var manifestBaseUrl = _expoConstants.default.experienceUrl ?
(0, _AssetUris.getManifestBaseUrl)(_expoConstants.default.experienceUrl) :
null;exports.manifestBaseUrl = manifestBaseUrl;

function downloadAsync(uri, hash, type, name) {return _regenerator.default.async(function downloadAsync$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:if (!
          IS_MANAGED_ENV) {_context.next = 2;break;}return _context.abrupt("return",
          _downloadAsyncManagedEnv(uri, hash, type, name));case 2:return _context.abrupt("return",

          _downloadAsyncUnmanagedEnv(uri, hash, type));case 3:case "end":return _context.stop();}}}, null, null, null, Promise);}





function _downloadAsyncManagedEnv(uri, hash, type, name) {var cacheFileId, localUri, _await$FileSystem$get, exists, md5, _await$FileSystem$dow;return _regenerator.default.async(function _downloadAsyncManagedEnv$(_context2) {while (1) {switch (_context2.prev = _context2.next) {case 0:
          cacheFileId = hash || (0, _blueimpMd.default)(uri);
          localUri = FileSystem.cacheDirectory + "ExponentAsset-" + cacheFileId + "." + type;_context2.next = 4;return _regenerator.default.awrap(
          FileSystem.getInfoAsync(localUri, {
            md5: true }));case 4:_await$FileSystem$get = _context2.sent;exists = _await$FileSystem$get.exists;md5 = _await$FileSystem$get.md5;if (!(

          !exists || hash !== null && md5 !== hash)) {_context2.next = 14;break;}_context2.next = 10;return _regenerator.default.awrap(
          FileSystem.downloadAsync(uri, localUri, {
            md5: true }));case 10:_await$FileSystem$dow = _context2.sent;md5 = _await$FileSystem$dow.md5;if (!(

          hash !== null && md5 !== hash)) {_context2.next = 14;break;}throw (
            new Error("Downloaded file for asset '" + name + "." + type + "' " + ("Located at " +
            uri + " ") + "failed MD5 integrity check"));case 14:return _context2.abrupt("return",



          localUri);case 15:case "end":return _context2.stop();}}}, null, null, null, Promise);}






function _downloadAsyncUnmanagedEnv(uri, hash, type) {var cacheFileId, localUri;return _regenerator.default.async(function _downloadAsyncUnmanagedEnv$(_context3) {while (1) {switch (_context3.prev = _context3.next) {case 0:if (!


          uri.startsWith('file://')) {_context3.next = 2;break;}return _context3.abrupt("return",
          uri);case 2:

          cacheFileId = hash || (0, _blueimpMd.default)(uri);
          localUri = FileSystem.cacheDirectory + "ExponentAsset-" + cacheFileId + "." + type;_context3.next = 6;return _regenerator.default.awrap(


          FileSystem.downloadAsync(uri, localUri));case 6:return _context3.abrupt("return",
          localUri);case 7:case "end":return _context3.stop();}}}, null, null, null, Promise);}