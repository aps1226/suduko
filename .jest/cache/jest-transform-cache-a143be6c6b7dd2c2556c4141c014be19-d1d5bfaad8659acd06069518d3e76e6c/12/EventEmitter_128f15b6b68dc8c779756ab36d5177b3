ce148699c358f7100e7e2fe14956d249
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var EmitterSubscription = require("./EmitterSubscription");

var EventSubscriptionVendor = require("./EventSubscriptionVendor");

var invariant = require('invariant');

var sparseFilterPredicate = function sparseFilterPredicate() {
  return true;
};

var EventEmitter = function () {
  function EventEmitter(subscriber) {
    (0, _classCallCheck2.default)(this, EventEmitter);
    this._subscriber = subscriber || new EventSubscriptionVendor();
  }

  (0, _createClass2.default)(EventEmitter, [{
    key: "addListener",
    value: function addListener(eventType, listener, context) {
      return this._subscriber.addSubscription(eventType, new EmitterSubscription(this, this._subscriber, listener, context));
    }
  }, {
    key: "once",
    value: function once(eventType, listener, context) {
      var _this = this;

      return this.addListener(eventType, function () {
        _this.removeCurrentListener();

        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        listener.apply(context, args);
      });
    }
  }, {
    key: "removeAllListeners",
    value: function removeAllListeners(eventType) {
      this._subscriber.removeAllSubscriptions(eventType);
    }
  }, {
    key: "removeCurrentListener",
    value: function removeCurrentListener() {
      invariant(!!this._currentSubscription, 'Not in an emitting cycle; there is no current subscription');
      this.removeSubscription(this._currentSubscription);
    }
  }, {
    key: "removeSubscription",
    value: function removeSubscription(subscription) {
      invariant(subscription.emitter === this, 'Subscription does not belong to this emitter.');

      this._subscriber.removeSubscription(subscription);
    }
  }, {
    key: "listeners",
    value: function listeners(eventType) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      return subscriptions ? subscriptions.filter(sparseFilterPredicate).map(function (subscription) {
        return subscription.listener;
      }) : [];
    }
  }, {
    key: "emit",
    value: function emit(eventType) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      if (subscriptions) {
        for (var i = 0, l = subscriptions.length; i < l; i++) {
          var subscription = subscriptions[i];

          if (subscription && subscription.listener) {
            this._currentSubscription = subscription;
            subscription.listener.apply(subscription.context, Array.prototype.slice.call(arguments, 1));
          }
        }

        this._currentSubscription = null;
      }
    }
  }, {
    key: "removeListener",
    value: function removeListener(eventType, listener) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      if (subscriptions) {
        for (var i = 0, l = subscriptions.length; i < l; i++) {
          var subscription = subscriptions[i];

          if (subscription && subscription.listener === listener) {
            subscription.remove();
          }
        }
      }
    }
  }]);
  return EventEmitter;
}();

module.exports = EventEmitter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV2ZW50RW1pdHRlci5qcyJdLCJuYW1lcyI6WyJFbWl0dGVyU3Vic2NyaXB0aW9uIiwicmVxdWlyZSIsIkV2ZW50U3Vic2NyaXB0aW9uVmVuZG9yIiwiaW52YXJpYW50Iiwic3BhcnNlRmlsdGVyUHJlZGljYXRlIiwiRXZlbnRFbWl0dGVyIiwic3Vic2NyaWJlciIsIl9zdWJzY3JpYmVyIiwiZXZlbnRUeXBlIiwibGlzdGVuZXIiLCJjb250ZXh0IiwiYWRkU3Vic2NyaXB0aW9uIiwiYWRkTGlzdGVuZXIiLCJyZW1vdmVDdXJyZW50TGlzdGVuZXIiLCJhcmdzIiwiYXBwbHkiLCJyZW1vdmVBbGxTdWJzY3JpcHRpb25zIiwiX2N1cnJlbnRTdWJzY3JpcHRpb24iLCJyZW1vdmVTdWJzY3JpcHRpb24iLCJzdWJzY3JpcHRpb24iLCJlbWl0dGVyIiwic3Vic2NyaXB0aW9ucyIsImdldFN1YnNjcmlwdGlvbnNGb3JUeXBlIiwiZmlsdGVyIiwibWFwIiwiaSIsImwiLCJsZW5ndGgiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsInJlbW92ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVdBOzs7Ozs7OztBQUVBLElBQU1BLG1CQUFtQixHQUFHQyxPQUFPLHlCQUFuQzs7QUFDQSxJQUFNQyx1QkFBdUIsR0FBR0QsT0FBTyw2QkFBdkM7O0FBRUEsSUFBTUUsU0FBUyxHQUFHRixPQUFPLENBQUMsV0FBRCxDQUF6Qjs7QUFFQSxJQUFNRyxxQkFBcUIsR0FBRyxTQUF4QkEscUJBQXdCO0FBQUEsU0FBTSxJQUFOO0FBQUEsQ0FBOUI7O0lBZU1DLFk7QUFVSix3QkFBWUMsVUFBWixFQUFrRDtBQUFBO0FBQ2hELFNBQUtDLFdBQUwsR0FBbUJELFVBQVUsSUFBSSxJQUFJSix1QkFBSixFQUFqQztBQUNEOzs7O1dBZ0JELHFCQUNFTSxTQURGLEVBRUVDLFFBRkYsRUFHRUMsT0FIRixFQUl1QjtBQUNyQixhQUFRLEtBQUtI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QUEwQkEsUUFBOUMsRUFBd0Q7QUFDdERVLFlBQUFBLFlBQVksQ0FBQ2MsTUFBYjtBQUNEO0FBQ0Y7QUFDRjtBQUNGOzs7OztBQUdIQyxNQUFNLENBQUNDLE9BQVAsR0FBaUI5QixZQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQG5vZmxvd1xuICogQHR5cGVjaGVja1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgRW1pdHRlclN1YnNjcmlwdGlvbiA9IHJlcXVpcmUoJy4vRW1pdHRlclN1YnNjcmlwdGlvbicpO1xuY29uc3QgRXZlbnRTdWJzY3JpcHRpb25WZW5kb3IgPSByZXF1aXJlKCcuL0V2ZW50U3Vic2NyaXB0aW9uVmVuZG9yJyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG5jb25zdCBzcGFyc2VGaWx0ZXJQcmVkaWNhdGUgPSAoKSA9PiB0cnVlO1xuXG4vKipcbiAqIEBjbGFzcyBFdmVudEVtaXR0ZXJcbiAqIEBkZXNjcmlwdGlvblxuICogQW4gRXZlbnRFbWl0dGVyIGlzIHJlc3BvbnNpYmxlIGZvciBtYW5hZ2luZyBhIHNldCBvZiBsaXN0ZW5lcnMgYW5kIHB1Ymxpc2hpbmdcbiAqIGV2ZW50cyB0byB0aGVtIHdoZW4gaXQgaXMgdG9sZCB0aGF0IHN1Y2ggZXZlbnRzIGhhcHBlbmVkLiBJbiBhZGRpdGlvbiB0byB0aGVcbiAqIGRhdGEgZm9yIHRoZSBnaXZlbiBldmVudCBpdCBhbHNvIHNlbmRzIGEgZXZlbnQgY29udHJvbCBvYmplY3Qgd2hpY2ggYWxsb3dzXG4gKiB0aGUgbGlzdGVuZXJzL2hhbmRsZXJzIHRvIHByZXZlbnQgdGhlIGRlZmF1bHQgYmVoYXZpb3Igb2YgdGhlIGdpdmVuIGV2ZW50LlxuICpcbiAqIFRoZSBlbWl0dGVyIGlzIGRlc2lnbmVkIHRvIGJlIGdlbmVyaWMgZW5vdWdoIHRvIHN1cHBvcnQgYWxsIHRoZSBkaWZmZXJlbnRcbiAqIGNvbnRleHRzIGluIHdoaWNoIG9uZSBtaWdodCB3YW50IHRvIGVtaXQgZXZlbnRzLiBJdCBpcyBhIHNpbXBsZSBtdWx0aWNhc3RcbiAqIG1lY2hhbmlzbSBvbiB0b3Agb2Ygd2hpY2ggZXh0cmEgZnVuY3Rpb25hbGl0eSBjYW4gYmUgY29tcG9zZWQuIEZvciBleGFtcGxlLCBhXG4gKiBtb3JlIGFkdmFuY2VkIGVtaXR0ZXIgbWF5IHVzZSBhbiBFdmVudEhvbGRlciBhbmQgRXZlbnRGYWN0b3J5LlxuICovXG5jbGFzcyBFdmVudEVtaXR0ZXIge1xuICBfc3Vic2NyaWJlcjogRXZlbnRTdWJzY3JpcHRpb25WZW5kb3I7XG4gIF9jdXJyZW50U3Vic2NyaXB0aW9uOiA/RW1pdHRlclN1YnNjcmlwdGlvbjtcblxuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBwYXJhbSB7RXZlbnRTdWJzY3JpcHRpb25WZW5kb3J9IHN1YnNjcmliZXIgLSBPcHRpb25hbCBzdWJzY3JpYmVyIGluc3RhbmNlXG4gICAqICAgdG8gdXNlLiBJZiBvbWl0dGVkLCBhIG5ldyBzdWJzY3JpYmVyIHdpbGwgYmUgY3JlYXRlZCBmb3IgdGhlIGVtaXR0ZXIuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihzdWJzY3JpYmVyOiA/RXZlbnRTdWJzY3JpcHRpb25WZW5kb3IpIHtcbiAgICB0aGlzLl9zdWJzY3JpYmVyID0gc3Vic2NyaWJlciB8fCBuZXcgRXZlbnRTdWJzY3JpcHRpb25WZW5kb3IoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgbGlzdGVuZXIgdG8gYmUgaW52b2tlZCB3aGVuIGV2ZW50cyBvZiB0aGUgc3BlY2lmaWVkIHR5cGUgYXJlXG4gICAqIGVtaXR0ZWQuIEFuIG9wdGlvbmFsIGNhbGxpbmcgY29udGV4dCBtYXkgYmUgcHJvdmlkZWQuIFRoZSBkYXRhIGFyZ3VtZW50c1xuICAgKiBlbWl0dGVkIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBsaXN0ZW5lciBmdW5jdGlvbi5cbiAgICpcbiAgICogVE9ETzogQW5ub3RhdGUgdGhlIGxpc3RlbmVyIGFyZydzIHR5cGUuIFRoaXMgaXMgdHJpY2t5IGJlY2F1c2UgbGlzdGVuZXJzXG4gICAqICAgICAgIGNhbiBiZSBpbnZva2VkIHdpdGggdmFyYXJncy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGxpc3RlbiB0b1xuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBsaXN0ZW5lciAtIEZ1bmN0aW9uIHRvIGludm9rZSB3aGVuIHRoZSBzcGVjaWZpZWQgZXZlbnQgaXNcbiAgICogICBlbWl0dGVkXG4gICAqIEBwYXJhbSB7Kn0gY29udGV4dCAtIE9wdGlvbmFsIGNvbnRleHQgb2JqZWN0IHRvIHVzZSB3aGVuIGludm9raW5nIHRoZVxuICAgKiAgIGxpc3RlbmVyXG4gICAqL1xuICBhZGRMaXN0ZW5lcihcbiAgICBldmVudFR5cGU6IHN0cmluZyxcbiAgICBsaXN0ZW5lcjogRnVuY3Rpb24sXG4gICAgY29udGV4dDogP09iamVjdCxcbiAgKTogRW1pdHRlclN1YnNjcmlwdGlvbiB7XG4gICAgcmV0dXJuICh0aGlzLl9zdWJzY3JpYmVyLmFkZFN1YnNjcmlwdGlvbihcbiAgICAgIGV2ZW50VHlwZSxcbiAgICAgIG5ldyBFbWl0dGVyU3Vic2NyaXB0aW9uKHRoaXMsIHRoaXMuX3N1YnNjcmliZXIsIGxpc3RlbmVyLCBjb250ZXh0KSxcbiAgICApOiBhbnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNpbWlsYXIgdG8gYWRkTGlzdGVuZXIsIGV4Y2VwdCB0aGF0IHRoZSBsaXN0ZW5lciBpcyByZW1vdmVkIGFmdGVyIGl0IGlzXG4gICAqIGludm9rZWQgb25jZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGxpc3RlbiB0b1xuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBsaXN0ZW5lciAtIEZ1bmN0aW9uIHRvIGludm9rZSBvbmx5IG9uY2Ugd2hlbiB0aGVcbiAgICogICBzcGVjaWZpZWQgZXZlbnQgaXMgZW1pdHRlZFxuICAgKiBAcGFyYW0geyp9IGNvbnRleHQgLSBPcHRpb25hbCBjb250ZXh0IG9iamVjdCB0byB1c2Ugd2hlbiBpbnZva2luZyB0aGVcbiAgICogICBsaXN0ZW5lclxuICAgKi9cbiAgb25jZShcbiAgICBldmVudFR5cGU6IHN0cmluZyxcbiAgICBsaXN0ZW5lcjogRnVuY3Rpb24sXG4gICAgY29udGV4dDogP09iamVjdCxcbiAgKTogRW1pdHRlclN1YnNjcmlwdGlvbiB7XG4gICAgcmV0dXJuIHRoaXMuYWRkTGlzdGVuZXIoZXZlbnRUeXBlLCAoLi4uYXJncykgPT4ge1xuICAgICAgdGhpcy5yZW1vdmVDdXJyZW50TGlzdGVuZXIoKTtcbiAgICAgIGxpc3RlbmVyLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYWxsIG9mIHRoZSByZWdpc3RlcmVkIGxpc3RlbmVycywgaW5jbHVkaW5nIHRob3NlIHJlZ2lzdGVyZWQgYXNcbiAgICogbGlzdGVuZXIgbWFwcy5cbiAgICpcbiAgICogQHBhcmFtIHs/c3RyaW5nfSBldmVudFR5cGUgLSBPcHRpb25hbCBuYW1lIG9mIHRoZSBldmVudCB3aG9zZSByZWdpc3RlcmVkXG4gICAqICAgbGlzdGVuZXJzIHRvIHJlbW92ZVxuICAgKi9cbiAgcmVtb3ZlQWxsTGlzdGVuZXJzKGV2ZW50VHlwZTogP3N0cmluZykge1xuICAgIHRoaXMuX3N1YnNjcmliZXIucmVtb3ZlQWxsU3Vic2NyaXB0aW9ucyhldmVudFR5cGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb3ZpZGVzIGFuIEFQSSB0aGF0IGNhbiBiZSBjYWxsZWQgZHVyaW5nIGFuIGV2ZW50aW5nIGN5Y2xlIHRvIHJlbW92ZSB0aGVcbiAgICogbGFzdCBsaXN0ZW5lciB0aGF0IHdhcyBpbnZva2VkLiBUaGlzIGFsbG93cyBhIGRldmVsb3BlciB0byBwcm92aWRlIGFuIGV2ZW50XG4gICAqIG9iamVjdCB0aGF0IGNhbiByZW1vdmUgdGhlIGxpc3RlbmVyIChvciBsaXN0ZW5lciBtYXApIGR1cmluZyB0aGVcbiAgICogaW52b2NhdGlvbi5cbiAgICpcbiAgICogSWYgaXQgaXMgY2FsbGVkIHdoZW4gbm90IGluc2lkZSBvZiBhbiBlbWl0dGluZyBjeWNsZSBpdCB3aWxsIHRocm93LlxuICAgKlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gV2hlbiBjYWxsZWQgbm90IGR1cmluZyBhbiBldmVudGluZyBjeWNsZVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgIHZhciBzdWJzY3JpcHRpb24gPSBlbWl0dGVyLmFkZExpc3RlbmVyTWFwKHtcbiAgICogICAgIHNvbWVFdmVudDogZnVuY3Rpb24oZGF0YSwgZXZlbnQpIHtcbiAgICogICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAqICAgICAgIGVtaXR0ZXIucmVtb3ZlQ3VycmVudExpc3RlbmVyKCk7XG4gICAqICAgICB9XG4gICAqICAgfSk7XG4gICAqXG4gICAqICAgZW1pdHRlci5lbWl0KCdzb21lRXZlbnQnLCAnYWJjJyk7IC8vIGxvZ3MgJ2FiYydcbiAgICogICBlbWl0dGVyLmVtaXQoJ3NvbWVFdmVudCcsICdkZWYnKTsgLy8gZG9lcyBub3QgbG9nIGFueXRoaW5nXG4gICAqL1xuICByZW1vdmVDdXJyZW50TGlzdGVuZXIoKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgISF0aGlzLl9jdXJyZW50U3Vic2NyaXB0aW9uLFxuICAgICAgJ05vdCBpbiBhbiBlbWl0dGluZyBjeWNsZTsgdGhlcmUgaXMgbm8gY3VycmVudCBzdWJzY3JpcHRpb24nLFxuICAgICk7XG4gICAgdGhpcy5yZW1vdmVTdWJzY3JpcHRpb24odGhpcy5fY3VycmVudFN1YnNjcmlwdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhIHNwZWNpZmljIHN1YnNjcmlwdGlvbi4gQ2FsbGVkIGJ5IHRoZSBgcmVtb3ZlKClgIG1ldGhvZCBvZiB0aGVcbiAgICogc3Vic2NyaXB0aW9uIGl0c2VsZiB0byBlbnN1cmUgYW55IG5lY2Vzc2FyeSBjbGVhbnVwIGlzIHBlcmZvcm1lZC5cbiAgICovXG4gIHJlbW92ZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb246IEVtaXR0ZXJTdWJzY3JpcHRpb24pIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBzdWJzY3JpcHRpb24uZW1pdHRlciA9PT0gdGhpcyxcbiAgICAgICdTdWJzY3JpcHRpb24gZG9lcyBub3QgYmVsb25nIHRvIHRoaXMgZW1pdHRlci4nLFxuICAgICk7XG4gICAgdGhpcy5fc3Vic2NyaWJlci5yZW1vdmVTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIGxpc3RlbmVycyB0aGF0IGFyZSBjdXJyZW50bHkgcmVnaXN0ZXJlZCBmb3IgdGhlIGdpdmVuXG4gICAqIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gcXVlcnlcbiAgICogQHJldHVybnMge2FycmF5fVxuICAgKi9cbiAgbGlzdGVuZXJzKGV2ZW50VHlwZTogc3RyaW5nKTogW0VtaXR0ZXJTdWJzY3JpcHRpb25dIHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb25zID0gdGhpcy5fc3Vic2NyaWJlci5nZXRTdWJzY3JpcHRpb25zRm9yVHlwZShldmVudFR5cGUpO1xuICAgIHJldHVybiBzdWJzY3JpcHRpb25zXG4gICAgICA/IHN1YnNjcmlwdGlvbnNcbiAgICAgICAgICAvLyBXZSBmaWx0ZXIgb3V0IG1pc3NpbmcgZW50cmllcyBiZWNhdXNlIHRoZSBhcnJheSBpcyBzcGFyc2UuXG4gICAgICAgICAgLy8gXCJjYWxsYmFja2ZuIGlzIGNhbGxlZCBvbmx5IGZvciBlbGVtZW50cyBvZiB0aGUgYXJyYXkgd2hpY2ggYWN0dWFsbHlcbiAgICAgICAgICAvLyBleGlzdDsgaXQgaXMgbm90IGNhbGxlZCBmb3IgbWlzc2luZyBlbGVtZW50cyBvZiB0aGUgYXJyYXkuXCJcbiAgICAgICAgICAvLyBodHRwczovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzkuMC9pbmRleC5odG1sI3NlYy1hcnJheS5wcm90b3R5cGUuZmlsdGVyXG4gICAgICAgICAgLmZpbHRlcihzcGFyc2VGaWx0ZXJQcmVkaWNhdGUpXG4gICAgICAgICAgLm1hcChzdWJzY3JpcHRpb24gPT4gc3Vic2NyaXB0aW9uLmxpc3RlbmVyKVxuICAgICAgOiBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWl0cyBhbiBldmVudCBvZiB0aGUgZ2l2ZW4gdHlwZSB3aXRoIHRoZSBnaXZlbiBkYXRhLiBBbGwgaGFuZGxlcnMgb2YgdGhhdFxuICAgKiBwYXJ0aWN1bGFyIHR5cGUgd2lsbCBiZSBub3RpZmllZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGVtaXRcbiAgICogQHBhcmFtIHsuLi4qfSBBcmJpdHJhcnkgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byBlYWNoIHJlZ2lzdGVyZWQgbGlzdGVuZXJcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogICBlbWl0dGVyLmFkZExpc3RlbmVyKCdzb21lRXZlbnQnLCBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAqICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICogICB9KTtcbiAgICpcbiAgICogICBlbWl0dGVyLmVtaXQoJ3NvbWVFdmVudCcsICdhYmMnKTsgLy8gbG9ncyAnYWJjJ1xuICAgKi9cbiAgZW1pdChldmVudFR5cGU6IHN0cmluZykge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSB0aGlzLl9zdWJzY3JpYmVyLmdldFN1YnNjcmlwdGlvbnNGb3JUeXBlKGV2ZW50VHlwZSk7XG4gICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc3Vic2NyaXB0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uc1tpXTtcblxuICAgICAgICAvLyBUaGUgc3Vic2NyaXB0aW9uIG1heSBoYXZlIGJlZW4gcmVtb3ZlZCBkdXJpbmcgdGhpcyBldmVudCBsb29wLlxuICAgICAgICBpZiAoc3Vic2NyaXB0aW9uICYmIHN1YnNjcmlwdGlvbi5saXN0ZW5lcikge1xuICAgICAgICAgIHRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb247XG4gICAgICAgICAgc3Vic2NyaXB0aW9uLmxpc3RlbmVyLmFwcGx5KFxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmNvbnRleHQsXG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIHRoZSBnaXZlbiBsaXN0ZW5lciBmb3IgZXZlbnQgb2Ygc3BlY2lmaWMgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50VHlwZSAtIE5hbWUgb2YgdGhlIGV2ZW50IHRvIGVtaXRcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBGdW5jdGlvbiB0byBpbnZva2Ugd2hlbiB0aGUgc3BlY2lmaWVkIGV2ZW50IGlzXG4gICAqICAgZW1pdHRlZFxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgIGVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoJ3NvbWVFdmVudCcsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICogICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgKiAgIH0pOyAvLyByZW1vdmVzIHRoZSBsaXN0ZW5lciBpZiBhbHJlYWR5IHJlZ2lzdGVyZWRcbiAgICpcbiAgICovXG4gIHJlbW92ZUxpc3RlbmVyKGV2ZW50VHlwZTogU3RyaW5nLCBsaXN0ZW5lcikge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSB0aGlzLl9zdWJzY3JpYmVyLmdldFN1YnNjcmlwdGlvbnNGb3JUeXBlKGV2ZW50VHlwZSk7XG4gICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc3Vic2NyaXB0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uc1tpXTtcblxuICAgICAgICAvLyBUaGUgc3Vic2NyaXB0aW9uIG1heSBoYXZlIGJlZW4gcmVtb3ZlZCBkdXJpbmcgdGhpcyBldmVudCBsb29wLlxuICAgICAgICAvLyBpdHMgbGlzdGVuZXIgbWF0Y2hlcyB0aGUgbGlzdGVuZXIgaW4gbWV0aG9kIHBhcmFtZXRlcnNcbiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbiAmJiBzdWJzY3JpcHRpb24ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xuIl19