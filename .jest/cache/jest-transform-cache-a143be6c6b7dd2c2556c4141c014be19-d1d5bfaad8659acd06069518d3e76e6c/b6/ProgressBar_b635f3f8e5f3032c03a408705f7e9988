b99dc06e61aff6cde3daf53b2b10af0e
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault2(require("@babel/runtime/helpers/objectWithoutProperties"));

var _excluded = ["color", "indeterminate", "style", "progress", "visible", "theme"];
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _color = _interopRequireDefault(require("color"));

var _theming = require("../core/theming");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

var INDETERMINATE_DURATION = 2000;
var INDETERMINATE_MAX_WIDTH = 0.6;
var isRTL = _reactNative.I18nManager.isRTL;

var ProgressBar = function ProgressBar(_ref) {
  var color = _ref.color,
      indeterminate = _ref.indeterminate,
      style = _ref.style,
      _ref$progress = _ref.progress,
      progress = _ref$progress === void 0 ? 0 : _ref$progress,
      _ref$visible = _ref.visible,
      visible = _ref$visible === void 0 ? true : _ref$visible,
      theme = _ref.theme,
      rest = (0, _objectWithoutProperties2.default)(_ref, _excluded);

  var _React$useRef = React.useRef(new _reactNative.Animated.Value(0)),
      timer = _React$useRef.current;

  var _React$useRef2 = React.useRef(new _reactNative.Animated.Value(0)),
      fade = _React$useRef2.current;

  var _React$useState = React.useState(0),
      _React$useState2 = (0, _slicedToArray2.default)(_React$useState, 2),
      width = _React$useState2[0],
      setWidth = _React$useState2[1];

  var _React$useState3 = React.useState(0),
      _React$useState4 = (0, _slicedToArray2.default)(_React$useState3, 2),
      prevWidth = _React$useState4[0],
      setPrevWidth = _React$useState4[1];

  var indeterminateAnimation = React.useRef(null);
  var scale = theme.animation.scale;
  var startAnimation = React.useCallback(function () {
    _reactNative.Animated.timing(fade, {
      duration: 200 * scale,
      toValue: 1,
      useNativeDriver: true,
      isInteraction: false
    }).start();

    if (indeterminate) {
      if (!indeterminateAnimation.current) {
        indeterminateAnimation.current = _reactNative.Animated.timing(timer, {
          duration: INDETERMINATE_DURATION,
          toValue: 1,
          useNativeDriver: _reactNative.Platform.OS !== 'web',
          isInteraction: false
        });
      }

      timer.setValue(0);

      _reactNative.Animated.loop(indeterminateAnimation.current).start();
    } else {
      _reactNative.Animated.timing(timer, {
        duration: 200 * scale,
        toValue: progress ? progress : 0,
        useNativeDriver: true,
        isInteraction: false
      }).start();
    }
  }, [scale, timer, progress, indeterminate, fade]);
  var stopAnimation = React.useCallback(function () {
    if (indeterminateAnimation.current) {
      indeterminateAnimation.current.stop();
    }

    _reactNative.Animated.timing(fade, {
      duration: 200 * scale,
      toValue: 0,
      useNativeDriver: true,
      isInteraction: false
    }).start();
  }, [fade, scale]);
  React.useEffect(function () {
    if (visible) startAnimation();else stopAnimation();
  }, [visible, startAnimation, stopAnimation]);
  React.useEffect(function () {
    if (visible && prevWidth === 0) {
      startAnimation();
    }
  }, [prevWidth, startAnimation, visible]);

  var onLayout = function onLayout(event) {
    setPrevWidth(width);
    setWidth(event.nativeEvent.layout.width);
  };

  var tintColor = color || theme.colors.primary;
  var trackTintColor = (0, _color.default)(tintColor).alpha(0.38).rgb().string();
  return React.createElement(_reactNative.View, _extends({
    onLayout: onLayout
  }, rest, {
    accessible: true,
    accessibilityRole: "progressbar",
    accessibilityState: {
      busy: visible
    },
    accessibilityValue: indeterminate ? {} : {
      min: 0,
      max: 100,
      now: progress * 100
    }
  }), React.createElement(_reactNative.Animated.View, {
    style: [styles.container, {
      backgroundColor: trackTintColor,
      opacity: fade
    }, style]
  }, React.createElement(_reactNative.Animated.View, {
    style: [styles.progressBar, {
      backgroundColor: tintColor,
      width: width,
      transform: [{
        translateX: timer.interpolate(indeterminate ? {
          inputRange: [0, 0.5, 1],
          outputRange: [(isRTL ? 1 : -1) * 0.5 * width, (isRTL ? 1 : -1) * 0.5 * INDETERMINATE_MAX_WIDTH * width, (isRTL ? -1 : 1) * 0.7 * width]
        } : {
          inputRange: [0, 1],
          outputRange: [(isRTL ? 1 : -1) * 0.5 * width, 0]
        })
      }, {
        scaleX: timer.interpolate(indeterminate ? {
          inputRange: [0, 0.5, 1],
          outputRange: [0.0001, INDETERMINATE_MAX_WIDTH, 0.0001]
        } : {
          inputRange: [0, 1],
          outputRange: [0.0001, 1]
        })
      }]
    }]
  })));
};

var styles = _reactNative.StyleSheet.create({
  container: {
    height: 4,
    overflow: 'hidden'
  },
  progressBar: {
    flex: 1
  }
});

var _default = (0, _theming.withTheme)(ProgressBar);

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlByb2dyZXNzQmFyLnRzeCJdLCJuYW1lcyI6WyJJTkRFVEVSTUlOQVRFX0RVUkFUSU9OIiwiSU5ERVRFUk1JTkFURV9NQVhfV0lEVEgiLCJpc1JUTCIsIkkxOG5NYW5hZ2VyIiwiUHJvZ3Jlc3NCYXIiLCJwcm9ncmVzcyIsInZpc2libGUiLCJyZXN0IiwiY3VycmVudCIsInRpbWVyIiwiUmVhY3QiLCJBbmltYXRlZCIsImZhZGUiLCJpbmRldGVybWluYXRlQW5pbWF0aW9uIiwic2NhbGUiLCJ0aGVtZSIsInN0YXJ0QW5pbWF0aW9uIiwiZHVyYXRpb24iLCJ0b1ZhbHVlIiwidXNlTmF0aXZlRHJpdmVyIiwiaXNJbnRlcmFjdGlvbiIsIlBsYXRmb3JtIiwic3RvcEFuaW1hdGlvbiIsInByZXZXaWR0aCIsIm9uTGF5b3V0IiwiZXZlbnQiLCJzZXRQcmV2V2lkdGgiLCJzZXRXaWR0aCIsInRpbnRDb2xvciIsImNvbG9yIiwidHJhY2tUaW50Q29sb3IiLCJidXN5IiwiaW5kZXRlcm1pbmF0ZSIsIm1pbiIsIm1heCIsIm5vdyIsInN0eWxlcyIsImJhY2tncm91bmRDb2xvciIsIm9wYWNpdHkiLCJ3aWR0aCIsInRyYW5zZm9ybSIsInRyYW5zbGF0ZVgiLCJpbnB1dFJhbmdlIiwib3V0cHV0UmFuZ2UiLCJzY2FsZVgiLCJjb250YWluZXIiLCJoZWlnaHQiLCJvdmVyZmxvdyIsInByb2dyZXNzQmFyIiwiZmxleCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLEtBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFlBQUEsR0FBQSxPQUFBLENBQUEsY0FBQSxDQUFBOztBQVVBLElBQUEsTUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLE9BQUEsbUJBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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UEYsQ0FWRixDQURGO0FBM0ZGLENBQUE7O0FBbUtBLElBQU1QLE1BQU0sR0FBRyxZQUFBLENBQUEsVUFBQSxDQUFBLE1BQUEsQ0FBa0I7QUFDL0JTLEVBQUFBLFNBQVMsRUFBRTtBQUNUQyxJQUFBQSxNQUFNLEVBREcsQ0FBQTtBQUVUQyxJQUFBQSxRQUFRLEVBQUU7QUFGRCxHQURvQjtBQU0vQkMsRUFBQUEsV0FBVyxFQUFFO0FBQ1hDLElBQUFBLElBQUksRUFBRTtBQURLO0FBTmtCLENBQWxCLENBQWY7O2VBV2UsQ0FBQSxHQUFBLFFBQUEsQ0FBQSxTQUFBLEVBQUEsV0FBQSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgQW5pbWF0ZWQsXG4gIFBsYXRmb3JtLFxuICBTdHlsZVNoZWV0LFxuICBWaWV3LFxuICBWaWV3U3R5bGUsXG4gIFN0eWxlUHJvcCxcbiAgTGF5b3V0Q2hhbmdlRXZlbnQsXG4gIEkxOG5NYW5hZ2VyLFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IHNldENvbG9yIGZyb20gJ2NvbG9yJztcbmltcG9ydCB7IHdpdGhUaGVtZSB9IGZyb20gJy4uL2NvcmUvdGhlbWluZyc7XG5cbnR5cGUgUHJvcHMgPSBSZWFjdC5Db21wb25lbnRQcm9wc1dpdGhSZWY8dHlwZW9mIFZpZXc+ICYge1xuICAvKipcbiAgICogUHJvZ3Jlc3MgdmFsdWUgKGJldHdlZW4gMCBhbmQgMSkuXG4gICAqL1xuICBwcm9ncmVzcz86IG51bWJlcjtcbiAgLyoqXG4gICAqIENvbG9yIG9mIHRoZSBwcm9ncmVzcyBiYXIuIFRoZSBiYWNrZ3JvdW5kIGNvbG9yIHdpbGwgYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGlzIGJ1dCB5b3UgY2FuIGNoYW5nZSBpdCBieSBwYXNzaW5nIGBiYWNrZ3JvdW5kQ29sb3JgIHRvIGBzdHlsZWAgcHJvcC5cbiAgICovXG4gIGNvbG9yPzogc3RyaW5nO1xuICAvKipcbiAgICogSWYgdGhlIHByb2dyZXNzIGJhciB3aWxsIHNob3cgaW5kZXRlcm1pbmF0ZSBwcm9ncmVzcy5cbiAgICovXG4gIGluZGV0ZXJtaW5hdGU/OiBib29sZWFuO1xuICAvKipcbiAgICogV2hldGhlciB0byBzaG93IHRoZSBQcm9ncmVzc0JhciAodHJ1ZSwgdGhlIGRlZmF1bHQpIG9yIGhpZGUgaXQgKGZhbHNlKS5cbiAgICovXG4gIHZpc2libGU/OiBib29sZWFuO1xuICBzdHlsZT86IFN0eWxlUHJvcDxWaWV3U3R5bGU+O1xuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqL1xuICB0aGVtZTogUmVhY3ROYXRpdmVQYXBlci5UaGVtZTtcbn07XG5cbmNvbnN0IElOREVURVJNSU5BVEVfRFVSQVRJT04gPSAyMDAwO1xuY29uc3QgSU5ERVRFUk1JTkFURV9NQVhfV0lEVEggPSAwLjY7XG5jb25zdCB7IGlzUlRMIH0gPSBJMThuTWFuYWdlcjtcblxuLyoqXG4gKiBQcm9ncmVzcyBiYXIgaXMgYW4gaW5kaWNhdG9yIHVzZWQgdG8gcHJlc2VudCBwcm9ncmVzcyBvZiBzb21lIGFjdGl2aXR5IGluIHRoZSBhcHAuXG4gKlxuICogPGRpdiBjbGFzcz1cInNjcmVlbnNob3RzXCI+XG4gKiAgIDxpbWcgc3JjPVwic2NyZWVuc2hvdHMvcHJvZ3Jlc3MtYmFyLnBuZ1wiIC8+XG4gKiA8L2Rpdj5cbiAqXG4gKiAjIyBVc2FnZVxuICogYGBganNcbiAqIGltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbiAqIGltcG9ydCB7IFByb2dyZXNzQmFyLCBDb2xvcnMgfSBmcm9tICdyZWFjdC1uYXRpdmUtcGFwZXInO1xuICpcbiAqIGNvbnN0IE15Q29tcG9uZW50ID0gKCkgPT4gKFxuICogICA8UHJvZ3Jlc3NCYXIgcHJvZ3Jlc3M9ezAuNX0gY29sb3I9e0NvbG9ycy5yZWQ4MDB9IC8+XG4gKiApO1xuICpcbiAqIGV4cG9ydCBkZWZhdWx0IE15Q29tcG9uZW50O1xuICogYGBgXG4gKi9cbmNvbnN0IFByb2dyZXNzQmFyID0gKHtcbiAgY29sb3IsXG4gIGluZGV0ZXJtaW5hdGUsXG4gIHN0eWxlLFxuICBwcm9ncmVzcyA9IDAsXG4gIHZpc2libGUgPSB0cnVlLFxuICB0aGVtZSxcbiAgLi4ucmVzdFxufTogUHJvcHMpID0+IHtcbiAgY29uc3QgeyBjdXJyZW50OiB0aW1lciB9ID0gUmVhY3QudXNlUmVmPEFuaW1hdGVkLlZhbHVlPihcbiAgICBuZXcgQW5pbWF0ZWQuVmFsdWUoMClcbiAgKTtcbiAgY29uc3QgeyBjdXJyZW50OiBmYWRlIH0gPSBSZWFjdC51c2VSZWY8QW5pbWF0ZWQuVmFsdWU+KG5ldyBBbmltYXRlZC5WYWx1ZSgwKSk7XG4gIGNvbnN0IFt3aWR0aCwgc2V0V2lkdGhdID0gUmVhY3QudXNlU3RhdGU8bnVtYmVyPigwKTtcbiAgY29uc3QgW3ByZXZXaWR0aCwgc2V0UHJldldpZHRoXSA9IFJlYWN0LnVzZVN0YXRlPG51bWJlcj4oMCk7XG5cbiAgY29uc3QgaW5kZXRlcm1pbmF0ZUFuaW1hdGlvbiA9IFJlYWN0LnVzZVJlZjxBbmltYXRlZC5Db21wb3NpdGVBbmltYXRpb24gfCBudWxsPihcbiAgICBudWxsXG4gICk7XG5cbiAgY29uc3QgeyBzY2FsZSB9ID0gdGhlbWUuYW5pbWF0aW9uO1xuXG4gIGNvbnN0IHN0YXJ0QW5pbWF0aW9uID0gUmVhY3QudXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIC8vIFNob3cgcHJvZ3Jlc3MgYmFyXG4gICAgQW5pbWF0ZWQudGltaW5nKGZhZGUsIHtcbiAgICAgIGR1cmF0aW9uOiAyMDAgKiBzY2FsZSxcbiAgICAgIHRvVmFsdWU6IDEsXG4gICAgICB1c2VOYXRpdmVEcml2ZXI6IHRydWUsXG4gICAgICBpc0ludGVyYWN0aW9uOiBmYWxzZSxcbiAgICB9KS5zdGFydCgpO1xuXG4gICAgLy8gQW5pbWF0ZSBwcm9ncmVzcyBiYXJcbiAgICBpZiAoaW5kZXRlcm1pbmF0ZSkge1xuICAgICAgaWYgKCFpbmRldGVybWluYXRlQW5pbWF0aW9uLmN1cnJlbnQpIHtcbiAgICAgICAgaW5kZXRlcm1pbmF0ZUFuaW1hdGlvbi5jdXJyZW50ID0gQW5pbWF0ZWQudGltaW5nKHRpbWVyLCB7XG4gICAgICAgICAgZHVyYXRpb246IElOREVURVJNSU5BVEVfRFVSQVRJT04sXG4gICAgICAgICAgdG9WYWx1ZTogMSxcbiAgICAgICAgICAvLyBBbmltYXRlZC5sb29wIGRvZXMgbm90IHdvcmsgaWYgdXNlTmF0aXZlRHJpdmVyIGlzIHRydWUgb24gd2ViXG4gICAgICAgICAgdXNlTmF0aXZlRHJpdmVyOiBQbGF0Zm9ybS5PUyAhPT0gJ3dlYicsXG4gICAgICAgICAgaXNJbnRlcmFjdGlvbjogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXNldCB0aW1lciB0byB0aGUgYmVnaW5uaW5nXG4gICAgICB0aW1lci5zZXRWYWx1ZSgwKTtcblxuICAgICAgQW5pbWF0ZWQubG9vcChpbmRldGVybWluYXRlQW5pbWF0aW9uLmN1cnJlbnQpLnN0YXJ0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIEFuaW1hdGVkLnRpbWluZyh0aW1lciwge1xuICAgICAgICBkdXJhdGlvbjogMjAwICogc2NhbGUsXG4gICAgICAgIHRvVmFsdWU6IHByb2dyZXNzID8gcHJvZ3Jlc3MgOiAwLFxuICAgICAgICB1c2VOYXRpdmVEcml2ZXI6IHRydWUsXG4gICAgICAgIGlzSW50ZXJhY3Rpb246IGZhbHNlLFxuICAgICAgfSkuc3RhcnQoKTtcbiAgICB9XG4gIH0sIFtzY2FsZSwgdGltZXIsIHByb2dyZXNzLCBpbmRldGVybWluYXRlLCBmYWRlXSk7XG5cbiAgY29uc3Qgc3RvcEFuaW1hdGlvbiA9IFJlYWN0LnVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAvLyBTdG9wIGluZGV0ZXJtaW5hdGUgYW5pbWF0aW9uXG4gICAgaWYgKGluZGV0ZXJtaW5hdGVBbmltYXRpb24uY3VycmVudCkge1xuICAgICAgaW5kZXRlcm1pbmF0ZUFuaW1hdGlvbi5jdXJyZW50LnN0b3AoKTtcbiAgICB9XG5cbiAgICBBbmltYXRlZC50aW1pbmcoZmFkZSwge1xuICAgICAgZHVyYXRpb246IDIwMCAqIHNjYWxlLFxuICAgICAgdG9WYWx1ZTogMCxcbiAgICAgIHVzZU5hdGl2ZURyaXZlcjogdHJ1ZSxcbiAgICAgIGlzSW50ZXJhY3Rpb246IGZhbHNlLFxuICAgIH0pLnN0YXJ0KCk7XG4gIH0sIFtmYWRlLCBzY2FsZV0pO1xuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHZpc2libGUpIHN0YXJ0QW5pbWF0aW9uKCk7XG4gICAgZWxzZSBzdG9wQW5pbWF0aW9uKCk7XG4gIH0sIFt2aXNpYmxlLCBzdGFydEFuaW1hdGlvbiwgc3RvcEFuaW1hdGlvbl0pO1xuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgLy8gU3RhcnQgYW5pbWF0aW9uIHRoZSB2ZXJ5IGZpcnN0IHRpbWUgd2hlbiBwcmV2aW91c2x5IHRoZSB3aWR0aCB3YXMgdW5jbGVhclxuICAgIGlmICh2aXNpYmxlICYmIHByZXZXaWR0aCA9PT0gMCkge1xuICAgICAgc3RhcnRBbmltYXRpb24oKTtcbiAgICB9XG4gIH0sIFtwcmV2V2lkdGgsIHN0YXJ0QW5pbWF0aW9uLCB2aXNpYmxlXSk7XG5cbiAgY29uc3Qgb25MYXlvdXQgPSAoZXZlbnQ6IExheW91dENoYW5nZUV2ZW50KSA9PiB7XG4gICAgc2V0UHJldldpZHRoKHdpZHRoKTtcbiAgICBzZXRXaWR0aChldmVudC5uYXRpdmVFdmVudC5sYXlvdXQud2lkdGgpO1xuICB9O1xuXG4gIGNvbnN0IHRpbnRDb2xvciA9IGNvbG9yIHx8IHRoZW1lLmNvbG9ycy5wcmltYXJ5O1xuICBjb25zdCB0cmFja1RpbnRDb2xvciA9IHNldENvbG9yKHRpbnRDb2xvcikuYWxwaGEoMC4zOCkucmdiKCkuc3RyaW5nKCk7XG5cbiAgcmV0dXJuIChcbiAgICA8Vmlld1xuICAgICAgb25MYXlvdXQ9e29uTGF5b3V0fVxuICAgICAgey4uLnJlc3R9XG4gICAgICBhY2Nlc3NpYmxlXG4gICAgICBhY2Nlc3NpYmlsaXR5Um9sZT1cInByb2dyZXNzYmFyXCJcbiAgICAgIGFjY2Vzc2liaWxpdHlTdGF0ZT17eyBidXN5OiB2aXNpYmxlIH19XG4gICAgICBhY2Nlc3NpYmlsaXR5VmFsdWU9e1xuICAgICAgICBpbmRldGVybWluYXRlID8ge30gOiB7IG1pbjogMCwgbWF4OiAxMDAsIG5vdzogcHJvZ3Jlc3MgKiAxMDAgfVxuICAgICAgfVxuICAgID5cbiAgICAgIDxBbmltYXRlZC5WaWV3XG4gICAgICAgIHN0eWxlPXtbXG4gICAgICAgICAgc3R5bGVzLmNvbnRhaW5lcixcbiAgICAgICAgICB7IGJhY2tncm91bmRDb2xvcjogdHJhY2tUaW50Q29sb3IsIG9wYWNpdHk6IGZhZGUgfSxcbiAgICAgICAgICBzdHlsZSxcbiAgICAgICAgXX1cbiAgICAgID5cbiAgICAgICAgPEFuaW1hdGVkLlZpZXdcbiAgICAgICAgICBzdHlsZT17W1xuICAgICAgICAgICAgc3R5bGVzLnByb2dyZXNzQmFyLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRpbnRDb2xvcixcbiAgICAgICAgICAgICAgd2lkdGgsXG4gICAgICAgICAgICAgIHRyYW5zZm9ybTogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZVg6IHRpbWVyLmludGVycG9sYXRlKFxuICAgICAgICAgICAgICAgICAgICBpbmRldGVybWluYXRlXG4gICAgICAgICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0UmFuZ2U6IFswLCAwLjUsIDFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRSYW5nZTogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpc1JUTCA/IDEgOiAtMSkgKiAwLjUgKiB3aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaXNSVEwgPyAxIDogLTEpICpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuNSAqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJTkRFVEVSTUlOQVRFX01BWF9XSURUSCAqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaXNSVEwgPyAtMSA6IDEpICogMC43ICogd2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0UmFuZ2U6IFswLCAxXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0UmFuZ2U6IFsoaXNSVEwgPyAxIDogLTEpICogMC41ICogd2lkdGgsIDBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIC8vIFdvcmthcm91bmQgZm9yIHdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC1uYXRpdmUvaXNzdWVzLzYyNzhcbiAgICAgICAgICAgICAgICAgIHNjYWxlWDogdGltZXIuaW50ZXJwb2xhdGUoXG4gICAgICAgICAgICAgICAgICAgIGluZGV0ZXJtaW5hdGVcbiAgICAgICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRSYW5nZTogWzAsIDAuNSwgMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFJhbmdlOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMC4wMDAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIElOREVURVJNSU5BVEVfTUFYX1dJRFRILFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMDAwMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRSYW5nZTogWzAsIDFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRSYW5nZTogWzAuMDAwMSwgMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF19XG4gICAgICAgIC8+XG4gICAgICA8L0FuaW1hdGVkLlZpZXc+XG4gICAgPC9WaWV3PlxuICApO1xufTtcblxuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBjb250YWluZXI6IHtcbiAgICBoZWlnaHQ6IDQsXG4gICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICB9LFxuXG4gIHByb2dyZXNzQmFyOiB7XG4gICAgZmxleDogMSxcbiAgfSxcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCB3aXRoVGhlbWUoUHJvZ3Jlc3NCYXIpO1xuIl19