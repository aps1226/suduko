592b5aa3de52e7173586eaaead12f0d3
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = GridSquare;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _react = _interopRequireDefault(require("react"));

var _reactNative = require("react-native");

var _reactRedux = require("react-redux");

var _redux = require("redux");

var actionCreators = _interopRequireWildcard(require("../src/state/index"));

var _boardController = require("../src/state/boardController");

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function GridSquare(props) {
  var _useSelector = (0, _reactRedux.useSelector)(function (state) {
    return state;
  }),
      board = _useSelector.board,
      colors = _useSelector.colors,
      selection = _useSelector.selection,
      entryMode = _useSelector.entryMode,
      notes = _useSelector.notes;

  var dispatch = (0, _reactRedux.useDispatch)();

  var _bindActionCreators = (0, _redux.bindActionCreators)(actionCreators, dispatch),
      changeColor = _bindActionCreators.changeColor,
      setSelection = _bindActionCreators.setSelection,
      setBoard = _bindActionCreators.setBoard,
      setNotes = _bindActionCreators.setNotes,
      setGameState = _bindActionCreators.setGameState;

  var row = props.row,
      col = props.col;
  var colorIndex = String(board[row][col]);
  var color = colors[colorIndex] ? colors[colorIndex] : ['transparent', 'black'];

  var handleOnPress = function handleOnPress() {
    if (board[row][col]) {
      changeColor(String(board[row][col]));
      setSelection(board[row][col]);
    } else if (selection && entryMode) {
      var newBoard = board.map(function (arr) {
        return (0, _toConsumableArray2.default)(arr);
      });
      newBoard[row][col] = Number(selection);

      if ((0, _boardController.isValidSudoku)(newBoard.map(function (arr) {
        return (0, _toConsumableArray2.default)(arr);
      }))) {
        setBoard(newBoard);

        if ((0, _boardController.isCompleted)(newBoard.map(function (arr) {
          return (0, _toConsumableArray2.default)(arr);
        }))) {
          setGameState({
            'isCompleted': true,
            'gameExists': false
          });
        }
      }
    } else if (selection && !entryMode) {
      var newNotes = (0, _extends2.default)({}, notes);
      var newNotesIndex = "" + row + col;

      if (newNotes[newNotesIndex]) {
        if (!newNotes[newNotesIndex].includes(selection)) newNotes[newNotesIndex].push(selection);
      } else newNotes[newNotesIndex] = [selection];

      setNotes(newNotes);
    }
  };

  var renderNotes = function renderNotes() {
    if (!notes || !notes["" + row + col]) return _react.default.createElement(_reactNative.Text, null);
    var notesToRender = notes["" + row + col];
    var notesJSX = [];
    var noteRows;
    var curRow = [];
    var pointer = 1;

    while (pointer <= 9) {
      curRow.push(_react.default.createElement(_reactNative.View, {
        key: String("Square[" + row + col + "]_Note_" + (pointer - 1))
      }, _react.default.createElement(_reactNative.Text, {
        style: styles.noteText
      }, notesToRender[pointer - 1])));

      if (pointer % 3 === 0 && pointer > 0) {
        noteRows = _react.default.createElement(_reactNative.View, {
          key: String("NoteRow_" + pointer),
          style: styles.noteRow
        }, curRow);
        curRow = [];
        notesJSX.push(noteRows);
      }

      pointer++;
    }

    return _react.default.createElement(_reactNative.View, {
      style: styles.noteContainer
    }, notesJSX);
  };

  return _react.default.createElement(_reactNative.View, {
    style: styles.container
  }, _react.default.createElement(_reactNative.TouchableHighlight, {
    onPress: handleOnPress
  }, _react.default.createElement(_reactNative.View, {
    style: {
      borderStyle: 'solid',
      backgroundColor: color[0],
      width: 38,
      height: 38,
      borderWidth: 5,
      borderLeftColor: 'rgba(255, 255, 255, 0.20)',
      borderTopColor: 'rgba(255, 255, 255, 0.33)',
      borderRightColor: 'rgba(0, 0, 0, 0.15)',
      borderBottomColor: 'rgba(0, 0, 0, 0.5)',
      alignItems: 'center'
    }
  }, _react.default.createElement(_reactNative.ImageBackground, {
    source: require("../assets/images/square.jpg"),
    style: styles.backgroundImage
  }, board[row][col] === null ? renderNotes() : _react.default.createElement(_reactNative.Text, {
    style: {
      color: color[1],
      textAlign: 'center',
      marginTop: '20%'
    }
  }, String(board[row][col]))))));
}

var styles = _reactNative.StyleSheet.create({
  container: {},
  noteContainer: {
    flex: 1,
    flexDirection: 'column',
    alignItems: 'center'
  },
  noteRow: {
    flex: 1,
    flexDirection: 'row',
    alignItems: 'flex-start'
  },
  noteText: {
    fontSize: 9,
    fontFamily: 'JustAnotherHand'
  },
  backgroundImage: {
    width: '100%',
    height: '100%'
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcYXNoZWVcXERvY3VtZW50c1xcSmF2YXNjcmlwdFxcUmVhY3RcXFJlYWN0IE5hdGl2ZVxcc3VkdWtvXFxjb21wb25lbnRzXFxHcmlkU3F1YXJlLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFJYyxTQUFVLFVBQVYsQ0FBcUIsS0FBckIsRUFBaUM7QUFFN0MscUJBQWtELDZCQUFZLFVBQUMsS0FBRDtBQUFBLFdBQXFCLEtBQXJCO0FBQUEsR0FBWixDQUFsRDtBQUFBLE1BQU8sS0FBUCxnQkFBTyxLQUFQO0FBQUEsTUFBYSxNQUFiLGdCQUFhLE1BQWI7QUFBQSxNQUFvQixTQUFwQixnQkFBb0IsU0FBcEI7QUFBQSxNQUErQixTQUEvQixnQkFBK0IsU0FBL0I7QUFBQSxNQUF5QyxLQUF6QyxnQkFBeUMsS0FBekM7O0FBQ0EsTUFBTSxRQUFRLEdBQUcsOEJBQWpCOztBQUVBLDRCQUF3RSwrQkFBbUIsY0FBbkIsRUFBa0MsUUFBbEMsQ0FBeEU7QUFBQSxNQUFRLFdBQVIsdUJBQVEsV0FBUjtBQUFBLE1BQXFCLFlBQXJCLHVCQUFxQixZQUFyQjtBQUFBLE1BQW1DLFFBQW5DLHVCQUFtQyxRQUFuQztBQUFBLE1BQTZDLFFBQTdDLHVCQUE2QyxRQUE3QztBQUFBLE1BQXVELFlBQXZELHVCQUF1RCxZQUF2RDs7QUFFQSxNQUFPLEdBQVAsR0FBa0IsS0FBbEIsQ0FBTyxHQUFQO0FBQUEsTUFBVyxHQUFYLEdBQWtCLEtBQWxCLENBQVcsR0FBWDtBQUVBLE1BQU0sVUFBVSxHQUFVLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRCxDQUFMLENBQVcsR0FBWCxDQUFELENBQWhDO0FBQ0EsTUFBTSxLQUFLLEdBQVksTUFBTSxDQUFDLFVBQUQsQ0FBTixHQUFxQixNQUFNLENBQUMsVUFBRCxDQUEzQixHQUF5QyxDQUFDLGFBQUQsRUFBZSxPQUFmLENBQWhFOztB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cEIsR0FDQyxXQUFXLEVBRFosR0FHQyxlQUFBLGFBQUEsQ0FBQyxpQkFBRCxFQUFLO0FBQ0gsSUFBQSxLQUFLLEVBQUk7QUFDUCxNQUFBLEtBQUssRUFBQyxLQUFLLENBQUMsQ0FBRCxDQURKO0FBRVAsTUFBQSxTQUFTLEVBQUMsUUFGSDtBQUdQLE1BQUEsU0FBUyxFQUFDO0FBSEg7QUFETixHQUFMLEVBT0csTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFELENBQUwsQ0FBVyxHQUFYLENBQUQsQ0FQVCxDQVRKLENBZEYsQ0FIRixDQURGLENBREY7QUEyQ0Q7O0FBRUQsSUFBTSxNQUFNLEdBQUcsd0JBQVcsTUFBWCxDQUFrQjtBQUMvQixFQUFBLFNBQVMsRUFBRSxFQURvQjtBQUcvQixFQUFBLGFBQWEsRUFBQztBQUNaLElBQUEsSUFBSSxFQUFDLENBRE87QUFFWixJQUFBLGFBQWEsRUFBQyxRQUZGO0FBR1osSUFBQSxVQUFVLEVBQUM7QUFIQyxHQUhpQjtBQVEvQixFQUFBLE9BQU8sRUFBQztBQUNOLElBQUEsSUFBSSxFQUFDLENBREM7QUFFTixJQUFBLGFBQWEsRUFBQyxLQUZSO0FBR04sSUFBQSxVQUFVLEVBQUM7QUFITCxHQVJ1QjtBQWEvQixFQUFBLFFBQVEsRUFBQztBQUNQLElBQUEsUUFBUSxFQUFDLENBREY7QUFFUCxJQUFBLFVBQVUsRUFBQztBQUZKLEdBYnNCO0FBaUIvQixFQUFBLGVBQWUsRUFBQztBQUNkLElBQUEsS0FBSyxFQUFDLE1BRFE7QUFFZCxJQUFBLE1BQU0sRUFBQztBQUZPO0FBakJlLENBQWxCLENBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHt1c2VFZmZlY3R9IGZyb20gXCJyZWFjdFwiO1xyXG5pbXBvcnQgeyBBbGVydCwgSW1hZ2VCYWNrZ3JvdW5kLCBTdHlsZVNoZWV0LCBUb3VjaGFibGVIaWdobGlnaHQsIFRleHQsIFZpZXcgfSBmcm9tIFwicmVhY3QtbmF0aXZlXCI7XHJcbmltcG9ydCB7IHVzZVNlbGVjdG9yLCB1c2VEaXNwYXRjaCB9IGZyb20gXCJyZWFjdC1yZWR1eFwiOyBcclxuaW1wb3J0IHsgYmluZEFjdGlvbkNyZWF0b3JzIH0gZnJvbSBcInJlZHV4XCI7XHJcbmltcG9ydCAqIGFzIGFjdGlvbkNyZWF0b3JzIGZyb20gJy4uL3NyYy9zdGF0ZS9pbmRleCc7XHJcbmltcG9ydCB7aXNWYWxpZFN1ZG9rdSxpc0NvbXBsZXRlZH0gZnJvbSAnLi4vc3JjL3N0YXRlL2JvYXJkQ29udHJvbGxlcidcclxuaW1wb3J0IHtJUHJvcHMsTm90ZXN9IGZyb20gJy4uL3R5cGVzJztcclxuaW1wb3J0IHtSb290U3RhdGV9IGZyb20gJy4uL3NyYy9zdGF0ZS9yZWR1Y2Vycy9pbmRleCc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBHcmlkU3F1YXJlKHByb3BzOklQcm9wcykge1xyXG4gIC8vUmVkdXgtc3RhdGUuXHJcbiAgY29uc3Qge2JvYXJkLGNvbG9ycyxzZWxlY3Rpb24sIGVudHJ5TW9kZSxub3Rlc30gPSB1c2VTZWxlY3Rvcigoc3RhdGU6Um9vdFN0YXRlKSA9PiBzdGF0ZSk7XHJcbiAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpO1xyXG4gIC8vUmVkdXggYWN0aW9uIGNyZWF0b3JzLlxyXG4gIGNvbnN0IHsgY2hhbmdlQ29sb3IsIHNldFNlbGVjdGlvbiwgc2V0Qm9hcmQsIHNldE5vdGVzLCBzZXRHYW1lU3RhdGUgfSA9IGJpbmRBY3Rpb25DcmVhdG9ycyhhY3Rpb25DcmVhdG9ycyxkaXNwYXRjaCk7XHJcbiAgLy9QYXNzZWQgcm93IGFuZCBjb2x1bW4gcHJvcHMgZm9yIHJlc3BlY3RpdmUgc3F1YXJlLlxyXG4gIGNvbnN0IHtyb3csY29sfSA9IHByb3BzO1xyXG4gIC8vQ29sb3IgZm9yIHJlc3BlY3RpdmUgc3F1YXJlIGJhc2VkIG9uIGN1cnJlbnQgdmFsdWUuXHJcbiAgY29uc3QgY29sb3JJbmRleDpzdHJpbmcgPSBTdHJpbmcoYm9hcmRbcm93XVtjb2xdKTtcclxuICBjb25zdCBjb2xvcjpzdHJpbmdbXSA9IGNvbG9yc1tjb2xvckluZGV4XSA/IGNvbG9yc1tjb2xvckluZGV4XTogWyd0cmFuc3BhcmVudCcsJ2JsYWNrJ107XHJcbiAgXHJcbiAgY29uc3QgaGFuZGxlT25QcmVzcyA9ICgpOnZvaWQgPT57XHJcbiAgICAvL0lmIHZhbHVlIG9mIGJvYXJkIHNlbGVjdGlvbiBpcyBub3QgbnVsbFxyXG4gICAgICAvL0NoYW5nZSB0aGUgY29sb3Igb2YgdGhlIHJlc3BlY3RpdmUgdmFsdWUgdG8gZ3JlZW4gZm9yIFxyXG4gICAgICAvL2FsbCBkaXNwbGF5ZWQgdmFsdWVzIG9uIHRoZSBib2FyZC5cclxuICAgICAgLy9TZXQgc2VsZWN0aW9uIHByb3AgZXF1YWwgdG8gdmFsdWUuXHJcbiAgICBpZihib2FyZFtyb3ddW2NvbF0pe1xyXG4gICAgICBjaGFuZ2VDb2xvcihTdHJpbmcoYm9hcmRbcm93XVtjb2xdKSk7XHJcbiAgICAgIHNldFNlbGVjdGlvbihib2FyZFtyb3ddW2NvbF0pO1xyXG4gICAgfVxyXG4gICAgLy9FbHNlLCBkZXRlcm1pbmUgaWYgY3VycmVudCBzZWxlY3Rpb24gcGxhY2VkIGF0IHRoZSByZXNwZWN0aXZlXHJcbiAgICAvL2xvY2F0aW9uIGNyZWF0ZXMgYSB2YWxpZCBib2FyZC5cclxuICAgIGVsc2UgaWYoc2VsZWN0aW9uICYmIGVudHJ5TW9kZSl7XHJcbiAgICAgIGNvbnN0IG5ld0JvYXJkOihudW1iZXJ8bnVsbClbXVtdID0gYm9hcmQubWFwKChhcnI6KG51bWJlcnxudWxsKVtdKT0+IFsuLi5hcnJdKTtcclxuICAgICAgbmV3Qm9hcmRbcm93XVtjb2xdID0gTnVtYmVyKHNlbGVjdGlvbik7XHJcbiAgICAgIC8vSWYgYm9hcmQgd291bGQgYmUgdmFsaWQsIG1vZGlmeSBib2FyZCBzdGF0ZS5cclxuICAgICAgaWYoaXNWYWxpZFN1ZG9rdShuZXdCb2FyZC5tYXAoKGFycjoobnVtYmVyfG51bGwpW10pPT4gWy4uLmFycl0pKSl7XHJcbiAgICAgICAgc2V0Qm9hcmQobmV3Qm9hcmQpO1xyXG4gICAgICAgIC8vQ2hlY2sgaWYgYm9hcmQgaXMgY29tcGxldGVkLlxyXG4gICAgICAgICAgLy9JZiBjb21wbGV0ZSwgbW9kaWZ5IGdhbWVTdGF0ZSBwcm9wZXJ0eSB0byB3aGVyZSAnaXNDb21wbGV0ZScgaW5kZXggaXMgdHJ1ZS5cclxuICAgICAgICBpZihpc0NvbXBsZXRlZChuZXdCb2FyZC5tYXAoKGFycjoobnVtYmVyfG51bGwpW10pPT4gWy4uLmFycl0pKSl7XHJcbiAgICAgICAgICBzZXRHYW1lU3RhdGUoeydpc0NvbXBsZXRlZCc6dHJ1ZSwnZ2FtZUV4aXN0cyc6ZmFsc2V9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIC8vRWxzZSBpZiBhIG51bWJlciBpcyBzZWxlY3RlZCBhbmQgZW50cnlNb2RlIGlzIHNldCB0byAnbm90ZXMnLlxyXG4gICAgfSBlbHNlIGlmKHNlbGVjdGlvbiAmJiAhZW50cnlNb2RlKXtcclxuICAgICAgLy9DbG9uZSBub3RlcyBzdGF0ZS4gXHJcbiAgICAgIGNvbnN0IG5ld05vdGVzOk5vdGVzID0gT2JqZWN0LmFzc2lnbih7fSxub3Rlcyk7XHJcbiAgICAgIC8vQ3JlYXRlIHZhcmlhYmxlIGZvciBub3RlIGluZGV4IGJhc2VkIG9uIGN1cnJlbnQgcm93IGFuZCBjb2x1bW4gcG9zaXRpb24uXHJcbiAgICAgIGNvbnN0IG5ld05vdGVzSW5kZXg6c3RyaW5nID0gYCR7cm93fSR7Y29sfWA7XHJcbiAgICAgIC8vSWYgY3VycmVudCBzcXVhcmUgaGFzIGV4aXN0aW5nIG5vdGVzIHdpdGhpbiB0aGUgbm90ZSBvYmplY3Q6XHJcbiAgICAgIGlmKG5ld05vdGVzW25ld05vdGVzSW5kZXhdKXtcclxuICAgICAgICAvL0lmIG5vdGUgb2JqZWN0IGF0IGN1cnJlbnQgc3F1YXJlIGluZGV4IGRvZXMgbm90IGluY2x1ZGUgdGhlIGN1cnJlbnQgc2VsZWN0aW9uLFxyXG4gICAgICAgIC8vYWRkIHRoZSBzZWxlY3Rpb24gdG8gdGhlIGFycmF5IGF0IHRoZSBpbmRleC5cclxuICAgICAgICBpZighbmV3Tm90ZXNbbmV3Tm90ZXNJbmRleF0uaW5jbHVkZXMoc2VsZWN0aW9uKSkgbmV3Tm90ZXNbbmV3Tm90ZXNJbmRleF0ucHVzaChzZWxlY3Rpb24pXHJcbiAgICAgIC8vRWxzZSwgY3JlYXRlIHRoZSBpbmRleCB3aXRoaW4gdGhlIG5vdGUgb2JqZWN0IGluaXRpYWxpemVkIHRvIGN1cnJlbnQgc2VsZWN0aW9uLlxyXG4gICAgICB9IGVsc2UgbmV3Tm90ZXNbbmV3Tm90ZXNJbmRleF0gPSBbc2VsZWN0aW9uXTtcclxuICAgICAgLy9TZXQgbmV3IG5vdGVzIHN0YXRlLlxyXG4gICAgICBzZXROb3RlcyhuZXdOb3Rlcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL0Z1bmN0aW9uIHJlbmRlcnMgbm90ZSBmb3Igc3F1YXJlcyB3aXRoIG51bGwgdmFsdWVzIG9uIHRoZSBib2FyZC5cclxuICBjb25zdCByZW5kZXJOb3RlcyA9ICgpOkpTWC5FbGVtZW50ID0+e1xyXG4gICAgLy9SZXR1cm4gZW1wdHkgdGV4dCBlbGVtZW50IGlmIG5vdGVzIG9yIG5vdGVbaW5kZXhdIGRvIG5vdCBleGlzdC5cclxuICAgIGlmKCFub3RlcyB8fCAhbm90ZXNbYCR7cm93fSR7Y29sfWBdKSByZXR1cm4gKDxUZXh0PjwvVGV4dD4pO1xyXG4gICAgLy9Jbml0aWFsaXplIGFycmF5IG9mIG5vdGVzIHRvIGJlIHJlbmRlcmVkIGZyb20gdGhlIG5vdGVzIG9iamVjdFxyXG4gICAgLy93aXRoIHJlc3BlY3QgdG8gdGhlIGN1cnJlbnQgc3F1YXJlIHBvc2l0aW9uLlxyXG4gICAgY29uc3Qgbm90ZXNUb1JlbmRlciA9IG5vdGVzW2Ake3Jvd30ke2NvbH1gXTtcclxuICAgIC8vSW5pdGlhbGl6ZSBhcnJheSB0byBob2xkIGFsbCByb3dzIG9mIG5vdGVzLlxyXG4gICAgY29uc3Qgbm90ZXNKU1g6SlNYLkVsZW1lbnRbXSA9IFtdO1xyXG4gICAgLy9Jbml0aWFsaXplIHZhcmlhYmxlIHRvIGJlIHBvcHVsYXRlZCB3aXRoIGVhY2ggcm93IG9mIG5vdGVzLlxyXG4gICAgbGV0IG5vdGVSb3dzOkpTWC5FbGVtZW50O1xyXG4gICAgLy9Jbml0aWFsaXplIGFycmF5IHRvIGhvbGQgdGhlIGN1cnJlbnQgcm93IG9mIG5vdGVzLlxyXG4gICAgbGV0IGN1clJvdzpKU1guRWxlbWVudFtdID0gW107XHJcbiAgICAvL0luaXRpYWxpemUgcG9pbnRlciB0byBhbGxvdyBpdGVyYXRpb24gdGhyb3VnaCBub3Rlc1RvUmVuZGVyIGFycmF5LlxyXG4gICAgbGV0IHBvaW50ZXI6bnVtYmVyID0gMTtcclxuICAgIC8vSXRlcmF0ZSB0aHJvdWdoIG5vdGVzVG9SZW5kZXI6XHJcbiAgICB3aGlsZShwb2ludGVyIDw9IDkpe1xyXG4gICAgICAvL1B1c2ggZWFjaCBudW1iZXIgdG8gSlNYIHRvIGRpc3BsYXkgdmFsdWUuXHJcbiAgICAgIGN1clJvdy5wdXNoKFxyXG4gICAgICAgIDxWaWV3XHJcbiAgICAgICAgICBrZXkgPSB7U3RyaW5nKGBTcXVhcmVbJHtyb3d9JHtjb2x9XV9Ob3RlXyR7cG9pbnRlciAtIDF9YCl9XHJcbiAgICAgICAgPlxyXG4gICAgICAgICAgPFRleHRcclxuICAgICAgICAgICAgc3R5bGUgPSB7c3R5bGVzLm5vdGVUZXh0fVxyXG4gICAgICAgICAgPlxyXG4gICAgICAgICAgICB7bm90ZXNUb1JlbmRlcltwb2ludGVyIC0gMV19XHJcbiAgICAgICAgICA8L1RleHQ+XHJcbiAgICAgICAgPC9WaWV3PlxyXG4gICAgICApXHJcbiAgICAgIC8vQ3JlYXRlIDN4MyBncmlkIG9mIG5vdGVzIHdpdGhpbiBzcXVhcmUuXHJcbiAgICAgIGlmKHBvaW50ZXIgJSAzID09PSAwICYmIHBvaW50ZXIgPiAwKXtcclxuICAgICAgICBub3RlUm93cyA9IChcclxuICAgICAgICAgIDxWaWV3XHJcbiAgICAgICAgICAgIGtleSA9IHtTdHJpbmcoYE5vdGVSb3dfJHtwb2ludGVyfWApfSBcclxuICAgICAgICAgICAgc3R5bGUgPSB7c3R5bGVzLm5vdGVSb3d9XHJcbiAgICAgICAgICA+XHJcbiAgICAgICAgICAgIHtjdXJSb3d9XHJcbiAgICAgICAgICA8L1ZpZXc+XHJcbiAgICAgICAgKVxyXG4gICAgICAgIGN1clJvdyA9IFtdO1xyXG4gICAgICAgIG5vdGVzSlNYLnB1c2gobm90ZVJvd3MpO1xyXG4gICAgICB9XHJcbiAgICAgIHBvaW50ZXIgKys7XHJcbiAgICB9XHJcblxyXG4gICAgLy9SZXR1cm4gSlNYLlxyXG4gICAgcmV0dXJuKFxyXG4gICAgICA8Vmlld1xyXG4gICAgICAgIHN0eWxlID0ge3N0eWxlcy5ub3RlQ29udGFpbmVyfVxyXG4gICAgICA+XHJcbiAgICAgICAge25vdGVzSlNYfVxyXG4gICAgICA8L1ZpZXc+XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIChcclxuICAgIDxWaWV3IHN0eWxlPXtzdHlsZXMuY29udGFpbmVyfT5cclxuICAgICAgPFRvdWNoYWJsZUhpZ2hsaWdodFxyXG4gICAgICAgICAgb25QcmVzcyA9IHtoYW5kbGVPblByZXNzfVxyXG4gICAgICA+XHJcbiAgICAgICAgPFZpZXcgXHJcbiAgICAgICAgICBzdHlsZT17e1xyXG4gICAgICAgICAgICBib3JkZXJTdHlsZTonc29saWQnLFxyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6Y29sb3JbMF0sXHJcbiAgICAgICAgICAgIHdpZHRoOiAzOCxcclxuICAgICAgICAgICAgaGVpZ2h0OiAzOCxcclxuICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDUsXHJcbiAgICAgICAgICAgIGJvcmRlckxlZnRDb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4yMCknLFxyXG4gICAgICAgICAgICBib3JkZXJUb3BDb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4zMyknLFxyXG4gICAgICAgICAgICBib3JkZXJSaWdodENvbG9yOiAncmdiYSgwLCAwLCAwLCAwLjE1KScsXHJcbiAgICAgICAgICAgIGJvcmRlckJvdHRvbUNvbG9yOiAncmdiYSgwLCAwLCAwLCAwLjUpJyxcclxuICAgICAgICAgICAgYWxpZ25JdGVtczonY2VudGVyJ1xyXG4gICAgICAgICAgfX1cclxuICAgICAgICA+XHJcbiAgICAgICAgICA8SW1hZ2VCYWNrZ3JvdW5kXHJcbiAgICAgICAgICAgIHNvdXJjZSA9IHtyZXF1aXJlKCcuLi9hc3NldHMvaW1hZ2VzL3NxdWFyZS5qcGcnKX1cclxuICAgICAgICAgICAgc3R5bGUgPSB7c3R5bGVzLmJhY2tncm91bmRJbWFnZX1cclxuICAgICAgICAgID5cclxuICAgICAgICAgICAgey8qIFJlbmRlciB2YWx1ZXMgYmFzZWQgb24gdGVybmFyeSBjb25kaXRpb25hbCByZXNwZWN0aXZlIG9mIFxyXG4gICAgICAgICAgICAgICAgaWYgdmFsdWUgaXMgbnVsbCBvciBub3QuICovfVxyXG4gICAgICAgICAgICB7Ym9hcmRbcm93XVtjb2xdID09PSBudWxsPyBcclxuICAgICAgICAgICAgICByZW5kZXJOb3RlcygpXHJcbiAgICAgICAgICAgIDpcclxuICAgICAgICAgICAgICA8VGV4dFxyXG4gICAgICAgICAgICAgICAgc3R5bGUgPSB7e1xyXG4gICAgICAgICAgICAgICAgICBjb2xvcjpjb2xvclsxXSxcclxuICAgICAgICAgICAgICAgICAgdGV4dEFsaWduOidjZW50ZXInLFxyXG4gICAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6JzIwJScsXHJcbiAgICAgICAgICAgICAgICB9fVxyXG4gICAgICAgICAgICAgID5cclxuICAgICAgICAgICAgICAgIHtTdHJpbmcoYm9hcmRbcm93XVtjb2xdKX1cclxuICAgICAgICAgICAgICA8L1RleHQ+XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIDwvSW1hZ2VCYWNrZ3JvdW5kPlxyXG4gICAgICAgIDwvVmlldz5cclxuICAgICAgPC9Ub3VjaGFibGVIaWdobGlnaHQ+XHJcbiAgICA8L1ZpZXc+XHJcbiAgKTtcclxufVxyXG5cclxuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xyXG4gIGNvbnRhaW5lcjoge1xyXG4gIH0sXHJcbiAgbm90ZUNvbnRhaW5lcjp7XHJcbiAgICBmbGV4OjEsXHJcbiAgICBmbGV4RGlyZWN0aW9uOidjb2x1bW4nLFxyXG4gICAgYWxpZ25JdGVtczonY2VudGVyJ1xyXG4gIH0sXHJcbiAgbm90ZVJvdzp7XHJcbiAgICBmbGV4OjEsXHJcbiAgICBmbGV4RGlyZWN0aW9uOidyb3cnLFxyXG4gICAgYWxpZ25JdGVtczonZmxleC1zdGFydCdcclxuICB9LFxyXG4gIG5vdGVUZXh0OntcclxuICAgIGZvbnRTaXplOjksXHJcbiAgICBmb250RmFtaWx5OidKdXN0QW5vdGhlckhhbmQnLFxyXG4gIH0sXHJcbiAgYmFja2dyb3VuZEltYWdlOntcclxuICAgIHdpZHRoOicxMDAlJyxcclxuICAgIGhlaWdodDonMTAwJSdcclxuICB9XHJcbn0pOyJdfQ==