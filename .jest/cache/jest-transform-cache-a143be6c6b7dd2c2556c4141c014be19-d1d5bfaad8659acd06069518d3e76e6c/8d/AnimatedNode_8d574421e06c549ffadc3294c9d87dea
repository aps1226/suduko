a207d25b82beb029c12c5bd10685836d
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var NativeAnimatedHelper = require("../NativeAnimatedHelper");

var NativeAnimatedAPI = NativeAnimatedHelper.API;

var invariant = require('invariant');

var _uniqueId = 1;

var AnimatedNode = function () {
  function AnimatedNode() {
    (0, _classCallCheck2.default)(this, AnimatedNode);
    this._listeners = {};
  }

  (0, _createClass2.default)(AnimatedNode, [{
    key: "__attach",
    value: function __attach() {}
  }, {
    key: "__detach",
    value: function __detach() {
      if (this.__isNative && this.__nativeTag != null) {
        NativeAnimatedHelper.API.dropAnimatedNode(this.__nativeTag);
        this.__nativeTag = undefined;
      }
    }
  }, {
    key: "__getValue",
    value: function __getValue() {}
  }, {
    key: "__getAnimatedValue",
    value: function __getAnimatedValue() {
      return this.__getValue();
    }
  }, {
    key: "__addChild",
    value: function __addChild(child) {}
  }, {
    key: "__removeChild",
    value: function __removeChild(child) {}
  }, {
    key: "__getChildren",
    value: function __getChildren() {
      return [];
    }
  }, {
    key: "__makeNative",
    value: function __makeNative() {
      if (!this.__isNative) {
        throw new Error('This node cannot be made a "native" animated node');
      }

      if (this.hasListeners()) {
        this._startListeningToNativeValueUpdates();
      }
    }
  }, {
    key: "addListener",
    value: function addListener(callback) {
      var id = String(_uniqueId++);
      this._listeners[id] = callback;

      if (this.__isNative) {
        this._startListeningToNativeValueUpdates();
      }

      return id;
    }
  }, {
    key: "removeListener",
    value: function removeListener(id) {
      delete this._listeners[id];

      if (this.__isNative && !this.hasListeners()) {
        this._stopListeningForNativeValueUpdates();
      }
    }
  }, {
    key: "removeAllListeners",
    value: function removeAllListeners() {
      this._listeners = {};

      if (this.__isNative) {
        this._stopListeningForNativeValueUpdates();
      }
    }
  }, {
    key: "hasListeners",
    value: function hasListeners() {
      return !!Object.keys(this._listeners).length;
    }
  }, {
    key: "_startListeningToNativeValueUpdates",
    value: function _startListeningToNativeValueUpdates() {
      var _this = this;

      if (this.__nativeAnimatedValueListener && !this.__shouldUpdateListenersForNewNativeTag) {
        return;
      }

      if (this.__shouldUpdateListenersForNewNativeTag) {
        this.__shouldUpdateListenersForNewNativeTag = false;

        this._stopListeningForNativeValueUpdates();
      }

      NativeAnimatedAPI.startListeningToAnimatedNodeValue(this.__getNativeTag());
      this.__nativeAnimatedValueListener = NativeAnimatedHelper.nativeEventEmitter.addListener('onAnimatedValueUpdate', function (data) {
        if (data.tag !== _this.__getNativeTag()) {
          return;
        }

        _this._onAnimatedValueUpdateReceived(data.value);
      });
    }
  }, {
    key: "_onAnimatedValueUpdateReceived",
    value: function _onAnimatedValueUpdateReceived(value) {
      this.__callListeners(value);
    }
  }, {
    key: "__callListeners",
    value: function __callListeners(value) {
      for (var _key in this._listeners) {
        this._listeners[_key]({
          value: value
        });
      }
    }
  }, {
    key: "_stopListeningForNativeValueUpdates",
    value: function _stopListeningForNativeValueUpdates() {
      if (!this.__nativeAnimatedValueListener) {
        return;
      }

      this.__nativeAnimatedValueListener.remove();

      this.__nativeAnimatedValueListener = null;
      NativeAnimatedAPI.stopListeningToAnimatedNodeValue(this.__getNativeTag());
    }
  }, {
    key: "__getNativeTag",
    value: function __getNativeTag() {
      var _this$__nativeTag;

      NativeAnimatedHelper.assertNativeAnimatedModule();
      invariant(this.__isNative, 'Attempt to get native tag from node not marked as "native"');
      var nativeTag = (_this$__nativeTag = this.__nativeTag) != null ? _this$__nativeTag : NativeAnimatedHelper.generateNewNodeTag();

      if (this.__nativeTag == null) {
        this.__nativeTag = nativeTag;
        NativeAnimatedHelper.API.createAnimatedNode(nativeTag, this.__getNativeConfig());
        this.__shouldUpdateListenersForNewNativeTag = true;
      }

      return nativeTag;
    }
  }, {
    key: "__getNativeConfig",
    value: function __getNativeConfig() {
      throw new Error('This JS animated node type cannot be used as native animated node');
    }
  }, {
    key: "toJSON",
    value: function toJSON() {
      return this.__getValue();
    }
  }]);
  return AnimatedNode;
}();

module.exports = AnimatedNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkTm9kZS5qcyJdLCJuYW1lcyI6WyJOYXRpdmVBbmltYXRlZEhlbHBlciIsInJlcXVpcmUiLCJOYXRpdmVBbmltYXRlZEFQSSIsIkFQSSIsImludmFyaWFudCIsIl91bmlxdWVJZCIsIkFuaW1hdGVkTm9kZSIsIl9saXN0ZW5lcnMiLCJfX2lzTmF0aXZlIiwiX19uYXRpdmVUYWciLCJkcm9wQW5pbWF0ZWROb2RlIiwidW5kZWZpbmVkIiwiX19nZXRWYWx1ZSIsImNoaWxkIiwiRXJyb3IiLCJoYXNMaXN0ZW5lcnMiLCJfc3RhcnRMaXN0ZW5pbmdUb05hdGl2ZVZhbHVlVXBkYXRlcyIsImNhbGxiYWNrIiwiaWQiLCJTdHJpbmciLCJfc3RvcExpc3RlbmluZ0Zvck5hdGl2ZVZhbHVlVXBkYXRlcyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJfX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lciIsIl9fc2hvdWxkVXBkYXRlTGlzdGVuZXJzRm9yTmV3TmF0aXZlVGFnIiwic3RhcnRMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlIiwiX19nZXROYXRpdmVUYWciLCJuYXRpdmVFdmVudEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImRhdGEiLCJ0YWciLCJfb25BbmltYXRlZFZhbHVlVXBkYXRlUmVjZWl2ZWQiLCJ2YWx1ZSIsIl9fY2FsbExpc3RlbmVycyIsImtleSIsInJlbW92ZSIsInN0b3BMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlIiwiYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUiLCJuYXRpdmVUYWciLCJnZW5lcmF0ZU5ld05vZGVUYWciLCJjcmVhdGVBbmltYXRlZE5vZGUiLCJfX2dldE5hdGl2ZUNvbmZpZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBOzs7Ozs7OztBQUVBLElBQU1BLG9CQUFvQixHQUFHQyxPQUFPLDJCQUFwQzs7QUFFQSxJQUFNQyxpQkFBaUIsR0FBR0Ysb0JBQW9CLENBQUNHLEdBQS9D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Q0YsVUFBQUEsS0FBSyxFQUFMQTtBQUFELFNBQXJCO0FBQ0Q7QUFDRjs7O1dBRUQsK0NBQXNDO0FBQ3BDLFVBQUksQ0FBQyxLQUFLVCw2QkFBVixFQUF5QztBQUN2QztBQUNEOztBQUVELFdBQUtBLDZCQUFMLENBQW1DWSxNQUFuQzs7QUFDQSxXQUFLWiw2QkFBTCxHQUFxQyxJQUFyQztBQUNBdEIsTUFBQUEsaUJBQWlCLENBQUNtQyxnQ0FBbEIsQ0FBbUQsS0FBS1YsY0FBTCxFQUFuRDtBQUNEOzs7V0FFRCwwQkFBeUI7QUFBQTs7QUFDdkIzQixNQUFBQSxvQkFBb0IsQ0FBQ3NDLDBCQUFyQjtBQUNBbEMsTUFBQUEsU0FBUyxDQUNQLEtBQUtJLFVBREUsRUFFUCw0REFGTyxDQUFUO0FBS0EsVUFBTStCLFNBQVMsd0JBQ2IsS0FBSzlCLFdBRFEsZ0NBQ09ULG9CQUFvQixDQUFDd0Msa0JBQXJCLEVBRHRCOztBQUdBLFVBQUksS0FBSy9CLFdBQUwsSUFBb0IsSUFBeEIsRUFBOEI7QUFDNUIsYUFBS0EsV0FBTCxHQUFtQjhCLFNBQW5CO0FBQ0F2QyxRQUFBQSxvQkFBb0IsQ0FBQ0csR0FBckIsQ0FBeUJzQyxrQkFBekIsQ0FDRUYsU0FERixFQUVFLEtBQUtHLGlCQUFMLEVBRkY7QUFJQSxhQUFLakIsc0NBQUwsR0FBOEMsSUFBOUM7QUFDRDs7QUFFRCxhQUFPYyxTQUFQO0FBQ0Q7OztXQUNELDZCQUE0QjtBQUMxQixZQUFNLElBQUl6QixLQUFKLENBQ0osbUVBREksQ0FBTjtBQUdEOzs7V0FDRCxrQkFBYztBQUNaLGFBQU8sS0FBS0YsVUFBTCxFQUFQO0FBQ0Q7Ozs7O0FBR0grQixNQUFNLENBQUNDLE9BQVAsR0FBaUJ0QyxZQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IE5hdGl2ZUFuaW1hdGVkSGVscGVyID0gcmVxdWlyZSgnLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXInKTtcblxuY29uc3QgTmF0aXZlQW5pbWF0ZWRBUEkgPSBOYXRpdmVBbmltYXRlZEhlbHBlci5BUEk7XG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcblxudHlwZSBWYWx1ZUxpc3RlbmVyQ2FsbGJhY2sgPSAoc3RhdGU6IHt2YWx1ZTogbnVtYmVyLCAuLi59KSA9PiBtaXhlZDtcblxubGV0IF91bmlxdWVJZCA9IDE7XG5cbi8vIE5vdGUodmpldXgpOiB0aGlzIHdvdWxkIGJlIGJldHRlciBhcyBhbiBpbnRlcmZhY2UgYnV0IGZsb3cgZG9lc24ndFxuLy8gc3VwcG9ydCB0aGVtIHlldFxuY2xhc3MgQW5pbWF0ZWROb2RlIHtcbiAgX2xpc3RlbmVyczoge1trZXk6IHN0cmluZ106IFZhbHVlTGlzdGVuZXJDYWxsYmFjaywgLi4ufTtcbiAgX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXI6ID9hbnk7XG4gIF9fYXR0YWNoKCk6IHZvaWQge31cbiAgX19kZXRhY2goKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSAmJiB0aGlzLl9fbmF0aXZlVGFnICE9IG51bGwpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS5kcm9wQW5pbWF0ZWROb2RlKHRoaXMuX19uYXRpdmVUYWcpO1xuICAgICAgdGhpcy5fX25hdGl2ZVRhZyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cbiAgX19nZXRWYWx1ZSgpOiBhbnkge31cbiAgX19nZXRBbmltYXRlZFZhbHVlKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuX19nZXRWYWx1ZSgpO1xuICB9XG4gIF9fYWRkQ2hpbGQoY2hpbGQ6IEFuaW1hdGVkTm9kZSkge31cbiAgX19yZW1vdmVDaGlsZChjaGlsZDogQW5pbWF0ZWROb2RlKSB7fVxuICBfX2dldENoaWxkcmVuKCk6IEFycmF5PEFuaW1hdGVkTm9kZT4ge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qIE1ldGhvZHMgYW5kIHByb3BzIHVzZWQgYnkgbmF0aXZlIEFuaW1hdGVkIGltcGwgKi9cbiAgX19pc05hdGl2ZTogYm9vbGVhbjtcbiAgX19uYXRpdmVUYWc6ID9udW1iZXI7XG4gIF9fc2hvdWxkVXBkYXRlTGlzdGVuZXJzRm9yTmV3TmF0aXZlVGFnOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX2xpc3RlbmVycyA9IHt9O1xuICB9XG5cbiAgX19tYWtlTmF0aXZlKCkge1xuICAgIGlmICghdGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbm9kZSBjYW5ub3QgYmUgbWFkZSBhIFwibmF0aXZlXCIgYW5pbWF0ZWQgbm9kZScpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhhc0xpc3RlbmVycygpKSB7XG4gICAgICB0aGlzLl9zdGFydExpc3RlbmluZ1RvTmF0aXZlVmFsdWVVcGRhdGVzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYW4gYXN5bmNocm9ub3VzIGxpc3RlbmVyIHRvIHRoZSB2YWx1ZSBzbyB5b3UgY2FuIG9ic2VydmUgdXBkYXRlcyBmcm9tXG4gICAqIGFuaW1hdGlvbnMuICBUaGlzIGlzIHVzZWZ1bCBiZWNhdXNlIHRoZXJlIGlzIG5vIHdheSB0b1xuICAgKiBzeW5jaHJvbm91c2x5IHJlYWQgdGhlIHZhbHVlIGJlY2F1c2UgaXQgbWlnaHQgYmUgZHJpdmVuIG5hdGl2ZWx5LlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjYWRkbGlzdGVuZXJcbiAgICovXG4gIGFkZExpc3RlbmVyKGNhbGxiYWNrOiAodmFsdWU6IGFueSkgPT4gbWl4ZWQpOiBzdHJpbmcge1xuICAgIGNvbnN0IGlkID0gU3RyaW5nKF91bmlxdWVJZCsrKTtcbiAgICB0aGlzLl9saXN0ZW5lcnNbaWRdID0gY2FsbGJhY2s7XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSkge1xuICAgICAgdGhpcy5fc3RhcnRMaXN0ZW5pbmdUb05hdGl2ZVZhbHVlVXBkYXRlcygpO1xuICAgIH1cbiAgICByZXR1cm4gaWQ7XG4gIH1cblxuICAvKipcbiAgICogVW5yZWdpc3RlciBhIGxpc3RlbmVyLiBUaGUgYGlkYCBwYXJhbSBzaGFsbCBtYXRjaCB0aGUgaWRlbnRpZmllclxuICAgKiBwcmV2aW91c2x5IHJldHVybmVkIGJ5IGBhZGRMaXN0ZW5lcigpYC5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI3JlbW92ZWxpc3RlbmVyXG4gICAqL1xuICByZW1vdmVMaXN0ZW5lcihpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgZGVsZXRlIHRoaXMuX2xpc3RlbmVyc1tpZF07XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSAmJiAhdGhpcy5oYXNMaXN0ZW5lcnMoKSkge1xuICAgICAgdGhpcy5fc3RvcExpc3RlbmluZ0Zvck5hdGl2ZVZhbHVlVXBkYXRlcygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYWxsIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjcmVtb3ZlYWxsbGlzdGVuZXJzXG4gICAqL1xuICByZW1vdmVBbGxMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgdGhpcy5fbGlzdGVuZXJzID0ge307XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSkge1xuICAgICAgdGhpcy5fc3RvcExpc3RlbmluZ0Zvck5hdGl2ZVZhbHVlVXBkYXRlcygpO1xuICAgIH1cbiAgfVxuXG4gIGhhc0xpc3RlbmVycygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISFPYmplY3Qua2V5cyh0aGlzLl9saXN0ZW5lcnMpLmxlbmd0aDtcbiAgfVxuXG4gIF9zdGFydExpc3RlbmluZ1RvTmF0aXZlVmFsdWVVcGRhdGVzKCkge1xuICAgIGlmIChcbiAgICAgIHRoaXMuX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXIgJiZcbiAgICAgICF0aGlzLl9fc2hvdWxkVXBkYXRlTGlzdGVuZXJzRm9yTmV3TmF0aXZlVGFnXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX19zaG91bGRVcGRhdGVMaXN0ZW5lcnNGb3JOZXdOYXRpdmVUYWcpIHtcbiAgICAgIHRoaXMuX19zaG91bGRVcGRhdGVMaXN0ZW5lcnNGb3JOZXdOYXRpdmVUYWcgPSBmYWxzZTtcbiAgICAgIHRoaXMuX3N0b3BMaXN0ZW5pbmdGb3JOYXRpdmVWYWx1ZVVwZGF0ZXMoKTtcbiAgICB9XG5cbiAgICBOYXRpdmVBbmltYXRlZEFQSS5zdGFydExpc3RlbmluZ1RvQW5pbWF0ZWROb2RlVmFsdWUodGhpcy5fX2dldE5hdGl2ZVRhZygpKTtcbiAgICB0aGlzLl9fbmF0aXZlQW5pbWF0ZWRWYWx1ZUxpc3RlbmVyID0gTmF0aXZlQW5pbWF0ZWRIZWxwZXIubmF0aXZlRXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKFxuICAgICAgJ29uQW5pbWF0ZWRWYWx1ZVVwZGF0ZScsXG4gICAgICBkYXRhID0+IHtcbiAgICAgICAgaWYgKGRhdGEudGFnICE9PSB0aGlzLl9fZ2V0TmF0aXZlVGFnKCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fb25BbmltYXRlZFZhbHVlVXBkYXRlUmVjZWl2ZWQoZGF0YS52YWx1ZSk7XG4gICAgICB9LFxuICAgICk7XG4gIH1cblxuICBfb25BbmltYXRlZFZhbHVlVXBkYXRlUmVjZWl2ZWQodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMuX19jYWxsTGlzdGVuZXJzKHZhbHVlKTtcbiAgfVxuXG4gIF9fY2FsbExpc3RlbmVycyh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5fbGlzdGVuZXJzKSB7XG4gICAgICB0aGlzLl9saXN0ZW5lcnNba2V5XSh7dmFsdWV9KTtcbiAgICB9XG4gIH1cblxuICBfc3RvcExpc3RlbmluZ0Zvck5hdGl2ZVZhbHVlVXBkYXRlcygpIHtcbiAgICBpZiAoIXRoaXMuX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9fbmF0aXZlQW5pbWF0ZWRWYWx1ZUxpc3RlbmVyLnJlbW92ZSgpO1xuICAgIHRoaXMuX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXIgPSBudWxsO1xuICAgIE5hdGl2ZUFuaW1hdGVkQVBJLnN0b3BMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSk7XG4gIH1cblxuICBfX2dldE5hdGl2ZVRhZygpOiBudW1iZXIge1xuICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLmFzc2VydE5hdGl2ZUFuaW1hdGVkTW9kdWxlKCk7XG4gICAgaW52YXJpYW50KFxuICAgICAgdGhpcy5fX2lzTmF0aXZlLFxuICAgICAgJ0F0dGVtcHQgdG8gZ2V0IG5hdGl2ZSB0YWcgZnJvbSBub2RlIG5vdCBtYXJrZWQgYXMgXCJuYXRpdmVcIicsXG4gICAgKTtcblxuICAgIGNvbnN0IG5hdGl2ZVRhZyA9XG4gICAgICB0aGlzLl9fbmF0aXZlVGFnID8/IE5hdGl2ZUFuaW1hdGVkSGVscGVyLmdlbmVyYXRlTmV3Tm9kZVRhZygpO1xuXG4gICAgaWYgKHRoaXMuX19uYXRpdmVUYWcgPT0gbnVsbCkge1xuICAgICAgdGhpcy5fX25hdGl2ZVRhZyA9IG5hdGl2ZVRhZztcbiAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS5jcmVhdGVBbmltYXRlZE5vZGUoXG4gICAgICAgIG5hdGl2ZVRhZyxcbiAgICAgICAgdGhpcy5fX2dldE5hdGl2ZUNvbmZpZygpLFxuICAgICAgKTtcbiAgICAgIHRoaXMuX19zaG91bGRVcGRhdGVMaXN0ZW5lcnNGb3JOZXdOYXRpdmVUYWcgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBuYXRpdmVUYWc7XG4gIH1cbiAgX19nZXROYXRpdmVDb25maWcoKTogT2JqZWN0IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnVGhpcyBKUyBhbmltYXRlZCBub2RlIHR5cGUgY2Fubm90IGJlIHVzZWQgYXMgbmF0aXZlIGFuaW1hdGVkIG5vZGUnLFxuICAgICk7XG4gIH1cbiAgdG9KU09OKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuX19nZXRWYWx1ZSgpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQW5pbWF0ZWROb2RlO1xuIl19